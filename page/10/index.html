<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/uploads/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/uploads/favicon.ico">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"dunwu.github.io","root":"/blog/","images":"/blog/images","scheme":"Pisces","darkmode":true,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/blog/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/blog/js/config.js"></script>

    <meta name="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
<meta property="og:type" content="website">
<meta property="og:title" content="Dunwu Blog">
<meta property="og:url" content="https://dunwu.github.io/blog/page/10/index.html">
<meta property="og:site_name" content="Dunwu Blog">
<meta property="og:description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="é’æ‚Ÿ â—¾ Dunwu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://dunwu.github.io/blog/page/10/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/10/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Dunwu Blog</title>
  






  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Dunwu Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">å¤§é“è‡³ç®€ï¼ŒçŸ¥æ˜“è¡Œéš¾</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾<span class="badge">258</span></a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»<span class="badge">118</span></a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£<span class="badge">365</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="é’æ‚Ÿ â—¾ Dunwu"
      src="/blog/uploads/avatar.gif">
  <p class="site-author-name" itemprop="name">é’æ‚Ÿ â—¾ Dunwu</p>
  <div class="site-description" itemprop="description">é’æ‚Ÿçš„ä¸ªäººåšå®¢</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">365</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">118</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">258</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/dunwu" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;dunwu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:forbreak@163.com" title="E-Mail â†’ mailto:forbreak@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/dunwu/blog" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/5aee88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/5aee88/" class="post-title-link" itemprop="url">ActiveMQ å¿«é€Ÿå…¥é—¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-02-17 22:34:30" itemprop="dateCreated datePublished" datetime="2022-02-17T22:34:30+08:00">2022-02-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-23 18:54:25" itemprop="dateModified" datetime="2022-09-23T18:54:25+08:00">2022-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E9%80%9A%E4%BF%A1/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼é€šä¿¡</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E9%80%9A%E4%BF%A1/MQ/" itemprop="url" rel="index"><span itemprop="name">MQ</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E9%80%9A%E4%BF%A1/MQ/%E5%85%B6%E4%BB%96MQ/" itemprop="url" rel="index"><span itemprop="name">å…¶ä»–MQ</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>6.1k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>6 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ActiveMQ-å¿«é€Ÿå…¥é—¨"><a href="#ActiveMQ-å¿«é€Ÿå…¥é—¨" class="headerlink" title="ActiveMQ å¿«é€Ÿå…¥é—¨"></a>ActiveMQ å¿«é€Ÿå…¥é—¨</h1><h2 id="JMS-åŸºæœ¬æ¦‚å¿µ"><a href="#JMS-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="JMS åŸºæœ¬æ¦‚å¿µ"></a>JMS åŸºæœ¬æ¦‚å¿µ</h2><p><code>JMS</code> å³ <strong>Java æ¶ˆæ¯æœåŠ¡ï¼ˆJava Message Serviceï¼‰API</strong>ï¼Œæ˜¯ä¸€ä¸ª Java å¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶çš„ APIã€‚å®ƒç”¨äºåœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´ï¼Œæˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚Java æ¶ˆæ¯æœåŠ¡æ˜¯ä¸€ä¸ªä¸å…·ä½“å¹³å°æ— å…³çš„ APIï¼Œç»å¤§å¤šæ•° MOM æä¾›å•†éƒ½å¯¹ JMS æä¾›æ”¯æŒã€‚</p>
<h3 id="æ¶ˆæ¯æ¨¡å‹"><a href="#æ¶ˆæ¯æ¨¡å‹" class="headerlink" title="æ¶ˆæ¯æ¨¡å‹"></a>æ¶ˆæ¯æ¨¡å‹</h3><p>JMS æœ‰ä¸¤ç§æ¶ˆæ¯æ¨¡å‹ï¼š</p>
<ul>
<li>Point-to-Point(P2P)</li>
<li>Publish&#x2F;Subscribe(Pub&#x2F;Sub)</li>
</ul>
<h4 id="P2P-çš„ç‰¹ç‚¹"><a href="#P2P-çš„ç‰¹ç‚¹" class="headerlink" title="P2P çš„ç‰¹ç‚¹"></a>P2P çš„ç‰¹ç‚¹</h4><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javalib/jms/jms-pointToPoint.gif" alt="img"></p>
<p>åœ¨ç‚¹å¯¹ç‚¹çš„æ¶ˆæ¯ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯åˆ†å‘ç»™ä¸€ä¸ªå•ç‹¬çš„ä½¿ç”¨è€…ã€‚ç‚¹å¯¹ç‚¹æ¶ˆæ¯å¾€å¾€ä¸é˜Ÿåˆ— <code>javax.jms.Queue</code> ç›¸å…³è”ã€‚</p>
<p>æ¯ä¸ªæ¶ˆæ¯åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰(å³ä¸€æ—¦è¢«æ¶ˆè´¹ï¼Œæ¶ˆæ¯å°±ä¸å†åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­)ã€‚</p>
<p>å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´åœ¨æ—¶é—´ä¸Šæ²¡æœ‰ä¾èµ–æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‘é€è€…å‘é€äº†æ¶ˆæ¯ä¹‹åï¼Œä¸ç®¡æ¥æ”¶è€…æœ‰æ²¡æœ‰æ­£åœ¨è¿è¡Œï¼Œå®ƒä¸ä¼šå½±å“åˆ°æ¶ˆæ¯è¢«å‘é€åˆ°é˜Ÿåˆ—ã€‚</p>
<p>æ¥æ”¶è€…åœ¨æˆåŠŸæ¥æ”¶æ¶ˆæ¯ä¹‹åéœ€å‘é˜Ÿåˆ—åº”ç­”æˆåŠŸã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›å‘é€çš„æ¯ä¸ªæ¶ˆæ¯éƒ½åº”è¯¥è¢«æˆåŠŸå¤„ç†çš„è¯ï¼Œé‚£ä¹ˆä½ éœ€è¦ P2P æ¨¡å¼ã€‚</p>
<h4 id="Pub-x2F-Sub-çš„ç‰¹ç‚¹"><a href="#Pub-x2F-Sub-çš„ç‰¹ç‚¹" class="headerlink" title="Pub&#x2F;Sub çš„ç‰¹ç‚¹"></a>Pub&#x2F;Sub çš„ç‰¹ç‚¹</h4><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javalib/jms/jms-publishSubscribe.gif" alt="img"></p>
<p>å‘å¸ƒ&#x2F;è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿæ”¯æŒä¸€ä¸ªäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œæ¶ˆæ¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½å‚ä¸æ¶ˆæ¯çš„ä¼ é€’ã€‚ç”Ÿäº§è€…å‘å¸ƒäº‹ä»¶ï¼Œè€Œä½¿ç”¨è€…è®¢é˜…æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œå¹¶ä½¿ç”¨äº‹ä»¶ã€‚è¯¥ç±»å‹æ¶ˆæ¯ä¸€èˆ¬ä¸ç‰¹å®šçš„ä¸»é¢˜ <code>javax.jms.Topic</code> å…³è”ã€‚</p>
<p>æ¯ä¸ªæ¶ˆæ¯å¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…ã€‚</p>
<p>å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´æœ‰æ—¶é—´ä¸Šçš„ä¾èµ–æ€§ã€‚é’ˆå¯¹æŸä¸ªä¸»é¢˜ï¼ˆTopicï¼‰çš„è®¢é˜…è€…ï¼Œå®ƒå¿…é¡»åˆ›å»ºä¸€ä¸ªè®¢é˜…è€…ä¹‹åï¼Œæ‰èƒ½æ¶ˆè´¹å‘å¸ƒè€…çš„æ¶ˆæ¯ï¼Œè€Œä¸”ä¸ºäº†æ¶ˆè´¹æ¶ˆæ¯ï¼Œè®¢é˜…è€…å¿…é¡»ä¿æŒè¿è¡Œçš„çŠ¶æ€ã€‚</p>
<p>ä¸ºäº†ç¼“å’Œè¿™æ ·ä¸¥æ ¼çš„æ—¶é—´ç›¸å…³æ€§ï¼ŒJMS å…è®¸è®¢é˜…è€…åˆ›å»ºä¸€ä¸ªå¯æŒä¹…åŒ–çš„è®¢é˜…ã€‚è¿™æ ·ï¼Œå³ä½¿è®¢é˜…è€…æ²¡æœ‰è¢«æ¿€æ´»ï¼ˆè¿è¡Œï¼‰ï¼Œå®ƒä¹Ÿèƒ½æ¥æ”¶åˆ°å‘å¸ƒè€…çš„æ¶ˆæ¯ã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›å‘é€çš„æ¶ˆæ¯å¯ä»¥ä¸è¢«åšä»»ä½•å¤„ç†ã€æˆ–è€…è¢«ä¸€ä¸ªæ¶ˆæ¯è€…å¤„ç†ã€æˆ–è€…å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…å¤„ç†çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥é‡‡ç”¨ Pub&#x2F;Sub æ¨¡å‹ã€‚</p>
<h3 id="JMS-ç¼–ç¨‹æ¨¡å‹"><a href="#JMS-ç¼–ç¨‹æ¨¡å‹" class="headerlink" title="JMS ç¼–ç¨‹æ¨¡å‹"></a>JMS ç¼–ç¨‹æ¨¡å‹</h3><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javalib/jms/jms-publishSubscribe.gif" alt="img"></p>
<h4 id="ConnectionFactory"><a href="#ConnectionFactory" class="headerlink" title="ConnectionFactory"></a>ConnectionFactory</h4><p>åˆ›å»º <code>Connection</code> å¯¹è±¡çš„å·¥å‚ï¼Œé’ˆå¯¹ä¸¤ç§ä¸åŒçš„ jms æ¶ˆæ¯æ¨¡å‹ï¼Œåˆ†åˆ«æœ‰ <code>QueueConnectionFactory</code> å’Œ<code>TopicConnectionFactory</code> ä¸¤ç§ã€‚å¯ä»¥é€šè¿‡ JNDI æ¥æŸ¥æ‰¾ <code>ConnectionFactory</code> å¯¹è±¡ã€‚</p>
<h4 id="Connection"><a href="#Connection" class="headerlink" title="Connection"></a>Connection</h4><p><code>Connection</code> è¡¨ç¤ºåœ¨å®¢æˆ·ç«¯å’Œ JMS ç³»ç»Ÿä¹‹é—´å»ºç«‹çš„é“¾æ¥ï¼ˆå¯¹ TCP&#x2F;IP socket çš„åŒ…è£…ï¼‰ã€‚<code>Connection</code> å¯ä»¥äº§ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ª<code>Session</code>ã€‚è·Ÿ <code>ConnectionFactory</code> ä¸€æ ·ï¼Œ<code>Connection</code> ä¹Ÿæœ‰ä¸¤ç§ç±»å‹ï¼š<code>QueueConnection</code> å’Œ <code>TopicConnection</code>ã€‚</p>
<h4 id="Destination"><a href="#Destination" class="headerlink" title="Destination"></a>Destination</h4><p><code>Destination</code> æ˜¯ä¸€ä¸ªåŒ…è£…äº†æ¶ˆæ¯ç›®æ ‡æ ‡è¯†ç¬¦çš„è¢«ç®¡å¯¹è±¡ã€‚æ¶ˆæ¯ç›®æ ‡æ˜¯æŒ‡æ¶ˆæ¯å‘å¸ƒå’Œæ¥æ”¶çš„åœ°ç‚¹ï¼Œæˆ–è€…æ˜¯é˜Ÿåˆ— <code>Queue</code> ï¼Œæˆ–è€…æ˜¯ä¸»é¢˜ <code>Topic</code> ã€‚JMS ç®¡ç†å‘˜åˆ›å»ºè¿™äº›å¯¹è±¡ï¼Œç„¶åç”¨æˆ·é€šè¿‡ JNDI å‘ç°å®ƒä»¬ã€‚å’Œè¿æ¥å·¥å‚ä¸€æ ·ï¼Œç®¡ç†å‘˜å¯ä»¥åˆ›å»ºä¸¤ç§ç±»å‹çš„ç›®æ ‡ï¼Œç‚¹å¯¹ç‚¹æ¨¡å‹çš„ <code>Queue</code>ï¼Œä»¥åŠå‘å¸ƒè€…&#x2F;è®¢é˜…è€…æ¨¡å‹çš„ <code>Topic</code>ã€‚</p>
<h4 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h4><p><code>Session</code> è¡¨ç¤ºä¸€ä¸ªå•çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œç”¨äºå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚ç”±äºä¼šè¯æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥æ¶ˆæ¯æ˜¯è¿ç»­çš„ï¼Œå°±æ˜¯è¯´æ¶ˆæ¯æ˜¯æŒ‰ç…§å‘é€çš„é¡ºåºä¸€ä¸ªä¸€ä¸ªæ¥æ”¶çš„ã€‚ä¼šè¯çš„å¥½å¤„æ˜¯å®ƒæ”¯æŒäº‹åŠ¡ã€‚å¦‚æœç”¨æˆ·é€‰æ‹©äº†äº‹åŠ¡æ”¯æŒï¼Œä¼šè¯ä¸Šä¸‹æ–‡å°†ä¿å­˜ä¸€ç»„æ¶ˆæ¯ï¼Œç›´åˆ°äº‹åŠ¡è¢«æäº¤æ‰å‘é€è¿™äº›æ¶ˆæ¯ã€‚åœ¨æäº¤äº‹åŠ¡ä¹‹å‰ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å›æ»šæ“ä½œå–æ¶ˆè¿™äº›æ¶ˆæ¯ã€‚ä¸€ä¸ªä¼šè¯å…è®¸ç”¨æˆ·åˆ›å»ºæ¶ˆæ¯ï¼Œç”Ÿäº§è€…æ¥å‘é€æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…æ¥æ¥æ”¶æ¶ˆæ¯ã€‚åŒæ ·ï¼Œ<code>Session</code> ä¹Ÿåˆ† <code>QueueSession</code> å’Œ <code>TopicSession</code>ã€‚</p>
<h4 id="MessageConsumer"><a href="#MessageConsumer" class="headerlink" title="MessageConsumer"></a>MessageConsumer</h4><p><code>MessageConsumer</code> ç”± <code>Session</code> åˆ›å»ºï¼Œå¹¶ç”¨äºå°†æ¶ˆæ¯å‘é€åˆ° <code>Destination</code>ã€‚æ¶ˆè´¹è€…å¯ä»¥åŒæ­¥åœ°ï¼ˆé˜»å¡æ¨¡å¼ï¼‰ï¼Œæˆ–ï¼ˆéé˜»å¡ï¼‰æ¥æ”¶ <code>Queue</code> å’Œ <code>Topic</code> ç±»å‹çš„æ¶ˆæ¯ã€‚åŒæ ·ï¼Œæ¶ˆæ¯ç”Ÿäº§è€…åˆ†ä¸¤ç§ç±»å‹ï¼š<code>QueueSender</code> å’Œ<code>TopicPublisher</code>ã€‚</p>
<h4 id="MessageProducer"><a href="#MessageProducer" class="headerlink" title="MessageProducer"></a>MessageProducer</h4><p><code>MessageProducer</code> ç”± <code>Session</code> åˆ›å»ºï¼Œç”¨äºæ¥æ”¶è¢«å‘é€åˆ° <code>Destination</code> çš„æ¶ˆæ¯ã€‚<code>MessageProducer</code> æœ‰ä¸¤ç§ç±»å‹ï¼š<code>QueueReceiver</code> å’Œ <code>TopicSubscriber</code>ã€‚å¯åˆ†åˆ«é€šè¿‡ <code>session</code> çš„ <code>createReceiver(Queue)</code> æˆ– <code>createSubscriber(Topic)</code> æ¥åˆ›å»ºã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ <code>session</code> çš„ <code>creatDurableSubscriber</code> æ–¹æ³•æ¥åˆ›å»ºæŒä¹…åŒ–çš„è®¢é˜…è€…ã€‚</p>
<h4 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h4><p>æ˜¯åœ¨æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…ä¹‹é—´ä¼ é€çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ä»ä¸€ä¸ªåº”ç”¨ç¨‹åºä¼ é€åˆ°å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚ä¸€ä¸ªæ¶ˆæ¯æœ‰ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š</p>
<ul>
<li>æ¶ˆæ¯å¤´ï¼ˆå¿…é¡»ï¼‰ï¼šåŒ…å«ç”¨äºè¯†åˆ«å’Œä¸ºæ¶ˆæ¯å¯»æ‰¾è·¯ç”±çš„æ“ä½œè®¾ç½®ã€‚</li>
<li>ä¸€ç»„æ¶ˆæ¯å±æ€§ï¼ˆå¯é€‰ï¼‰ï¼šåŒ…å«é¢å¤–çš„å±æ€§ï¼Œæ”¯æŒå…¶ä»–æä¾›è€…å’Œç”¨æˆ·çš„å…¼å®¹ã€‚å¯ä»¥åˆ›å»ºå®šåˆ¶çš„å­—æ®µå’Œè¿‡æ»¤å™¨ï¼ˆæ¶ˆæ¯é€‰æ‹©å™¨ï¼‰ã€‚</li>
<li>ä¸€ä¸ªæ¶ˆæ¯ä½“ï¼ˆå¯é€‰ï¼‰ï¼šå…è®¸ç”¨æˆ·åˆ›å»ºäº”ç§ç±»å‹çš„æ¶ˆæ¯ï¼ˆæ–‡æœ¬æ¶ˆæ¯ï¼Œæ˜ å°„æ¶ˆæ¯ï¼Œå­—èŠ‚æ¶ˆæ¯ï¼Œæµæ¶ˆæ¯å’Œå¯¹è±¡æ¶ˆæ¯ï¼‰ã€‚</li>
</ul>
<p>æ¶ˆæ¯æ¥å£éå¸¸çµæ´»ï¼Œå¹¶æä¾›äº†è®¸å¤šæ–¹å¼æ¥å®šåˆ¶æ¶ˆæ¯çš„å†…å®¹ã€‚</p>
<table>
<thead>
<tr>
<th>Common</th>
<th>Point-to-Point</th>
<th>Publish-Subscribe</th>
</tr>
</thead>
<tbody><tr>
<td>ConnectionFactory</td>
<td>QueueConnectionFactory</td>
<td>TopicConnectionFactory</td>
</tr>
<tr>
<td>Connection</td>
<td>QueueConnection</td>
<td>TopicConnection</td>
</tr>
<tr>
<td>Destination</td>
<td>Queue</td>
<td>Topic</td>
</tr>
<tr>
<td>Session</td>
<td>QueueSession</td>
<td>TopicSession</td>
</tr>
<tr>
<td>MessageProducer</td>
<td>QueueSender</td>
<td>TopicPublisher</td>
</tr>
<tr>
<td>MessageSender</td>
<td>QueueReceiver, QueueBrowser</td>
<td>TopicSubscriber</td>
</tr>
</tbody></table>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p><strong>å®‰è£…æ¡ä»¶</strong></p>
<p>JDK1.7 åŠä»¥ä¸Šç‰ˆæœ¬</p>
<p>æœ¬åœ°é…ç½®äº† <strong>JAVA_HOME</strong> ç¯å¢ƒå˜é‡ã€‚</p>
<p><strong>ä¸‹è½½</strong></p>
<p>æ”¯æŒ Windows&#x2F;Unix&#x2F;Linux&#x2F;Cygwin</p>
<p><a target="_blank" rel="noopener" href="http://activemq.apache.org/download.html">ActiveMQ å®˜æ–¹ä¸‹è½½åœ°å€</a></p>
<p><strong>Windows ä¸‹è¿è¡Œ</strong></p>
<p>ï¼ˆ1ï¼‰è§£å‹å‹ç¼©åŒ…åˆ°æœ¬åœ°ï¼›</p>
<p>ï¼ˆ2ï¼‰æ‰“å¼€æ§åˆ¶å°ï¼Œè¿›å…¥å®‰è£…ç›®å½•çš„ <code>bin</code> ç›®å½•ä¸‹ï¼›</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">cd</span><span class="meta"> [activemq_install_dir]</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰æ‰§è¡Œ <code>activemq start</code> æ¥å¯åŠ¨ ActiveMQ</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin\activemq <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•å®‰è£…æ˜¯å¦æˆåŠŸ</strong></p>
<p>ï¼ˆ1ï¼‰ActiveMQ é»˜è®¤ç›‘å¬ç«¯å£ä¸º 61616</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -an|<span class="built_in">find</span> â€œ61616â€</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰è®¿é—® <a target="_blank" rel="noopener" href="http://127.0.0.1:8161/admin/">http://127.0.0.1:8161/admin/</a></p>
<p>ï¼ˆ3ï¼‰è¾“å…¥ç”¨æˆ·åã€å¯†ç </p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Login</span>: <span class="keyword">admin</span></span><br><span class="line">Passwort: <span class="keyword">admin</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ4ï¼‰ç‚¹å‡»å¯¼èˆªæ çš„ Queues èœå•</p>
<p>ï¼ˆ5ï¼‰æ·»åŠ ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆqueueï¼‰</p>
<h2 id="é¡¹ç›®ä¸­çš„åº”ç”¨"><a href="#é¡¹ç›®ä¸­çš„åº”ç”¨" class="headerlink" title="é¡¹ç›®ä¸­çš„åº”ç”¨"></a>é¡¹ç›®ä¸­çš„åº”ç”¨</h2><p><strong>å¼•å…¥ä¾èµ–</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.14.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Sender.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sender</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SEND_NUMBER</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// ConnectionFactory ï¼šè¿æ¥å·¥å‚ï¼ŒJMS ç”¨å®ƒåˆ›å»ºè¿æ¥</span></span><br><span class="line">        ConnectionFactory connectionFactory;</span><br><span class="line">        <span class="comment">// Connection ï¼šJMS å®¢æˆ·ç«¯åˆ°JMS Provider çš„è¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// Sessionï¼š ä¸€ä¸ªå‘é€æˆ–æ¥æ”¶æ¶ˆæ¯çš„çº¿ç¨‹</span></span><br><span class="line">        Session session;</span><br><span class="line">        <span class="comment">// Destination ï¼šæ¶ˆæ¯çš„ç›®çš„åœ°;æ¶ˆæ¯å‘é€ç»™è°.</span></span><br><span class="line">        Destination destination;</span><br><span class="line">        <span class="comment">// MessageProducerï¼šæ¶ˆæ¯å‘é€è€…</span></span><br><span class="line">        MessageProducer producer;</span><br><span class="line">        <span class="comment">// TextMessage message;</span></span><br><span class="line">        <span class="comment">// æ„é€ ConnectionFactoryå®ä¾‹å¯¹è±¡ï¼Œæ­¤å¤„é‡‡ç”¨ActiveMqçš„å®ç°jar</span></span><br><span class="line">        connectionFactory = <span class="keyword">new</span> <span class="title class_">ActiveMQConnectionFactory</span>(</span><br><span class="line">                ActiveMQConnection.DEFAULT_USER,</span><br><span class="line">                ActiveMQConnection.DEFAULT_PASSWORD,</span><br><span class="line">                <span class="string">&quot;tcp://localhost:61616&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ„é€ ä»å·¥å‚å¾—åˆ°è¿æ¥å¯¹è±¡</span></span><br><span class="line">            connection = connectionFactory.createConnection();</span><br><span class="line">            <span class="comment">// å¯åŠ¨</span></span><br><span class="line">            connection.start();</span><br><span class="line">            <span class="comment">// è·å–æ“ä½œè¿æ¥</span></span><br><span class="line">            session = connection.createSession(Boolean.TRUE,</span><br><span class="line">                    Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">            <span class="comment">// è·å–sessionæ³¨æ„å‚æ•°å€¼xingbo.xu-queueæ˜¯ä¸€ä¸ªæœåŠ¡å™¨çš„queueï¼Œé¡»åœ¨åœ¨ActiveMqçš„consoleé…ç½®</span></span><br><span class="line">            destination = session.createQueue(<span class="string">&quot;FirstQueue&quot;</span>);</span><br><span class="line">            <span class="comment">// å¾—åˆ°æ¶ˆæ¯ç”Ÿæˆè€…ã€å‘é€è€…ã€‘</span></span><br><span class="line">            producer = session.createProducer(destination);</span><br><span class="line">            <span class="comment">// è®¾ç½®ä¸æŒä¹…åŒ–ï¼Œæ­¤å¤„å­¦ä¹ ï¼Œå®é™…æ ¹æ®é¡¹ç›®å†³å®š</span></span><br><span class="line">            producer.setDeliveryMode(DeliveryMode.NON_PERSISTENT);</span><br><span class="line">            <span class="comment">// æ„é€ æ¶ˆæ¯ï¼Œæ­¤å¤„å†™æ­»ï¼Œé¡¹ç›®å°±æ˜¯å‚æ•°ï¼Œæˆ–è€…æ–¹æ³•è·å–</span></span><br><span class="line">            sendMessage(session, producer);</span><br><span class="line">            session.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> != connection)</span><br><span class="line">                    connection.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable ignore) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(Session session, MessageProducer producer)</span></span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= SEND_NUMBER; i++) &#123;</span><br><span class="line">            <span class="type">TextMessage</span> <span class="variable">message</span> <span class="operator">=</span> session</span><br><span class="line">                    .createTextMessage(<span class="string">&quot;ActiveMq å‘é€çš„æ¶ˆæ¯&quot;</span> + i);</span><br><span class="line">            <span class="comment">// å‘é€æ¶ˆæ¯åˆ°ç›®çš„åœ°æ–¹</span></span><br><span class="line">            System.out.println(<span class="string">&quot;å‘é€æ¶ˆæ¯ï¼š&quot;</span> + <span class="string">&quot;ActiveMq å‘é€çš„æ¶ˆæ¯&quot;</span> + i);</span><br><span class="line">            producer.send(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Receiver.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Receiver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// ConnectionFactory ï¼šè¿æ¥å·¥å‚ï¼ŒJMS ç”¨å®ƒåˆ›å»ºè¿æ¥</span></span><br><span class="line">        ConnectionFactory connectionFactory;</span><br><span class="line">        <span class="comment">// Connection ï¼šJMS å®¢æˆ·ç«¯åˆ°JMS Provider çš„è¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// Sessionï¼š ä¸€ä¸ªå‘é€æˆ–æ¥æ”¶æ¶ˆæ¯çš„çº¿ç¨‹</span></span><br><span class="line">        Session session;</span><br><span class="line">        <span class="comment">// Destination ï¼šæ¶ˆæ¯çš„ç›®çš„åœ°;æ¶ˆæ¯å‘é€ç»™è°.</span></span><br><span class="line">        Destination destination;</span><br><span class="line">        <span class="comment">// æ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯æ¥æ”¶è€…</span></span><br><span class="line">        MessageConsumer consumer;</span><br><span class="line">        connectionFactory = <span class="keyword">new</span> <span class="title class_">ActiveMQConnectionFactory</span>(</span><br><span class="line">                ActiveMQConnection.DEFAULT_USER,</span><br><span class="line">                ActiveMQConnection.DEFAULT_PASSWORD,</span><br><span class="line">                <span class="string">&quot;tcp://localhost:61616&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ„é€ ä»å·¥å‚å¾—åˆ°è¿æ¥å¯¹è±¡</span></span><br><span class="line">            connection = connectionFactory.createConnection();</span><br><span class="line">            <span class="comment">// å¯åŠ¨</span></span><br><span class="line">            connection.start();</span><br><span class="line">            <span class="comment">// è·å–æ“ä½œè¿æ¥</span></span><br><span class="line">            session = connection.createSession(Boolean.FALSE,</span><br><span class="line">                    Session.AUTO_ACKNOWLEDGE);</span><br><span class="line">            <span class="comment">// è·å–sessionæ³¨æ„å‚æ•°å€¼xingbo.xu-queueæ˜¯ä¸€ä¸ªæœåŠ¡å™¨çš„queueï¼Œé¡»åœ¨åœ¨ActiveMqçš„consoleé…ç½®</span></span><br><span class="line">            destination = session.createQueue(<span class="string">&quot;FirstQueue&quot;</span>);</span><br><span class="line">            consumer = session.createConsumer(destination);</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="comment">//è®¾ç½®æ¥æ”¶è€…æ¥æ”¶æ¶ˆæ¯çš„æ—¶é—´ï¼Œä¸ºäº†ä¾¿äºæµ‹è¯•ï¼Œè¿™é‡Œè°å®šä¸º100s</span></span><br><span class="line">                <span class="type">TextMessage</span> <span class="variable">message</span> <span class="operator">=</span> (TextMessage) consumer.receive(<span class="number">100000</span>);</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> != message) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯&quot;</span> + message.getText());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> != connection)</span><br><span class="line">                    connection.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable ignore) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è¿è¡Œ</strong></p>
<p>å…ˆè¿è¡Œ Receiver.java è¿›è¡Œæ¶ˆæ¯ç›‘å¬ï¼Œå†è¿è¡Œ Send.java å‘é€æ¶ˆæ¯ã€‚</p>
<p><strong>è¾“å‡º</strong></p>
<p>Send çš„è¾“å‡ºå†…å®¹</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å‘é€æ¶ˆæ¯ï¼šActivemq å‘é€æ¶ˆæ¯0</span><br><span class="line">å‘é€æ¶ˆæ¯ï¼šActivemq å‘é€æ¶ˆæ¯1</span><br><span class="line">å‘é€æ¶ˆæ¯ï¼šActivemq å‘é€æ¶ˆæ¯2</span><br><span class="line">å‘é€æ¶ˆæ¯ï¼šActivemq å‘é€æ¶ˆæ¯3</span><br></pre></td></tr></table></figure>

<p>Receiver çš„è¾“å‡ºå†…å®¹</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ”¶åˆ°æ¶ˆæ¯ActiveMQ å‘é€æ¶ˆæ¯0</span><br><span class="line">æ”¶åˆ°æ¶ˆæ¯ActiveMQ å‘é€æ¶ˆæ¯1</span><br><span class="line">æ”¶åˆ°æ¶ˆæ¯ActiveMQ å‘é€æ¶ˆæ¯2</span><br><span class="line">æ”¶åˆ°æ¶ˆæ¯ActiveMQ å‘é€æ¶ˆæ¯3</span><br></pre></td></tr></table></figure>

<h2 id="èµ„æº"><a href="#èµ„æº" class="headerlink" title="èµ„æº"></a>èµ„æº</h2><ul>
<li><a target="_blank" rel="noopener" href="http://activemq.apache.org/">ActiveMQ å®˜ç½‘</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/cd/E19575-01/819-3669/6n5sg7cgq/index.html">oracle å®˜æ–¹çš„ jms ä»‹ç»</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/2950ba/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/2950ba/" class="post-title-link" itemprop="url">Java åŸºç¡€è¯­æ³•ç‰¹æ€§</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-01-25 07:31:16" itemprop="dateCreated datePublished" datetime="2022-01-25T07:31:16+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-23 18:54:25" itemprop="dateModified" datetime="2022-09-23T18:54:25+08:00">2022-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/JavaSE/" itemprop="url" rel="index"><span itemprop="name">JavaSE</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/JavaSE/%E5%9F%BA%E7%A1%80%E7%89%B9%E6%80%A7/" itemprop="url" rel="index"><span itemprop="name">åŸºç¡€ç‰¹æ€§</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>1.5k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>1 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Java-åŸºç¡€è¯­æ³•ç‰¹æ€§"><a href="#Java-åŸºç¡€è¯­æ³•ç‰¹æ€§" class="headerlink" title="Java åŸºç¡€è¯­æ³•ç‰¹æ€§"></a>Java åŸºç¡€è¯­æ³•ç‰¹æ€§</h1><h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><p>ç©ºç™½è¡Œï¼Œæˆ–è€…æ³¨é‡Šçš„å†…å®¹ï¼Œéƒ½ä¼šè¢« Java ç¼–è¯‘å™¨å¿½ç•¥æ‰ã€‚</p>
<p>Java æ”¯æŒå¤šç§æ³¨é‡Šæ–¹å¼ï¼Œä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å„ç§æ³¨é‡Šçš„ä½¿ç”¨æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * JavaDoc æ³¨é‡Š</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// å•è¡Œæ³¨é‡Š</span></span><br><span class="line">        <span class="comment">/* å¤šè¡Œæ³¨é‡Šï¼š</span></span><br><span class="line"><span class="comment">           1. æ³¨æ„ç‚¹a</span></span><br><span class="line"><span class="comment">           2. æ³¨æ„ç‚¹b</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åŸºæœ¬æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹"></a>åŸºæœ¬æ•°æ®ç±»å‹</h2><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.svg" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-data-type.md">æ·±å…¥ç†è§£ Java åŸºæœ¬æ•°æ®ç±»å‹</a></p>
</blockquote>
<h2 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h2><p>Java æ”¯æŒçš„å˜é‡ç±»å‹æœ‰ï¼š</p>
<ul>
<li><code>å±€éƒ¨å˜é‡</code> - ç±»æ–¹æ³•ä¸­çš„å˜é‡ã€‚</li>
<li><code>å®ä¾‹å˜é‡ï¼ˆä¹Ÿå«æˆå‘˜å˜é‡ï¼‰</code> - ç±»æ–¹æ³•å¤–çš„å˜é‡ï¼Œä¸è¿‡æ²¡æœ‰ <code>static</code> ä¿®é¥°ã€‚</li>
<li><code>ç±»å˜é‡ï¼ˆä¹Ÿå«é™æ€å˜é‡ï¼‰</code> - ç±»æ–¹æ³•å¤–çš„å˜é‡ï¼Œç”¨ <code>static</code> ä¿®é¥°ã€‚</li>
</ul>
<p>ç‰¹æ€§å¯¹æ¯”ï¼š</p>
<table>
<thead>
<tr>
<th>å±€éƒ¨å˜é‡</th>
<th>å®ä¾‹å˜é‡ï¼ˆä¹Ÿå«æˆå‘˜å˜é‡ï¼‰</th>
<th>ç±»å˜é‡ï¼ˆä¹Ÿå«é™æ€å˜é‡ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>å±€éƒ¨å˜é‡å£°æ˜åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—ä¸­ã€‚</td>
<td>å®ä¾‹å˜é‡å£°æ˜åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•å’Œè¯­å¥å—ä¹‹å¤–ã€‚</td>
<td>ç±»å˜é‡å£°æ˜åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•å’Œè¯­å¥å—ä¹‹å¤–ã€‚å¹¶ä¸”ä»¥ static ä¿®é¥°ã€‚</td>
</tr>
<tr>
<td>å±€éƒ¨å˜é‡åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•ã€æˆ–è€…è¯­å¥å—è¢«æ‰§è¡Œçš„æ—¶å€™åˆ›å»ºï¼Œå½“å®ƒä»¬æ‰§è¡Œå®Œæˆåï¼Œå˜é‡å°†ä¼šè¢«é”€æ¯ã€‚</td>
<td>å®ä¾‹å˜é‡åœ¨å¯¹è±¡åˆ›å»ºçš„æ—¶å€™åˆ›å»ºï¼Œåœ¨å¯¹è±¡è¢«é”€æ¯çš„æ—¶å€™é”€æ¯ã€‚</td>
<td>ç±»å˜é‡åœ¨ç¬¬ä¸€æ¬¡è¢«è®¿é—®æ—¶åˆ›å»ºï¼Œåœ¨ç¨‹åºç»“æŸæ—¶é”€æ¯ã€‚</td>
</tr>
<tr>
<td>å±€éƒ¨å˜é‡æ²¡æœ‰é»˜è®¤å€¼ï¼Œæ‰€ä»¥å¿…é¡»ç»è¿‡åˆå§‹åŒ–ï¼Œæ‰å¯ä»¥ä½¿ç”¨ã€‚</td>
<td>å®ä¾‹å˜é‡å…·æœ‰é»˜è®¤å€¼ã€‚æ•°å€¼å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ 0ï¼Œå¸ƒå°”å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ falseï¼Œå¼•ç”¨ç±»å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ nullã€‚å˜é‡çš„å€¼å¯ä»¥åœ¨å£°æ˜æ—¶æŒ‡å®šï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ–¹æ³•ä¸­æŒ‡å®šã€‚</td>
<td>ç±»å˜é‡å…·æœ‰é»˜è®¤å€¼ã€‚æ•°å€¼å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ 0ï¼Œå¸ƒå°”å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ falseï¼Œå¼•ç”¨ç±»å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ nullã€‚å˜é‡çš„å€¼å¯ä»¥åœ¨å£°æ˜æ—¶æŒ‡å®šï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ–¹æ³•ä¸­æŒ‡å®šã€‚æ­¤å¤–ï¼Œé™æ€å˜é‡è¿˜å¯ä»¥åœ¨é™æ€è¯­å¥å—ä¸­åˆå§‹åŒ–ã€‚</td>
</tr>
<tr>
<td>å¯¹äºå±€éƒ¨å˜é‡ï¼Œå¦‚æœæ˜¯åŸºæœ¬ç±»å‹ï¼Œä¼šæŠŠå€¼ç›´æ¥å­˜å‚¨åœ¨æ ˆï¼›å¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œä¼šæŠŠå…¶å¯¹è±¡å­˜å‚¨åœ¨å †ï¼Œè€ŒæŠŠè¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰å­˜å‚¨åœ¨æ ˆã€‚</td>
<td>å®ä¾‹å˜é‡å­˜å‚¨åœ¨å †ã€‚</td>
<td>ç±»å˜é‡å­˜å‚¨åœ¨é™æ€å­˜å‚¨åŒºã€‚</td>
</tr>
<tr>
<td>è®¿é—®ä¿®é¥°ç¬¦ä¸èƒ½ç”¨äºå±€éƒ¨å˜é‡ã€‚</td>
<td>è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ç”¨äºå®ä¾‹å˜é‡ã€‚</td>
<td>è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ç”¨äºç±»å˜é‡ã€‚</td>
</tr>
<tr>
<td>å±€éƒ¨å˜é‡åªåœ¨å£°æ˜å®ƒçš„æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—ä¸­å¯è§ã€‚</td>
<td>å®ä¾‹å˜é‡å¯¹äºç±»ä¸­çš„æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—æ˜¯å¯è§çš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹åº”è¯¥æŠŠå®ä¾‹å˜é‡è®¾ä¸ºç§æœ‰ã€‚é€šè¿‡ä½¿ç”¨è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ä½¿å®ä¾‹å˜é‡å¯¹å­ç±»å¯è§ã€‚</td>
<td>ä¸å®ä¾‹å˜é‡å…·æœ‰ç›¸ä¼¼çš„å¯è§æ€§ã€‚ä½†ä¸ºäº†å¯¹ç±»çš„ä½¿ç”¨è€…å¯è§ï¼Œå¤§å¤šæ•°é™æ€å˜é‡å£°æ˜ä¸º public ç±»å‹ã€‚</td>
</tr>
<tr>
<td></td>
<td>å®ä¾‹å˜é‡å¯ä»¥ç›´æ¥é€šè¿‡å˜é‡åè®¿é—®ã€‚ä½†åœ¨é™æ€æ–¹æ³•ä»¥åŠå…¶ä»–ç±»ä¸­ï¼Œå°±åº”è¯¥ä½¿ç”¨å®Œå…¨é™å®šåï¼šObejectReference.VariableNameã€‚</td>
<td>é™æ€å˜é‡å¯ä»¥é€šè¿‡ï¼šClassName.VariableName çš„æ–¹å¼è®¿é—®ã€‚</td>
</tr>
<tr>
<td></td>
<td></td>
<td>æ— è®ºä¸€ä¸ªç±»åˆ›å»ºäº†å¤šå°‘ä¸ªå¯¹è±¡ï¼Œç±»åªæ‹¥æœ‰ç±»å˜é‡çš„ä¸€ä»½æ‹·è´ã€‚</td>
</tr>
<tr>
<td></td>
<td></td>
<td>ç±»å˜é‡é™¤äº†è¢«å£°æ˜ä¸ºå¸¸é‡å¤–å¾ˆå°‘ä½¿ç”¨ã€‚</td>
</tr>
</tbody></table>
<p><strong>å˜é‡ä¿®é¥°ç¬¦</strong></p>
<ul>
<li><strong>è®¿é—®çº§åˆ«ä¿®é¥°ç¬¦</strong><ul>
<li>å¦‚æœå˜é‡æ˜¯å®ä¾‹å˜é‡æˆ–ç±»å˜é‡ï¼Œå¯ä»¥æ·»åŠ è®¿é—®çº§åˆ«ä¿®é¥°ç¬¦ï¼ˆpublic&#x2F;protected&#x2F;privateï¼‰</li>
</ul>
</li>
<li><strong>é™æ€ä¿®é¥°ç¬¦</strong><ul>
<li>å¦‚æœå˜é‡æ˜¯ç±»å˜é‡ï¼Œéœ€è¦æ·»åŠ  static ä¿®é¥°</li>
</ul>
</li>
<li><strong>final</strong><ul>
<li>å¦‚æœå˜é‡ä½¿ç”¨ <code>fianl</code> ä¿®é¥°ç¬¦ï¼Œå°±è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œä¸èƒ½è¢«ä¿®æ”¹ã€‚</li>
</ul>
</li>
</ul>
<h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E6%95%B0%E7%BB%84.svg" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-array.md">æ·±å…¥ç†è§£ Java æ•°ç»„</a></p>
</blockquote>
<h2 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h2><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E6%9E%9A%E4%B8%BE.svg" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-enum.md">æ·±å…¥ç†è§£ Java æ•°ç»„</a></p>
</blockquote>
<h2 id="æ“ä½œç¬¦"><a href="#æ“ä½œç¬¦" class="headerlink" title="æ“ä½œç¬¦"></a>æ“ä½œç¬¦</h2><p>Java ä¸­æ”¯æŒçš„æ“ä½œç¬¦ç±»å‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E6%93%8D%E4%BD%9C%E7%AC%A6.svg" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="http://www.runoob.com/java/java-operators.html">Java æ“ä½œç¬¦</a></p>
</blockquote>
<h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20220125072221.png" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-method.md">æ·±å…¥ç†è§£ Java æ–¹æ³•</a></p>
</blockquote>
<h2 id="æ§åˆ¶è¯­å¥"><a href="#æ§åˆ¶è¯­å¥" class="headerlink" title="æ§åˆ¶è¯­å¥"></a>æ§åˆ¶è¯­å¥</h2><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5.svg" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-control-statement.md">Java æ§åˆ¶è¯­å¥</a></p>
</blockquote>
<h2 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h2><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%BC%82%E5%B8%B8%E6%A1%86%E6%9E%B6.svg" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%BC%82%E5%B8%B8.svg" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-exception.md">æ·±å…¥ç†è§£ Java å¼‚å¸¸</a></p>
</blockquote>
<h2 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h2><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E6%B3%9B%E5%9E%8B.svg" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-generic.md">æ·±å…¥ç†è§£ Java æ³›å‹</a></p>
</blockquote>
<h2 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h2><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%8F%8D%E5%B0%84.svg" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E4%BB%A3%E7%90%86.svg" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-reflection.md">æ·±å…¥ç†è§£ Java åå°„å’ŒåŠ¨æ€ä»£ç†</a></p>
</blockquote>
<h2 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h2><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/%E6%B3%A8%E8%A7%A3%E7%AE%80%E4%BB%8B.svg" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/%E5%85%83%E6%B3%A8%E8%A7%A3.svg" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/%E5%86%85%E7%BD%AE%E6%B3%A8%E8%A7%A3.svg" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3.svg" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-annotation.md">æ·±å…¥ç†è§£ Java æ³¨è§£</a></p>
</blockquote>
<h2 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h2><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%BA%8F%E5%88%97%E5%8C%96.svg" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/io/java-serialization.md">æ·±å…¥ç†è§£ Java åºåˆ—åŒ–</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/2d95ce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/2d95ce/" class="post-title-link" itemprop="url">Elasticsearch æ€§èƒ½ä¼˜åŒ–</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-01-21 19:54:43" itemprop="dateCreated datePublished" datetime="2022-01-21T19:54:43+08:00">2022-01-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-23 18:54:25" itemprop="dateModified" datetime="2022-09-23T18:54:25+08:00">2022-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">æ•°æ®åº“</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">æœç´¢å¼•æ“æ•°æ®åº“</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/Elasticsearch/" itemprop="url" rel="index"><span itemprop="name">Elasticsearch</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>9.5k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>9 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Elasticsearch-æ€§èƒ½ä¼˜åŒ–"><a href="#Elasticsearch-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="Elasticsearch æ€§èƒ½ä¼˜åŒ–"></a>Elasticsearch æ€§èƒ½ä¼˜åŒ–</h1><p>Elasticsearch æ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ï¼Œè®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚ä½œä¸ºä¸€ä¸ªå¼€ç®±å³ç”¨çš„äº§å“ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸Šçº¿ä¹‹åï¼Œæˆ‘ä»¬å…¶å®ä¸ä¸€å®šèƒ½ç¡®ä¿å…¶çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚å¦‚ä½•æ ¹æ®å®é™…æƒ…å†µæé«˜æœåŠ¡çš„æ€§èƒ½ï¼Œå…¶å®æœ‰å¾ˆå¤šæŠ€å·§ã€‚è¿™ç« æˆ‘ä»¬åˆ†äº«ä»å®æˆ˜ç»éªŒä¸­æ€»ç»“å‡ºæ¥çš„ elasticsearch æ€§èƒ½ä¼˜åŒ–ï¼Œä¸»è¦ä»ç¡¬ä»¶é…ç½®ä¼˜åŒ–ã€ç´¢å¼•ä¼˜åŒ–è®¾ç½®ã€æŸ¥è¯¢æ–¹é¢ä¼˜åŒ–ã€æ•°æ®ç»“æ„ä¼˜åŒ–ã€é›†ç¾¤æ¶æ„ä¼˜åŒ–ç­‰æ–¹é¢è®²è§£ã€‚</p>
<h2 id="ç¡¬ä»¶é…ç½®ä¼˜åŒ–"><a href="#ç¡¬ä»¶é…ç½®ä¼˜åŒ–" class="headerlink" title="ç¡¬ä»¶é…ç½®ä¼˜åŒ–"></a>ç¡¬ä»¶é…ç½®ä¼˜åŒ–</h2><p>å‡çº§ç¡¬ä»¶è®¾å¤‡é…ç½®ä¸€ç›´éƒ½æ˜¯æé«˜æœåŠ¡èƒ½åŠ›æœ€å¿«é€Ÿæœ‰æ•ˆçš„æ‰‹æ®µï¼Œåœ¨ç³»ç»Ÿå±‚é¢èƒ½å¤Ÿå½±å“åº”ç”¨æ€§èƒ½çš„ä¸€èˆ¬åŒ…æ‹¬ä¸‰ä¸ªå› ç´ ï¼šCPUã€å†…å­˜å’Œ IOï¼Œå¯ä»¥ä»è¿™ä¸‰æ–¹é¢è¿›è¡Œ ES çš„æ€§èƒ½ä¼˜åŒ–å·¥ä½œã€‚</p>
<h3 id="CPU-é…ç½®"><a href="#CPU-é…ç½®" class="headerlink" title="CPU é…ç½®"></a>CPU é…ç½®</h3><p>ä¸€èˆ¬è¯´æ¥ï¼ŒCPU ç¹å¿™çš„åŸå› æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ol>
<li>çº¿ç¨‹ä¸­æœ‰æ— é™ç©ºå¾ªç¯ã€æ— é˜»å¡ã€æ­£åˆ™åŒ¹é…æˆ–è€…å•çº¯çš„è®¡ç®—ï¼›</li>
<li>å‘ç”Ÿäº†é¢‘ç¹çš„ GCï¼›</li>
<li>å¤šçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼›</li>
</ol>
<p>å¤§å¤šæ•° Elasticsearch éƒ¨ç½²å¾€å¾€å¯¹ CPU è¦æ±‚ä¸é«˜ã€‚å› æ­¤ï¼Œç›¸å¯¹å…¶å®ƒèµ„æºï¼Œå…·ä½“é…ç½®å¤šå°‘ä¸ªï¼ˆCPUï¼‰ä¸æ˜¯é‚£ä¹ˆå…³é”®ã€‚ä½ åº”è¯¥é€‰æ‹©å…·æœ‰å¤šä¸ªå†…æ ¸çš„ç°ä»£å¤„ç†å™¨ï¼Œå¸¸è§çš„é›†ç¾¤ä½¿ç”¨ 2 åˆ° 8 ä¸ªæ ¸çš„æœºå™¨ã€‚<strong>å¦‚æœä½ è¦åœ¨æ›´å¿«çš„ CPUs å’Œæ›´å¤šçš„æ ¸æ•°ä¹‹é—´é€‰æ‹©ï¼Œé€‰æ‹©æ›´å¤šçš„æ ¸æ•°æ›´å¥½</strong>ã€‚å¤šä¸ªå†…æ ¸æä¾›çš„é¢å¤–å¹¶å‘è¿œèƒœè¿‡ç¨å¾®å¿«ä¸€ç‚¹ç‚¹çš„æ—¶é’Ÿé¢‘ç‡ã€‚</p>
<h3 id="å†…å­˜é…ç½®"><a href="#å†…å­˜é…ç½®" class="headerlink" title="å†…å­˜é…ç½®"></a>å†…å­˜é…ç½®</h3><p>å¦‚æœæœ‰ä¸€ç§èµ„æºæ˜¯æœ€å…ˆè¢«è€—å°½çš„ï¼Œå®ƒå¯èƒ½æ˜¯å†…å­˜ã€‚æ’åºå’Œèšåˆéƒ½å¾ˆè€—å†…å­˜ï¼Œæ‰€ä»¥æœ‰è¶³å¤Ÿçš„å †ç©ºé—´æ¥åº”ä»˜å®ƒä»¬æ˜¯å¾ˆé‡è¦çš„ã€‚å³ä½¿å †ç©ºé—´æ˜¯æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¸ºæ“ä½œç³»ç»Ÿæ–‡ä»¶ç¼“å­˜æä¾›é¢å¤–çš„å†…å­˜ã€‚å› ä¸º Lucene ä½¿ç”¨çš„è®¸å¤šæ•°æ®ç»“æ„æ˜¯åŸºäºç£ç›˜çš„æ ¼å¼ï¼ŒElasticsearch åˆ©ç”¨æ“ä½œç³»ç»Ÿç¼“å­˜èƒ½äº§ç”Ÿå¾ˆå¤§æ•ˆæœã€‚</p>
<p><strong>64 GB å†…å­˜çš„æœºå™¨æ˜¯éå¸¸ç†æƒ³çš„</strong>ï¼Œä½†æ˜¯ 32 GB å’Œ 16 GB æœºå™¨ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ã€‚å°‘äº 8 GB ä¼šé€‚å¾—å…¶åï¼ˆä½ æœ€ç»ˆéœ€è¦å¾ˆå¤šå¾ˆå¤šçš„å°æœºå™¨ï¼‰ï¼Œå¤§äº 64 GB çš„æœºå™¨ä¹Ÿä¼šæœ‰é—®é¢˜ã€‚</p>
<p>ç”±äº ES æ„å»ºåŸºäº luceneï¼Œè€Œ lucene è®¾è®¡å¼ºå¤§ä¹‹å¤„åœ¨äº lucene èƒ½å¤Ÿå¾ˆå¥½çš„åˆ©ç”¨æ“ä½œç³»ç»Ÿå†…å­˜æ¥ç¼“å­˜ç´¢å¼•æ•°æ®ï¼Œä»¥æä¾›å¿«é€Ÿçš„æŸ¥è¯¢æ€§èƒ½ã€‚lucene çš„ç´¢å¼•æ–‡ä»¶ segements æ˜¯å­˜å‚¨åœ¨å•æ–‡ä»¶ä¸­çš„ï¼Œå¹¶ä¸”ä¸å¯å˜ï¼Œå¯¹äº OS æ¥è¯´ï¼Œèƒ½å¤Ÿå¾ˆå‹å¥½åœ°å°†ç´¢å¼•æ–‡ä»¶ä¿æŒåœ¨ cache ä¸­ï¼Œä»¥ä¾¿å¿«é€Ÿè®¿é—®ï¼›å› æ­¤ï¼Œæˆ‘ä»¬å¾ˆæœ‰å¿…è¦å°†ä¸€åŠçš„ç‰©ç†å†…å­˜ç•™ç»™ luceneï¼›å¦ä¸€åŠçš„ç‰©ç†å†…å­˜ç•™ç»™ ESï¼ˆJVM heapï¼‰ã€‚</p>
<h4 id="å†…å­˜åˆ†é…"><a href="#å†…å­˜åˆ†é…" class="headerlink" title="å†…å­˜åˆ†é…"></a>å†…å­˜åˆ†é…</h4><p>å½“æœºå™¨å†…å­˜å°äº 64G æ—¶ï¼Œéµå¾ªé€šç”¨çš„åŸåˆ™ï¼Œ50% ç»™ ESï¼Œ50% ç•™ç»™ luceneã€‚</p>
<p>å½“æœºå™¨å†…å­˜å¤§äº 64G æ—¶ï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™ï¼š</p>
<ul>
<li>å¦‚æœä¸»è¦çš„ä½¿ç”¨åœºæ™¯æ˜¯å…¨æ–‡æ£€ç´¢ï¼Œé‚£ä¹ˆå»ºè®®ç»™ ES Heap åˆ†é… 4~32G çš„å†…å­˜å³å¯ï¼›å…¶å®ƒå†…å­˜ç•™ç»™æ“ä½œç³»ç»Ÿï¼Œä¾› lucene ä½¿ç”¨ï¼ˆsegments cacheï¼‰ï¼Œä»¥æä¾›æ›´å¿«çš„æŸ¥è¯¢æ€§èƒ½ã€‚</li>
<li>å¦‚æœä¸»è¦çš„ä½¿ç”¨åœºæ™¯æ˜¯èšåˆæˆ–æ’åºï¼Œå¹¶ä¸”å¤§å¤šæ•°æ˜¯ numericsï¼Œdatesï¼Œgeo_points ä»¥åŠ not_analyzed çš„å­—ç¬¦ç±»å‹ï¼Œå»ºè®®åˆ†é…ç»™ ES Heap åˆ†é… 4~32G çš„å†…å­˜å³å¯ï¼Œå…¶å®ƒå†…å­˜ç•™ç»™æ“ä½œç³»ç»Ÿï¼Œä¾› lucene ä½¿ç”¨ï¼Œæä¾›å¿«é€Ÿçš„åŸºäºæ–‡æ¡£çš„èšç±»ã€æ’åºæ€§èƒ½ã€‚</li>
<li>å¦‚æœä½¿ç”¨åœºæ™¯æ˜¯èšåˆæˆ–æ’åºï¼Œå¹¶ä¸”éƒ½æ˜¯åŸºäº analyzed å­—ç¬¦æ•°æ®ï¼Œè¿™æ—¶éœ€è¦æ›´å¤šçš„ heap sizeï¼Œå»ºè®®æœºå™¨ä¸Šè¿è¡Œå¤š ES å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹ä¿æŒä¸è¶…è¿‡ 50% çš„ ES heap è®¾ç½®ï¼ˆä½†ä¸è¶…è¿‡ 32 Gï¼Œå †å†…å­˜è®¾ç½® 32 G ä»¥ä¸‹æ—¶ï¼ŒJVM ä½¿ç”¨å¯¹è±¡æŒ‡æ ‡å‹ç¼©æŠ€å·§èŠ‚çœç©ºé—´ï¼‰ï¼Œ50% ä»¥ä¸Šç•™ç»™ luceneã€‚</li>
</ul>
<h4 id="ç¦æ­¢-swap"><a href="#ç¦æ­¢-swap" class="headerlink" title="ç¦æ­¢ swap"></a>ç¦æ­¢ swap</h4><p>ç¦æ­¢ swapï¼Œä¸€æ—¦å…è®¸å†…å­˜ä¸ç£ç›˜çš„äº¤æ¢ï¼Œä¼šå¼•èµ·è‡´å‘½çš„æ€§èƒ½é—®é¢˜ã€‚å¯ä»¥é€šè¿‡åœ¨ elasticsearch.yml ä¸­ <code>bootstrap.memory_lock: true</code>ï¼Œä»¥ä¿æŒ JVM é”å®šå†…å­˜ï¼Œä¿è¯ ES çš„æ€§èƒ½ã€‚</p>
<h4 id="GC-è®¾ç½®"><a href="#GC-è®¾ç½®" class="headerlink" title="GC è®¾ç½®"></a>GC è®¾ç½®</h4><p>ä¿æŒ GC çš„ç°æœ‰è®¾ç½®ï¼Œé»˜è®¤è®¾ç½®ä¸ºï¼šConcurrent-Mark and Sweepï¼ˆCMSï¼‰ï¼Œåˆ«æ¢æˆ G1 GCï¼Œå› ä¸ºç›®å‰ G1 è¿˜æœ‰å¾ˆå¤š BUGã€‚</p>
<p>ä¿æŒçº¿ç¨‹æ± çš„ç°æœ‰è®¾ç½®ï¼Œç›®å‰ ES çš„çº¿ç¨‹æ± è¾ƒ 1.X æœ‰äº†è¾ƒå¤šä¼˜åŒ–è®¾ç½®ï¼Œä¿æŒç°çŠ¶å³å¯ï¼›é»˜è®¤çº¿ç¨‹æ± å¤§å°ç­‰äº CPU æ ¸å¿ƒæ•°ã€‚å¦‚æœä¸€å®šè¦æ”¹ï¼ŒæŒ‰å…¬å¼ ( ( CPU æ ¸å¿ƒæ•° * 3 ) &#x2F; 2 ) + 1 è®¾ç½®ï¼›ä¸èƒ½è¶…è¿‡ CPU æ ¸å¿ƒæ•°çš„ 2 å€ï¼›ä½†æ˜¯ä¸å»ºè®®ä¿®æ”¹é»˜è®¤é…ç½®ï¼Œå¦åˆ™ä¼šå¯¹ CPU é€ æˆç¡¬ä¼¤ã€‚</p>
<h3 id="ç£ç›˜"><a href="#ç£ç›˜" class="headerlink" title="ç£ç›˜"></a>ç£ç›˜</h3><p>ç¡¬ç›˜å¯¹æ‰€æœ‰çš„é›†ç¾¤éƒ½å¾ˆé‡è¦ï¼Œå¯¹å¤§é‡å†™å…¥çš„é›†ç¾¤æ›´æ˜¯åŠ å€é‡è¦ï¼ˆä¾‹å¦‚é‚£äº›å­˜å‚¨æ—¥å¿—æ•°æ®çš„ï¼‰ã€‚ç¡¬ç›˜æ˜¯æœåŠ¡å™¨ä¸Šæœ€æ…¢çš„å­ç³»ç»Ÿï¼Œè¿™æ„å‘³ç€é‚£äº›å†™å…¥é‡å¾ˆå¤§çš„é›†ç¾¤å¾ˆå®¹æ˜“è®©ç¡¬ç›˜é¥±å’Œï¼Œä½¿å¾—å®ƒæˆä¸ºé›†ç¾¤çš„ç“¶é¢ˆã€‚</p>
<p><strong>åœ¨ç»æµå‹åŠ›èƒ½æ‰¿å—çš„èŒƒå›´ä¸‹ï¼Œå°½é‡ä½¿ç”¨å›ºæ€ç¡¬ç›˜ï¼ˆSSDï¼‰</strong>ã€‚å›ºæ€ç¡¬ç›˜ç›¸æ¯”äºä»»ä½•æ—‹è½¬ä»‹è´¨ï¼ˆæœºæ¢°ç¡¬ç›˜ï¼Œç£å¸¦ç­‰ï¼‰ï¼Œæ— è®ºéšæœºå†™è¿˜æ˜¯é¡ºåºå†™ï¼Œéƒ½ä¼šå¯¹ IO æœ‰è¾ƒå¤§çš„æå‡ã€‚</p>
<blockquote>
<p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ SSDsï¼Œç¡®ä¿ä½ çš„ç³»ç»Ÿ I&#x2F;O è°ƒåº¦ç¨‹åºæ˜¯é…ç½®æ­£ç¡®çš„ã€‚å½“ä½ å‘ç¡¬ç›˜å†™æ•°æ®ï¼ŒI&#x2F;O è°ƒåº¦ç¨‹åºå†³å®šä½•æ—¶æŠŠæ•°æ®å®é™…å‘é€åˆ°ç¡¬ç›˜ã€‚å¤§å¤šæ•°é»˜è®¤ *nix å‘è¡Œç‰ˆä¸‹çš„è°ƒåº¦ç¨‹åºéƒ½å«åš cfqï¼ˆå®Œå…¨å…¬å¹³é˜Ÿåˆ—ï¼‰ã€‚</p>
<p>è°ƒåº¦ç¨‹åºåˆ†é…æ—¶é—´ç‰‡åˆ°æ¯ä¸ªè¿›ç¨‹ã€‚å¹¶ä¸”ä¼˜åŒ–è¿™äº›åˆ°ç¡¬ç›˜çš„ä¼—å¤šé˜Ÿåˆ—çš„ä¼ é€’ã€‚ä½†å®ƒæ˜¯ä¸ºæ—‹è½¬ä»‹è´¨ä¼˜åŒ–çš„ï¼šæœºæ¢°ç¡¬ç›˜çš„å›ºæœ‰ç‰¹æ€§æ„å‘³ç€å®ƒå†™å…¥æ•°æ®åˆ°åŸºäºç‰©ç†å¸ƒå±€çš„ç¡¬ç›˜ä¼šæ›´é«˜æ•ˆã€‚</p>
<p>è¿™å¯¹ SSD æ¥è¯´æ˜¯ä½æ•ˆçš„ï¼Œå°½ç®¡è¿™é‡Œæ²¡æœ‰æ¶‰åŠåˆ°æœºæ¢°ç¡¬ç›˜ã€‚ä½†æ˜¯ï¼Œdeadline æˆ–è€… noop åº”è¯¥è¢«ä½¿ç”¨ã€‚deadline è°ƒåº¦ç¨‹åºåŸºäºå†™å…¥ç­‰å¾…æ—¶é—´è¿›è¡Œä¼˜åŒ–ï¼Œnoop åªæ˜¯ä¸€ä¸ªç®€å•çš„ FIFO é˜Ÿåˆ—ã€‚</p>
<p>è¿™ä¸ªç®€å•çš„æ›´æ”¹å¯ä»¥å¸¦æ¥æ˜¾è‘—çš„å½±å“ã€‚ä»…ä»…æ˜¯ä½¿ç”¨æ­£ç¡®çš„è°ƒåº¦ç¨‹åºï¼Œæˆ‘ä»¬çœ‹åˆ°äº† 500 å€çš„å†™å…¥èƒ½åŠ›æå‡ã€‚</p>
</blockquote>
<p><strong>å¦‚æœä½ ä½¿ç”¨æ—‹è½¬ä»‹è´¨ï¼ˆå¦‚æœºæ¢°ç¡¬ç›˜ï¼‰ï¼Œå°è¯•è·å–å°½å¯èƒ½å¿«çš„ç¡¬ç›˜ï¼ˆé«˜æ€§èƒ½æœåŠ¡å™¨ç¡¬ç›˜ï¼Œ15k RPM é©±åŠ¨å™¨ï¼‰</strong>ã€‚</p>
<p><strong>ä½¿ç”¨ RAID0 æ˜¯æé«˜ç¡¬ç›˜é€Ÿåº¦çš„æœ‰æ•ˆé€”å¾„ï¼Œå¯¹æœºæ¢°ç¡¬ç›˜å’Œ SSD æ¥è¯´éƒ½æ˜¯å¦‚æ­¤</strong>ã€‚æ²¡æœ‰å¿…è¦ä½¿ç”¨é•œåƒæˆ–å…¶å®ƒ RAID å˜ä½“ï¼Œå› ä¸º Elasticsearch åœ¨è‡ªèº«å±‚é¢é€šè¿‡å‰¯æœ¬ï¼Œå·²ç»æä¾›äº†å¤‡ä»½çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸éœ€è¦åˆ©ç”¨ç£ç›˜çš„å¤‡ä»½åŠŸèƒ½ï¼ŒåŒæ—¶å¦‚æœä½¿ç”¨ç£ç›˜å¤‡ä»½åŠŸèƒ½çš„è¯ï¼Œå¯¹å†™å…¥é€Ÿåº¦æœ‰è¾ƒå¤§çš„å½±å“ã€‚</p>
<p><strong>æœ€åï¼Œé¿å…ä½¿ç”¨ç½‘ç»œé™„åŠ å­˜å‚¨ï¼ˆNASï¼‰</strong>ã€‚äººä»¬å¸¸å£°ç§°ä»–ä»¬çš„ NAS è§£å†³æ–¹æ¡ˆæ¯”æœ¬åœ°é©±åŠ¨å™¨æ›´å¿«æ›´å¯é ã€‚é™¤å´è¿™äº›å£°ç§°ï¼Œæˆ‘ä»¬ä»æ²¡çœ‹åˆ° NAS èƒ½é…å¾—ä¸Šå®ƒçš„å¤§è‚†å®£ä¼ ã€‚NAS å¸¸å¸¸å¾ˆæ…¢ï¼Œæ˜¾éœ²å‡ºæ›´å¤§çš„å»¶æ—¶å’Œæ›´å®½çš„å¹³å‡å»¶æ—¶æ–¹å·®ï¼Œè€Œä¸”å®ƒæ˜¯å•ç‚¹æ•…éšœçš„ã€‚</p>
<h2 id="ç´¢å¼•ä¼˜åŒ–è®¾ç½®"><a href="#ç´¢å¼•ä¼˜åŒ–è®¾ç½®" class="headerlink" title="ç´¢å¼•ä¼˜åŒ–è®¾ç½®"></a>ç´¢å¼•ä¼˜åŒ–è®¾ç½®</h2><p>ç´¢å¼•ä¼˜åŒ–ä¸»è¦æ˜¯åœ¨ Elasticsearch çš„æ’å…¥å±‚é¢ä¼˜åŒ–ï¼ŒElasticsearch æœ¬èº«ç´¢å¼•é€Ÿåº¦å…¶å®è¿˜æ˜¯è›®å¿«çš„ï¼Œå…·ä½“æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒå®˜æ–¹çš„ benchmark æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒçš„éœ€æ±‚ï¼Œé’ˆå¯¹ç´¢å¼•ä¼˜åŒ–ã€‚</p>
<h3 id="æ‰¹é‡æäº¤"><a href="#æ‰¹é‡æäº¤" class="headerlink" title="æ‰¹é‡æäº¤"></a>æ‰¹é‡æäº¤</h3><p>å½“æœ‰å¤§é‡æ•°æ®æäº¤çš„æ—¶å€™ï¼Œå»ºè®®é‡‡ç”¨æ‰¹é‡æäº¤ï¼ˆBulk æ“ä½œï¼‰ï¼›æ­¤å¤–ä½¿ç”¨ bulk è¯·æ±‚æ—¶ï¼Œæ¯ä¸ªè¯·æ±‚ä¸è¶…è¿‡å‡ å Mï¼Œå› ä¸ºå¤ªå¤§ä¼šå¯¼è‡´å†…å­˜ä½¿ç”¨è¿‡å¤§ã€‚</p>
<p>æ¯”å¦‚åœ¨åš ELK è¿‡ç¨‹ä¸­ï¼ŒLogstash indexer æäº¤æ•°æ®åˆ° Elasticsearch ä¸­ï¼Œbatch size å°±å¯ä»¥ä½œä¸ºä¸€ä¸ªä¼˜åŒ–åŠŸèƒ½ç‚¹ã€‚ä½†æ˜¯ä¼˜åŒ– size å¤§å°éœ€è¦æ ¹æ®æ–‡æ¡£å¤§å°å’ŒæœåŠ¡å™¨æ€§èƒ½è€Œå®šã€‚</p>
<p>åƒ Logstash ä¸­æäº¤æ–‡æ¡£å¤§å°è¶…è¿‡ 20MBï¼ŒLogstash ä¼šå°†ä¸€ä¸ªæ‰¹é‡è¯·æ±‚åˆ‡åˆ†ä¸ºå¤šä¸ªæ‰¹é‡è¯·æ±‚ã€‚</p>
<p>å¦‚æœåœ¨æäº¤è¿‡ç¨‹ä¸­ï¼Œé‡åˆ° EsRejectedExecutionException å¼‚å¸¸çš„è¯ï¼Œåˆ™è¯´æ˜é›†ç¾¤çš„ç´¢å¼•æ€§èƒ½å·²ç»è¾¾åˆ°æé™äº†ã€‚è¿™ç§æƒ…å†µï¼Œè¦ä¹ˆæé«˜æœåŠ¡å™¨é›†ç¾¤çš„èµ„æºï¼Œè¦ä¹ˆæ ¹æ®ä¸šåŠ¡è§„åˆ™ï¼Œå‡å°‘æ•°æ®æ”¶é›†é€Ÿåº¦ï¼Œæ¯”å¦‚åªæ”¶é›† Warnã€Error çº§åˆ«ä»¥ä¸Šçš„æ—¥å¿—ã€‚</p>
<h3 id="å¢åŠ -Refresh-æ—¶é—´é—´éš”"><a href="#å¢åŠ -Refresh-æ—¶é—´é—´éš”" class="headerlink" title="å¢åŠ  Refresh æ—¶é—´é—´éš”"></a>å¢åŠ  Refresh æ—¶é—´é—´éš”</h3><p>ä¸ºäº†æé«˜ç´¢å¼•æ€§èƒ½ï¼ŒElasticsearch åœ¨å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œé‡‡ç”¨å»¶è¿Ÿå†™å…¥çš„ç­–ç•¥ï¼Œå³æ•°æ®å…ˆå†™åˆ°å†…å­˜ä¸­ï¼Œå½“è¶…è¿‡é»˜è®¤ 1 ç§’ï¼ˆindex.refresh_intervalï¼‰ä¼šè¿›è¡Œä¸€æ¬¡å†™å…¥æ“ä½œï¼Œå°±æ˜¯å°†å†…å­˜ä¸­ segment æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œæ­¤æ—¶æˆ‘ä»¬æ‰èƒ½å°†æ•°æ®æœç´¢å‡ºæ¥ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Elasticsearch æä¾›çš„æ˜¯è¿‘å®æ—¶æœç´¢åŠŸèƒ½ï¼Œè€Œä¸æ˜¯å®æ—¶æœç´¢åŠŸèƒ½ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿå¯¹æ•°æ®å»¶è¿Ÿè¦æ±‚ä¸é«˜çš„è¯ï¼Œæˆ‘ä»¬<strong>å¯ä»¥é€šè¿‡å»¶é•¿ refresh æ—¶é—´é—´éš”ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å‡å°‘ segment åˆå¹¶å‹åŠ›ï¼Œæé«˜ç´¢å¼•é€Ÿåº¦</strong>ã€‚æ¯”å¦‚åœ¨åšå…¨é“¾è·¯è·Ÿè¸ªçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°±å°† <code>index.refresh_interval</code> è®¾ç½®ä¸º 30sï¼Œå‡å°‘ refresh æ¬¡æ•°ã€‚å†å¦‚ï¼Œåœ¨è¿›è¡Œå…¨é‡ç´¢å¼•æ—¶ï¼Œå¯ä»¥å°† refresh æ¬¡æ•°ä¸´æ—¶å…³é—­ï¼Œå³ <code>index.refresh_interval</code> è®¾ç½®ä¸º-1ï¼Œæ•°æ®å¯¼å…¥æˆåŠŸåå†æ‰“å¼€åˆ°æ­£å¸¸æ¨¡å¼ï¼Œæ¯”å¦‚ 30sã€‚</p>
<blockquote>
<p>åœ¨åŠ è½½å¤§é‡æ•°æ®æ—¶å€™å¯ä»¥æš‚æ—¶ä¸ç”¨ refresh å’Œ repliccasï¼Œindex.refresh_interval è®¾ç½®ä¸º-1ï¼Œindex.number_of_replicas è®¾ç½®ä¸º 0ã€‚</p>
</blockquote>
<h3 id="ä¿®æ”¹-index-buffer-size-çš„è®¾ç½®"><a href="#ä¿®æ”¹-index-buffer-size-çš„è®¾ç½®" class="headerlink" title="ä¿®æ”¹ index_buffer_size çš„è®¾ç½®"></a>ä¿®æ”¹ index_buffer_size çš„è®¾ç½®</h3><p>ç´¢å¼•ç¼“å†²çš„è®¾ç½®å¯ä»¥æ§åˆ¶å¤šå°‘å†…å­˜åˆ†é…ç»™ç´¢å¼•è¿›ç¨‹ã€‚è¿™æ˜¯ä¸€ä¸ªå…¨å±€é…ç½®ï¼Œä¼šåº”ç”¨äºä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ‰€æœ‰ä¸åŒçš„åˆ†ç‰‡ä¸Šã€‚</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">indices.memory.index_buffer_size:</span> <span class="number">10</span><span class="string">%</span></span><br><span class="line"><span class="attr">indices.memory.min_index_buffer_size:</span> <span class="string">48mb</span></span><br></pre></td></tr></table></figure>

<p><code>indices.memory.index_buffer_size</code> æ¥å—ä¸€ä¸ªç™¾åˆ†æ¯”æˆ–è€…ä¸€ä¸ªè¡¨ç¤ºå­—èŠ‚å¤§å°çš„å€¼ã€‚é»˜è®¤æ˜¯ 10%ï¼Œæ„å‘³ç€åˆ†é…ç»™èŠ‚ç‚¹çš„æ€»å†…å­˜çš„ 10%ç”¨æ¥åšç´¢å¼•ç¼“å†²çš„å¤§å°ã€‚è¿™ä¸ªæ•°å€¼è¢«åˆ†åˆ°ä¸åŒçš„åˆ†ç‰‡ï¼ˆshardsï¼‰ä¸Šã€‚å¦‚æœè®¾ç½®çš„æ˜¯ç™¾åˆ†æ¯”ï¼Œè¿˜å¯ä»¥è®¾ç½® <code>min_index_buffer_size</code> ï¼ˆé»˜è®¤ 48mbï¼‰å’Œ <code>max_index_buffer_size</code>ï¼ˆé»˜è®¤æ²¡æœ‰ä¸Šé™ï¼‰ã€‚</p>
<h3 id="ä¿®æ”¹-translog-ç›¸å…³çš„è®¾ç½®"><a href="#ä¿®æ”¹-translog-ç›¸å…³çš„è®¾ç½®" class="headerlink" title="ä¿®æ”¹ translog ç›¸å…³çš„è®¾ç½®"></a>ä¿®æ”¹ translog ç›¸å…³çš„è®¾ç½®</h3><p>ä¸€æ˜¯æ§åˆ¶æ•°æ®ä»å†…å­˜åˆ°ç¡¬ç›˜çš„æ“ä½œé¢‘ç‡ï¼Œä»¥å‡å°‘ç¡¬ç›˜ IOã€‚å¯å°† sync_interval çš„æ—¶é—´è®¾ç½®å¤§ä¸€äº›ã€‚é»˜è®¤ä¸º 5sã€‚</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">index.translog.sync_interval:</span> <span class="string">5s</span></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥æ§åˆ¶ tranlog æ•°æ®å—çš„å¤§å°ï¼Œè¾¾åˆ° threshold å¤§å°æ—¶ï¼Œæ‰ä¼š flush åˆ° lucene ç´¢å¼•æ–‡ä»¶ã€‚é»˜è®¤ä¸º 512mã€‚</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">index.translog.flush_threshold_size:</span> <span class="string">512mb</span></span><br></pre></td></tr></table></figure>

<h3 id="æ³¨æ„-id-å­—æ®µçš„ä½¿ç”¨"><a href="#æ³¨æ„-id-å­—æ®µçš„ä½¿ç”¨" class="headerlink" title="æ³¨æ„ _id å­—æ®µçš„ä½¿ç”¨"></a>æ³¨æ„ _id å­—æ®µçš„ä½¿ç”¨</h3><p>_id å­—æ®µçš„ä½¿ç”¨ï¼Œåº”å°½å¯èƒ½é¿å…è‡ªå®šä¹‰ _idï¼Œä»¥é¿å…é’ˆå¯¹ ID çš„ç‰ˆæœ¬ç®¡ç†ï¼›å»ºè®®ä½¿ç”¨ ES çš„é»˜è®¤ ID ç”Ÿæˆç­–ç•¥æˆ–ä½¿ç”¨æ•°å­—ç±»å‹ ID åšä¸ºä¸»é”®ã€‚</p>
<h3 id="æ³¨æ„-all-å­—æ®µåŠ-source-å­—æ®µçš„ä½¿ç”¨"><a href="#æ³¨æ„-all-å­—æ®µåŠ-source-å­—æ®µçš„ä½¿ç”¨" class="headerlink" title="æ³¨æ„ _all å­—æ®µåŠ _source å­—æ®µçš„ä½¿ç”¨"></a>æ³¨æ„ _all å­—æ®µåŠ _source å­—æ®µçš„ä½¿ç”¨</h3><p>**_**all å­—æ®µåŠ _source å­—æ®µçš„ä½¿ç”¨ï¼Œåº”è¯¥æ³¨æ„åœºæ™¯å’Œéœ€è¦ï¼Œ_all å­—æ®µåŒ…å«äº†æ‰€æœ‰çš„ç´¢å¼•å­—æ®µï¼Œæ–¹ä¾¿åšå…¨æ–‡æ£€ç´¢ï¼Œå¦‚æœæ— æ­¤éœ€æ±‚ï¼Œå¯ä»¥ç¦ç”¨ï¼›_source å­˜å‚¨äº†åŸå§‹çš„ document å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰è·å–åŸå§‹æ–‡æ¡£æ•°æ®çš„éœ€æ±‚ï¼Œå¯é€šè¿‡è®¾ç½® includesã€excludes å±æ€§æ¥å®šä¹‰æ”¾å…¥ _source çš„å­—æ®µã€‚</p>
<h3 id="åˆç†çš„é…ç½®ä½¿ç”¨-index-å±æ€§"><a href="#åˆç†çš„é…ç½®ä½¿ç”¨-index-å±æ€§" class="headerlink" title="åˆç†çš„é…ç½®ä½¿ç”¨ index å±æ€§"></a>åˆç†çš„é…ç½®ä½¿ç”¨ index å±æ€§</h3><p>åˆç†çš„é…ç½®ä½¿ç”¨ index å±æ€§ï¼Œanalyzed å’Œ not_analyzedï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚æ¥æ§åˆ¶å­—æ®µæ˜¯å¦åˆ†è¯æˆ–ä¸åˆ†è¯ã€‚åªæœ‰ groupby éœ€æ±‚çš„å­—æ®µï¼Œé…ç½®æ—¶å°±è®¾ç½®æˆ not_analyzedï¼Œä»¥æé«˜æŸ¥è¯¢æˆ–èšç±»çš„æ•ˆç‡ã€‚</p>
<h3 id="å‡å°‘å‰¯æœ¬æ•°é‡"><a href="#å‡å°‘å‰¯æœ¬æ•°é‡" class="headerlink" title="å‡å°‘å‰¯æœ¬æ•°é‡"></a>å‡å°‘å‰¯æœ¬æ•°é‡</h3><p>Elasticsearch é»˜è®¤å‰¯æœ¬æ•°é‡ä¸º 3 ä¸ªï¼Œè™½ç„¶è¿™æ ·ä¼šæé«˜é›†ç¾¤çš„å¯ç”¨æ€§ï¼Œå¢åŠ æœç´¢çš„å¹¶å‘æ•°ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿä¼šå½±å“å†™å…¥ç´¢å¼•çš„æ•ˆç‡ã€‚</p>
<p>åœ¨ç´¢å¼•è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æŠŠæ›´æ–°çš„æ–‡æ¡£å‘åˆ°å‰¯æœ¬èŠ‚ç‚¹ä¸Šï¼Œç­‰å‰¯æœ¬èŠ‚ç‚¹ç”Ÿæ•ˆååœ¨è¿›è¡Œè¿”å›ç»“æŸã€‚ä½¿ç”¨ Elasticsearch åšä¸šåŠ¡æœç´¢çš„æ—¶å€™ï¼Œå»ºè®®å‰¯æœ¬æ•°ç›®è¿˜æ˜¯è®¾ç½®ä¸º 3 ä¸ªï¼Œä½†æ˜¯åƒå†…éƒ¨ ELK æ—¥å¿—ç³»ç»Ÿã€åˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿä¸­ï¼Œå®Œå…¨å¯ä»¥å°†å‰¯æœ¬æ•°ç›®è®¾ç½®ä¸º 1 ä¸ªã€‚</p>
<h2 id="æŸ¥è¯¢æ–¹é¢ä¼˜åŒ–"><a href="#æŸ¥è¯¢æ–¹é¢ä¼˜åŒ–" class="headerlink" title="æŸ¥è¯¢æ–¹é¢ä¼˜åŒ–"></a>æŸ¥è¯¢æ–¹é¢ä¼˜åŒ–</h2><p>Elasticsearch ä½œä¸ºä¸šåŠ¡æœç´¢çš„è¿‘å®æ—¶æŸ¥è¯¢æ—¶ï¼ŒæŸ¥è¯¢æ•ˆç‡çš„ä¼˜åŒ–æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚</p>
<h3 id="è·¯ç”±ä¼˜åŒ–"><a href="#è·¯ç”±ä¼˜åŒ–" class="headerlink" title="è·¯ç”±ä¼˜åŒ–"></a>è·¯ç”±ä¼˜åŒ–</h3><p>å½“æˆ‘ä»¬æŸ¥è¯¢æ–‡æ¡£çš„æ—¶å€™ï¼ŒElasticsearch å¦‚ä½•çŸ¥é“ä¸€ä¸ªæ–‡æ¡£åº”è¯¥å­˜æ”¾åˆ°å“ªä¸ªåˆ†ç‰‡ä¸­å‘¢ï¼Ÿå®ƒå…¶å®æ˜¯é€šè¿‡ä¸‹é¢è¿™ä¸ªå…¬å¼æ¥è®¡ç®—å‡ºæ¥çš„ã€‚</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">shard</span> <span class="operator">=</span> hash(routing) % number_of_primary_shards</span><br></pre></td></tr></table></figure>

<p>routing é»˜è®¤å€¼æ˜¯æ–‡æ¡£çš„ idï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨è‡ªå®šä¹‰å€¼ï¼Œæ¯”å¦‚ç”¨æˆ· IDã€‚</p>
<h4 id="ä¸å¸¦-routing-æŸ¥è¯¢"><a href="#ä¸å¸¦-routing-æŸ¥è¯¢" class="headerlink" title="ä¸å¸¦ routing æŸ¥è¯¢"></a>ä¸å¸¦ routing æŸ¥è¯¢</h4><p>åœ¨æŸ¥è¯¢çš„æ—¶å€™å› ä¸ºä¸çŸ¥é“è¦æŸ¥è¯¢çš„æ•°æ®å…·ä½“åœ¨å“ªä¸ªåˆ†ç‰‡ä¸Šï¼Œæ‰€ä»¥æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸º 2 ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>åˆ†å‘ï¼šè¯·æ±‚åˆ°è¾¾åè°ƒèŠ‚ç‚¹åï¼Œåè°ƒèŠ‚ç‚¹å°†æŸ¥è¯¢è¯·æ±‚åˆ†å‘åˆ°æ¯ä¸ªåˆ†ç‰‡ä¸Šã€‚</li>
<li>èšåˆï¼šåè°ƒèŠ‚ç‚¹æœé›†åˆ°æ¯ä¸ªåˆ†ç‰‡ä¸ŠæŸ¥è¯¢ç»“æœï¼Œå†å°†æŸ¥è¯¢çš„ç»“æœè¿›è¡Œæ’åºï¼Œä¹‹åç»™ç”¨æˆ·è¿”å›ç»“æœã€‚</li>
</ol>
<h4 id="å¸¦-routing-æŸ¥è¯¢"><a href="#å¸¦-routing-æŸ¥è¯¢" class="headerlink" title="å¸¦ routing æŸ¥è¯¢"></a>å¸¦ routing æŸ¥è¯¢</h4><p>æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥æ ¹æ® routing ä¿¡æ¯å®šä½åˆ°æŸä¸ªåˆ†é…æŸ¥è¯¢ï¼Œä¸éœ€è¦æŸ¥è¯¢æ‰€æœ‰çš„åˆ†é…ï¼Œç»è¿‡åè°ƒèŠ‚ç‚¹æ’åºã€‚</p>
<p>å‘ä¸Šé¢è‡ªå®šä¹‰çš„ç”¨æˆ·æŸ¥è¯¢ï¼Œå¦‚æœ routing è®¾ç½®ä¸º userid çš„è¯ï¼Œå°±å¯ä»¥ç›´æ¥æŸ¥è¯¢å‡ºæ•°æ®æ¥ï¼Œæ•ˆç‡æå‡å¾ˆå¤šã€‚</p>
<h3 id="Filter-VS-Query"><a href="#Filter-VS-Query" class="headerlink" title="Filter VS Query"></a>Filter VS Query</h3><p>å°½å¯èƒ½ä½¿ç”¨è¿‡æ»¤å™¨ä¸Šä¸‹æ–‡ï¼ˆFilterï¼‰æ›¿ä»£æŸ¥è¯¢ä¸Šä¸‹æ–‡ï¼ˆQueryï¼‰</p>
<ul>
<li>Queryï¼šæ­¤æ–‡æ¡£ä¸æ­¤æŸ¥è¯¢å­å¥çš„åŒ¹é…ç¨‹åº¦å¦‚ä½•ï¼Ÿ</li>
<li>Filterï¼šæ­¤æ–‡æ¡£å’ŒæŸ¥è¯¢å­å¥åŒ¹é…å—ï¼Ÿ</li>
</ul>
<p>Elasticsearch é’ˆå¯¹ Filter æŸ¥è¯¢åªéœ€è¦å›ç­”ã€Œæ˜¯ã€æˆ–è€…ã€Œå¦ã€ï¼Œä¸éœ€è¦åƒ Query æŸ¥è¯¢ä¸€æ ·è®¡ç®—ç›¸å…³æ€§åˆ†æ•°ï¼ŒåŒæ—¶ Filter ç»“æœå¯ä»¥ç¼“å­˜ã€‚</p>
<h3 id="æ·±åº¦ç¿»é¡µ"><a href="#æ·±åº¦ç¿»é¡µ" class="headerlink" title="æ·±åº¦ç¿»é¡µ"></a>æ·±åº¦ç¿»é¡µ</h3><p>åœ¨ä½¿ç”¨ Elasticsearch è¿‡ç¨‹ä¸­ï¼Œåº”å°½é‡é¿å…å¤§ç¿»é¡µçš„å‡ºç°ã€‚</p>
<p>æ­£å¸¸ç¿»é¡µæŸ¥è¯¢éƒ½æ˜¯ä» from å¼€å§‹ size æ¡æ•°æ®ï¼Œè¿™æ ·å°±éœ€è¦åœ¨æ¯ä¸ªåˆ†ç‰‡ä¸­æŸ¥è¯¢æ‰“åˆ†æ’ååœ¨å‰é¢çš„ from+size æ¡æ•°æ®ã€‚ååŒèŠ‚ç‚¹æ”¶é›†æ¯ä¸ªåˆ†é…çš„å‰ from+size æ¡æ•°æ®ã€‚ååŒèŠ‚ç‚¹ä¸€å…±ä¼šå—åˆ° N*(from+size) æ¡æ•°æ®ï¼Œç„¶åè¿›è¡Œæ’åºï¼Œå†å°†å…¶ä¸­ from åˆ° from+size æ¡æ•°æ®è¿”å›å‡ºå»ã€‚å¦‚æœ from æˆ–è€… size å¾ˆå¤§çš„è¯ï¼Œå¯¼è‡´å‚åŠ æ’åºçš„æ•°é‡ä¼šåŒæ­¥æ‰©å¤§å¾ˆå¤šï¼Œæœ€ç»ˆä¼šå¯¼è‡´ CPU èµ„æºæ¶ˆè€—å¢å¤§ã€‚</p>
<p>å¯ä»¥é€šè¿‡ä½¿ç”¨ Elasticsearch scroll å’Œ scroll-scan é«˜æ•ˆæ»šåŠ¨çš„æ–¹å¼æ¥è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚</p>
<p>ä¹Ÿå¯ä»¥ç»“åˆå®é™…ä¸šåŠ¡ç‰¹ç‚¹ï¼Œæ–‡æ¡£ id å¤§å°å¦‚æœå’Œæ–‡æ¡£åˆ›å»ºæ—¶é—´æ˜¯ä¸€è‡´æœ‰åºçš„ï¼Œå¯ä»¥ä»¥æ–‡æ¡£ id ä½œä¸ºåˆ†é¡µçš„åç§»é‡ï¼Œå¹¶å°†å…¶ä½œä¸ºåˆ†é¡µæŸ¥è¯¢çš„ä¸€ä¸ªæ¡ä»¶ã€‚</p>
<h3 id="è„šæœ¬ï¼ˆscriptï¼‰åˆç†ä½¿ç”¨"><a href="#è„šæœ¬ï¼ˆscriptï¼‰åˆç†ä½¿ç”¨" class="headerlink" title="è„šæœ¬ï¼ˆscriptï¼‰åˆç†ä½¿ç”¨"></a>è„šæœ¬ï¼ˆscriptï¼‰åˆç†ä½¿ç”¨</h3><p>æˆ‘ä»¬çŸ¥é“è„šæœ¬ä½¿ç”¨ä¸»è¦æœ‰ 3 ç§å½¢å¼ï¼Œå†…è”åŠ¨æ€ç¼–è¯‘æ–¹å¼ã€_script ç´¢å¼•åº“ä¸­å­˜å‚¨å’Œæ–‡ä»¶è„šæœ¬å­˜å‚¨çš„å½¢å¼ï¼›ä¸€èˆ¬è„šæœ¬çš„ä½¿ç”¨åœºæ™¯æ˜¯ç²—æ’ï¼Œå°½é‡ç”¨ç¬¬äºŒç§æ–¹å¼å…ˆå°†è„šæœ¬å­˜å‚¨åœ¨ _script ç´¢å¼•åº“ä¸­ï¼Œèµ·åˆ°æå‰ç¼–è¯‘ï¼Œç„¶åé€šè¿‡å¼•ç”¨è„šæœ¬ idï¼Œå¹¶ç»“åˆ params å‚æ•°ä½¿ç”¨ï¼Œå³å¯ä»¥è¾¾åˆ°æ¨¡å‹ï¼ˆé€»è¾‘ï¼‰å’Œæ•°æ®è¿›è¡Œäº†åˆ†ç¦»ï¼ŒåŒæ—¶åˆä¾¿äºè„šæœ¬æ¨¡å—çš„æ‰©å±•ä¸ç»´æŠ¤ã€‚å…·ä½“ ES è„šæœ¬çš„æ·±å…¥å†…å®¹è¯·å‚è€ƒ <a target="_blank" rel="noopener" href="https://www.knowledgedict.com/tutorial/elasticsearch-script.html">Elasticsearch è„šæœ¬æ¨¡å—çš„è¯¦è§£</a>ã€‚</p>
<h2 id="æ•°æ®ç»“æ„ä¼˜åŒ–"><a href="#æ•°æ®ç»“æ„ä¼˜åŒ–" class="headerlink" title="æ•°æ®ç»“æ„ä¼˜åŒ–"></a>æ•°æ®ç»“æ„ä¼˜åŒ–</h2><p>åŸºäº Elasticsearch çš„ä½¿ç”¨åœºæ™¯ï¼Œæ–‡æ¡£æ•°æ®ç»“æ„å°½é‡å’Œä½¿ç”¨åœºæ™¯è¿›è¡Œç»“åˆï¼Œå»æ‰æ²¡ç”¨åŠä¸åˆç†çš„æ•°æ®ã€‚</p>
<h3 id="å°½é‡å‡å°‘ä¸éœ€è¦çš„å­—æ®µ"><a href="#å°½é‡å‡å°‘ä¸éœ€è¦çš„å­—æ®µ" class="headerlink" title="å°½é‡å‡å°‘ä¸éœ€è¦çš„å­—æ®µ"></a>å°½é‡å‡å°‘ä¸éœ€è¦çš„å­—æ®µ</h3><p>å¦‚æœ Elasticsearch ç”¨äºä¸šåŠ¡æœç´¢æœåŠ¡ï¼Œä¸€äº›ä¸éœ€è¦ç”¨äºæœç´¢çš„å­—æ®µæœ€å¥½ä¸å­˜åˆ° ES ä¸­ï¼Œè¿™æ ·å³èŠ‚çœç©ºé—´ï¼ŒåŒæ—¶åœ¨ç›¸åŒçš„æ•°æ®é‡ä¸‹ï¼Œä¹Ÿèƒ½æé«˜æœç´¢æ€§èƒ½ã€‚</p>
<p>é¿å…ä½¿ç”¨åŠ¨æ€å€¼ä½œå­—æ®µï¼ŒåŠ¨æ€é€’å¢çš„ mappingï¼Œä¼šå¯¼è‡´é›†ç¾¤å´©æºƒï¼›åŒæ ·ï¼Œä¹Ÿéœ€è¦æ§åˆ¶å­—æ®µçš„æ•°é‡ï¼Œä¸šåŠ¡ä¸­ä¸ä½¿ç”¨çš„å­—æ®µï¼Œå°±ä¸è¦ç´¢å¼•ã€‚æ§åˆ¶ç´¢å¼•çš„å­—æ®µæ•°é‡ã€mapping æ·±åº¦ã€ç´¢å¼•å­—æ®µçš„ç±»å‹ï¼Œå¯¹äº ES çš„æ€§èƒ½ä¼˜åŒ–æ˜¯é‡ä¸­ä¹‹é‡ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ ES å…³äºå­—æ®µæ•°ã€mapping æ·±åº¦çš„ä¸€äº›é»˜è®¤è®¾ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">index.mapping.nested_objects.limit:</span> <span class="number">10000</span></span><br><span class="line"><span class="attr">index.mapping.total_fields.limit:</span> <span class="number">1000</span></span><br><span class="line"><span class="attr">index.mapping.depth.limit:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure>

<h3 id="Nested-Object-vs-Parent-x2F-Child"><a href="#Nested-Object-vs-Parent-x2F-Child" class="headerlink" title="Nested Object vs Parent&#x2F;Child"></a>Nested Object vs Parent&#x2F;Child</h3><p>å°½é‡é¿å…ä½¿ç”¨ nested æˆ– parent&#x2F;child çš„å­—æ®µï¼Œèƒ½ä¸ç”¨å°±ä¸ç”¨ï¼›nested query æ…¢ï¼Œparent&#x2F;child query æ›´æ…¢ï¼Œæ¯” nested query æ…¢ä¸Šç™¾å€ï¼›å› æ­¤èƒ½åœ¨ mapping è®¾è®¡é˜¶æ®µæå®šçš„ï¼ˆå¤§å®½è¡¨è®¾è®¡æˆ–é‡‡ç”¨æ¯”è¾ƒ smart çš„æ•°æ®ç»“æ„ï¼‰ï¼Œå°±ä¸è¦ç”¨çˆ¶å­å…³ç³»çš„ mappingã€‚</p>
<p>å¦‚æœä¸€å®šè¦ä½¿ç”¨ nested fieldsï¼Œä¿è¯ nested fields å­—æ®µä¸èƒ½è¿‡å¤šï¼Œç›®å‰ ES é»˜è®¤é™åˆ¶æ˜¯ 50ã€‚å› ä¸ºé’ˆå¯¹ 1 ä¸ª documentï¼Œæ¯ä¸€ä¸ª nested fieldï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„ documentï¼Œè¿™å°†ä½¿ doc æ•°é‡å‰§å¢ï¼Œå½±å“æŸ¥è¯¢æ•ˆç‡ï¼Œå°¤å…¶æ˜¯ JOIN çš„æ•ˆç‡ã€‚</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">index.mapping.nested_fields.limit:</span> <span class="number">50</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">å¯¹æ¯”</th>
<th align="left">Nested Object</th>
<th align="left">Parent&#x2F;Child</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ä¼˜ç‚¹</td>
<td align="left">æ–‡æ¡£å­˜å‚¨åœ¨ä¸€èµ·ï¼Œå› æ­¤è¯»å–æ€§é«˜</td>
<td align="left">çˆ¶å­æ–‡æ¡£å¯ä»¥ç‹¬ç«‹æ›´æ–°ï¼Œäº’ä¸å½±å“</td>
</tr>
<tr>
<td align="left">ç¼ºç‚¹</td>
<td align="left">æ›´æ–°çˆ¶æ–‡æ¡£æˆ–å­æ–‡æ¡£æ—¶éœ€è¦æ›´æ–°æ•´ä¸ªæ–‡æ¡£</td>
<td align="left">ä¸ºäº†ç»´æŠ¤ join å…³ç³»ï¼Œéœ€è¦å ç”¨éƒ¨åˆ†å†…å­˜ï¼Œè¯»å–æ€§èƒ½è¾ƒå·®</td>
</tr>
<tr>
<td align="left">åœºæ™¯</td>
<td align="left">å­æ–‡æ¡£å¶å°”æ›´æ–°ï¼ŒæŸ¥è¯¢é¢‘ç¹</td>
<td align="left">å­æ–‡æ¡£æ›´æ–°é¢‘ç¹</td>
</tr>
</tbody></table>
<h3 id="é€‰æ‹©é™æ€æ˜ å°„ï¼Œéå¿…éœ€æ—¶ï¼Œç¦æ­¢åŠ¨æ€æ˜ å°„"><a href="#é€‰æ‹©é™æ€æ˜ å°„ï¼Œéå¿…éœ€æ—¶ï¼Œç¦æ­¢åŠ¨æ€æ˜ å°„" class="headerlink" title="é€‰æ‹©é™æ€æ˜ å°„ï¼Œéå¿…éœ€æ—¶ï¼Œç¦æ­¢åŠ¨æ€æ˜ å°„"></a>é€‰æ‹©é™æ€æ˜ å°„ï¼Œéå¿…éœ€æ—¶ï¼Œç¦æ­¢åŠ¨æ€æ˜ å°„</h3><p>å°½é‡é¿å…ä½¿ç”¨åŠ¨æ€æ˜ å°„ï¼Œè¿™æ ·æœ‰å¯èƒ½ä¼šå¯¼è‡´é›†ç¾¤å´©æºƒï¼Œæ­¤å¤–ï¼ŒåŠ¨æ€æ˜ å°„æœ‰å¯èƒ½ä¼šå¸¦æ¥ä¸å¯æ§åˆ¶çš„æ•°æ®ç±»å‹ï¼Œè¿›è€Œæœ‰å¯èƒ½å¯¼è‡´åœ¨æŸ¥è¯¢ç«¯å‡ºç°ç›¸å…³å¼‚å¸¸ï¼Œå½±å“ä¸šåŠ¡ã€‚</p>
<p>æ­¤å¤–ï¼ŒElasticsearch ä½œä¸ºæœç´¢å¼•æ“æ—¶ï¼Œä¸»è¦æ‰¿è½½ query çš„åŒ¹é…å’Œæ’åºçš„åŠŸèƒ½ï¼Œé‚£æ•°æ®çš„å­˜å‚¨ç±»å‹åŸºäºè¿™ä¸¤ç§åŠŸèƒ½çš„ç”¨é€”åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€æ˜¯éœ€è¦åŒ¹é…çš„å­—æ®µï¼Œç”¨æ¥å»ºç«‹å€’æ’ç´¢å¼•å¯¹ query åŒ¹é…ç”¨ï¼Œå¦ä¸€ç±»å­—æ®µæ˜¯ç”¨åšç²—æ’ç”¨åˆ°çš„ç‰¹å¾å­—æ®µï¼Œå¦‚ ctrã€ç‚¹å‡»æ•°ã€è¯„è®ºæ•°ç­‰ç­‰ã€‚</p>
<h2 id="é›†ç¾¤æ¶æ„è®¾è®¡"><a href="#é›†ç¾¤æ¶æ„è®¾è®¡" class="headerlink" title="é›†ç¾¤æ¶æ„è®¾è®¡"></a>é›†ç¾¤æ¶æ„è®¾è®¡</h2><p>åˆç†çš„éƒ¨ç½² Elasticsearch æœ‰åŠ©äºæé«˜æœåŠ¡çš„æ•´ä½“å¯ç”¨æ€§ã€‚</p>
<h3 id="ä¸»èŠ‚ç‚¹ã€æ•°æ®èŠ‚ç‚¹å’Œåè°ƒèŠ‚ç‚¹åˆ†ç¦»"><a href="#ä¸»èŠ‚ç‚¹ã€æ•°æ®èŠ‚ç‚¹å’Œåè°ƒèŠ‚ç‚¹åˆ†ç¦»" class="headerlink" title="ä¸»èŠ‚ç‚¹ã€æ•°æ®èŠ‚ç‚¹å’Œåè°ƒèŠ‚ç‚¹åˆ†ç¦»"></a>ä¸»èŠ‚ç‚¹ã€æ•°æ®èŠ‚ç‚¹å’Œåè°ƒèŠ‚ç‚¹åˆ†ç¦»</h3><p>Elasticsearch é›†ç¾¤åœ¨æ¶æ„æ‹“æœ´æ—¶ï¼Œé‡‡ç”¨ä¸»èŠ‚ç‚¹ã€æ•°æ®èŠ‚ç‚¹å’Œè´Ÿè½½å‡è¡¡èŠ‚ç‚¹åˆ†ç¦»çš„æ¶æ„ï¼Œåœ¨ 5.x ç‰ˆæœ¬ä»¥åï¼Œåˆå¯å°†æ•°æ®èŠ‚ç‚¹å†ç»†åˆ†ä¸ºâ€œHot-Warmâ€çš„æ¶æ„æ¨¡å¼ã€‚</p>
<p>Elasticsearch çš„é…ç½®æ–‡ä»¶ä¸­æœ‰ 2 ä¸ªå‚æ•°ï¼Œnode.master å’Œ node.dataã€‚è¿™ä¸¤ä¸ªå‚æ•°æ­é…ä½¿ç”¨æ—¶ï¼Œèƒ½å¤Ÿå¸®åŠ©æä¾›æœåŠ¡å™¨æ€§èƒ½ã€‚</p>
<h4 id="ä¸»ï¼ˆmasterï¼‰èŠ‚ç‚¹"><a href="#ä¸»ï¼ˆmasterï¼‰èŠ‚ç‚¹" class="headerlink" title="ä¸»ï¼ˆmasterï¼‰èŠ‚ç‚¹"></a>ä¸»ï¼ˆmasterï¼‰èŠ‚ç‚¹</h4><p>é…ç½® <code>node.master:true</code> å’Œ <code>node.data:false</code>ï¼Œè¯¥ node æœåŠ¡å™¨åªä½œä¸ºä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œä½†ä¸å­˜å‚¨ä»»ä½•ç´¢å¼•æ•°æ®ã€‚æˆ‘ä»¬æ¨èæ¯ä¸ªé›†ç¾¤è¿è¡Œ 3 ä¸ªä¸“ç”¨çš„ master èŠ‚ç‚¹æ¥æä¾›æœ€å¥½çš„å¼¹æ€§ã€‚ä½¿ç”¨æ—¶ï¼Œä½ è¿˜éœ€è¦å°† <code>discovery.zen.minimum_master_nodes setting</code> å‚æ•°è®¾ç½®ä¸º 2ï¼Œä»¥å…å‡ºç°è„‘è£‚ï¼ˆsplit-brainï¼‰çš„æƒ…å†µã€‚ç”¨ 3 ä¸ªä¸“ç”¨çš„ master èŠ‚ç‚¹ï¼Œä¸“é—¨è´Ÿè´£å¤„ç†é›†ç¾¤çš„ç®¡ç†ä»¥åŠåŠ å¼ºçŠ¶æ€çš„æ•´ä½“ç¨³å®šæ€§ã€‚å› ä¸ºè¿™ 3 ä¸ª master èŠ‚ç‚¹ä¸åŒ…å«æ•°æ®ä¹Ÿä¸ä¼šå®é™…å‚ä¸æœç´¢ä»¥åŠç´¢å¼•æ“ä½œï¼Œåœ¨ JVM ä¸Šå®ƒä»¬ä¸ç”¨åšç›¸åŒçš„äº‹ï¼Œä¾‹å¦‚ç¹é‡çš„ç´¢å¼•æˆ–è€…è€—æ—¶ï¼Œèµ„æºè€—è´¹å¾ˆå¤§çš„æœç´¢ã€‚å› æ­¤ä¸å¤ªå¯èƒ½ä¼šå› ä¸ºåƒåœ¾å›æ”¶è€Œå¯¼è‡´åœé¡¿ã€‚å› æ­¤ï¼Œmaster èŠ‚ç‚¹çš„ CPUï¼Œå†…å­˜ä»¥åŠç£ç›˜é…ç½®å¯ä»¥æ¯” data èŠ‚ç‚¹å°‘å¾ˆå¤šçš„ã€‚</p>
<h4 id="æ•°æ®ï¼ˆdataï¼‰èŠ‚ç‚¹"><a href="#æ•°æ®ï¼ˆdataï¼‰èŠ‚ç‚¹" class="headerlink" title="æ•°æ®ï¼ˆdataï¼‰èŠ‚ç‚¹"></a>æ•°æ®ï¼ˆdataï¼‰èŠ‚ç‚¹</h4><p>é…ç½® <code>node.master:false</code> å’Œ <code>node.data:true</code>ï¼Œè¯¥ node æœåŠ¡å™¨åªä½œä¸ºä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼Œåªç”¨äºå­˜å‚¨ç´¢å¼•æ•°æ®ï¼Œä½¿è¯¥ node æœåŠ¡å™¨åŠŸèƒ½å•ä¸€ï¼Œåªç”¨äºæ•°æ®å­˜å‚¨å’Œæ•°æ®æŸ¥è¯¢ï¼Œé™ä½å…¶èµ„æºæ¶ˆè€—ç‡ã€‚</p>
<p>åœ¨ Elasticsearch 5.x ç‰ˆæœ¬ä¹‹åï¼Œdata èŠ‚ç‚¹åˆå¯å†ç»†åˆ†ä¸ºâ€œHot-Warmâ€æ¶æ„ï¼Œå³åˆ†ä¸ºçƒ­èŠ‚ç‚¹ï¼ˆhot nodeï¼‰å’Œæš–èŠ‚ç‚¹ï¼ˆwarm nodeï¼‰ã€‚</p>
<p>hot èŠ‚ç‚¹ï¼š</p>
<p>hot èŠ‚ç‚¹ä¸»è¦æ˜¯ç´¢å¼•èŠ‚ç‚¹ï¼ˆå†™èŠ‚ç‚¹ï¼‰ï¼ŒåŒæ—¶ä¼šä¿å­˜è¿‘æœŸçš„ä¸€äº›é¢‘ç¹è¢«æŸ¥è¯¢çš„ç´¢å¼•ã€‚ç”±äºè¿›è¡Œç´¢å¼•éå¸¸è€—è´¹ CPU å’Œ IOï¼Œå³å±äº IO å’Œ CPU å¯†é›†å‹æ“ä½œï¼Œå»ºè®®ä½¿ç”¨ SSD çš„ç£ç›˜ç±»å‹ï¼Œä¿æŒè‰¯å¥½çš„å†™æ€§èƒ½ï¼›æˆ‘ä»¬æ¨èéƒ¨ç½²æœ€å°åŒ–çš„ 3 ä¸ª hot èŠ‚ç‚¹æ¥ä¿è¯é«˜å¯ç”¨æ€§ã€‚æ ¹æ®è¿‘æœŸéœ€è¦æ”¶é›†ä»¥åŠæŸ¥è¯¢çš„æ•°æ®é‡ï¼Œå¯ä»¥å¢åŠ æœåŠ¡å™¨æ•°é‡æ¥è·å¾—æƒ³è¦çš„æ€§èƒ½ã€‚</p>
<p>å°†èŠ‚ç‚¹è®¾ç½®ä¸º hot ç±»å‹éœ€è¦ elasticsearch.yml å¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">node</span>.attr.box_<span class="keyword">type</span>: hot</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯é’ˆå¯¹æŒ‡å®šçš„ index æ“ä½œï¼Œå¯ä»¥é€šè¿‡ settings è®¾ç½® <code>index.routing.allocation.require.box_type: hot</code> å°†ç´¢å¼•å†™å…¥ hot èŠ‚ç‚¹ã€‚</p>
<p>warm èŠ‚ç‚¹ï¼š</p>
<p>è¿™ç§ç±»å‹çš„èŠ‚ç‚¹æ˜¯ä¸ºäº†å¤„ç†å¤§é‡çš„ï¼Œè€Œä¸”ä¸ç»å¸¸è®¿é—®çš„åªè¯»ç´¢å¼•è€Œè®¾è®¡çš„ã€‚ç”±äºè¿™äº›ç´¢å¼•æ˜¯åªè¯»çš„ï¼Œwarm èŠ‚ç‚¹å€¾å‘äºæŒ‚è½½å¤§é‡ç£ç›˜ï¼ˆæ™®é€šç£ç›˜ï¼‰æ¥æ›¿ä»£ SSDã€‚å†…å­˜ã€CPU çš„é…ç½®è·Ÿ hot èŠ‚ç‚¹ä¿æŒä¸€è‡´å³å¯ï¼›èŠ‚ç‚¹æ•°é‡ä¸€èˆ¬ä¹Ÿæ˜¯å¤§äºç­‰äº 3 ä¸ªã€‚</p>
<p>å°†èŠ‚ç‚¹è®¾ç½®ä¸º warm ç±»å‹éœ€è¦ elasticsearch.yml å¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">node</span>.attr.box_<span class="keyword">type</span>: warm</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ï¼Œä¹Ÿå¯ä»¥åœ¨ elasticsearch.yml ä¸­è®¾ç½® <code>index.codec:best_compression</code> ä¿è¯ warm èŠ‚ç‚¹çš„å‹ç¼©é…ç½®ã€‚</p>
<p>å½“ç´¢å¼•ä¸å†è¢«é¢‘ç¹æŸ¥è¯¢æ—¶ï¼Œå¯é€šè¿‡ <code>index.routing.allocation.require.box_type:warm</code>ï¼Œå°†ç´¢å¼•æ ‡è®°ä¸º warmï¼Œä»è€Œä¿è¯ç´¢å¼•ä¸å†™å…¥ hot èŠ‚ç‚¹ï¼Œä»¥ä¾¿å°† SSD ç£ç›˜èµ„æºç”¨åœ¨åˆ€åˆƒä¸Šã€‚ä¸€æ—¦è®¾ç½®è¿™ä¸ªå±æ€§ï¼ŒES ä¼šè‡ªåŠ¨å°†ç´¢å¼•åˆå¹¶åˆ° warm èŠ‚ç‚¹ã€‚</p>
<h4 id="åè°ƒï¼ˆcoordinatingï¼‰èŠ‚ç‚¹"><a href="#åè°ƒï¼ˆcoordinatingï¼‰èŠ‚ç‚¹" class="headerlink" title="åè°ƒï¼ˆcoordinatingï¼‰èŠ‚ç‚¹"></a>åè°ƒï¼ˆcoordinatingï¼‰èŠ‚ç‚¹</h4><p>åè°ƒèŠ‚ç‚¹ç”¨äºåšåˆ†å¸ƒå¼é‡Œçš„åè°ƒï¼Œå°†å„åˆ†ç‰‡æˆ–èŠ‚ç‚¹è¿”å›çš„æ•°æ®æ•´åˆåè¿”å›ã€‚è¯¥èŠ‚ç‚¹ä¸ä¼šè¢«é€‰ä½œä¸»èŠ‚ç‚¹ï¼Œä¹Ÿä¸ä¼šå­˜å‚¨ä»»ä½•ç´¢å¼•æ•°æ®ã€‚è¯¥æœåŠ¡å™¨ä¸»è¦ç”¨äºæŸ¥è¯¢è´Ÿè½½å‡è¡¡ã€‚åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæ¶‰åŠåˆ°ä»å¤šä¸ª node æœåŠ¡å™¨ä¸ŠæŸ¥è¯¢æ•°æ®ï¼Œå¹¶å°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæŒ‡å®šçš„ node æœåŠ¡å™¨ï¼Œå¹¶å¯¹å„ä¸ª node æœåŠ¡å™¨è¿”å›çš„ç»“æœè¿›è¡Œä¸€ä¸ªæ±‡æ€»å¤„ç†ï¼Œæœ€ç»ˆè¿”å›ç»™å®¢æˆ·ç«¯ã€‚åœ¨ ES é›†ç¾¤ä¸­ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æœ‰å¯èƒ½æ˜¯åè°ƒèŠ‚ç‚¹ï¼Œä½†æ˜¯ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® <code>node.master</code>ã€<code>node.data</code>ã€<code>node.ingest</code> éƒ½ä¸º <code>false</code> æ¥è®¾ç½®ä¸“é—¨çš„åè°ƒèŠ‚ç‚¹ã€‚éœ€è¦è¾ƒå¥½çš„ CPU å’Œè¾ƒé«˜çš„å†…å­˜ã€‚</p>
<ul>
<li>node.master:false å’Œ node.data:trueï¼Œè¯¥ node æœåŠ¡å™¨åªä½œä¸ºä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ï¼Œåªç”¨äºå­˜å‚¨ç´¢å¼•æ•°æ®ï¼Œä½¿è¯¥ node æœåŠ¡å™¨åŠŸèƒ½å•ä¸€ï¼Œåªç”¨äºæ•°æ®å­˜å‚¨å’Œæ•°æ®æŸ¥è¯¢ï¼Œé™ä½å…¶èµ„æºæ¶ˆè€—ç‡ã€‚</li>
<li>node.master:true å’Œ node.data:falseï¼Œè¯¥ node æœåŠ¡å™¨åªä½œä¸ºä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œä½†ä¸å­˜å‚¨ä»»ä½•ç´¢å¼•æ•°æ®ï¼Œè¯¥ node æœåŠ¡å™¨å°†ä½¿ç”¨è‡ªèº«ç©ºé—²çš„èµ„æºï¼Œæ¥åè°ƒå„ç§åˆ›å»ºç´¢å¼•è¯·æ±‚æˆ–è€…æŸ¥è¯¢è¯·æ±‚ï¼Œå¹¶å°†è¿™äº›è¯·æ±‚åˆç†åˆ†å‘åˆ°ç›¸å…³çš„ node æœåŠ¡å™¨ä¸Šã€‚</li>
<li>node.master:false å’Œ node.data:falseï¼Œè¯¥ node æœåŠ¡å™¨å³ä¸ä¼šè¢«é€‰ä½œä¸»èŠ‚ç‚¹ï¼Œä¹Ÿä¸ä¼šå­˜å‚¨ä»»ä½•ç´¢å¼•æ•°æ®ã€‚è¯¥æœåŠ¡å™¨ä¸»è¦ç”¨äºæŸ¥è¯¢è´Ÿè½½å‡è¡¡ã€‚åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæ¶‰åŠåˆ°ä»å¤šä¸ª node æœåŠ¡å™¨ä¸ŠæŸ¥è¯¢æ•°æ®ï¼Œå¹¶å°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæŒ‡å®šçš„ node æœåŠ¡å™¨ï¼Œå¹¶å¯¹å„ä¸ª node æœåŠ¡å™¨è¿”å›çš„ç»“æœè¿›è¡Œä¸€ä¸ªæ±‡æ€»å¤„ç†ï¼Œæœ€ç»ˆè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li>
</ul>
<h3 id="å…³é—­-data-èŠ‚ç‚¹æœåŠ¡å™¨ä¸­çš„-http-åŠŸèƒ½"><a href="#å…³é—­-data-èŠ‚ç‚¹æœåŠ¡å™¨ä¸­çš„-http-åŠŸèƒ½" class="headerlink" title="å…³é—­ data èŠ‚ç‚¹æœåŠ¡å™¨ä¸­çš„ http åŠŸèƒ½"></a>å…³é—­ data èŠ‚ç‚¹æœåŠ¡å™¨ä¸­çš„ http åŠŸèƒ½</h3><p>é’ˆå¯¹ Elasticsearch é›†ç¾¤ä¸­çš„æ‰€æœ‰æ•°æ®èŠ‚ç‚¹ï¼Œä¸ç”¨å¼€å¯ http æœåŠ¡ã€‚å°†å…¶ä¸­çš„é…ç½®å‚æ•°è¿™æ ·è®¾ç½®ï¼Œ<code>http.enabled:false</code>ï¼ŒåŒæ—¶ä¹Ÿä¸è¦å®‰è£… head, bigdesk, marvel ç­‰ç›‘æ§æ’ä»¶ï¼Œè¿™æ ·ä¿è¯ data èŠ‚ç‚¹æœåŠ¡å™¨åªéœ€å¤„ç†åˆ›å»º&#x2F;æ›´æ–°&#x2F;åˆ é™¤&#x2F;æŸ¥è¯¢ç´¢å¼•æ•°æ®ç­‰æ“ä½œã€‚</p>
<p>http åŠŸèƒ½å¯ä»¥åœ¨éæ•°æ®èŠ‚ç‚¹æœåŠ¡å™¨ä¸Šå¼€å¯ï¼Œä¸Šè¿°ç›¸å…³çš„ç›‘æ§æ’ä»¶ä¹Ÿå®‰è£…åˆ°è¿™äº›æœåŠ¡å™¨ä¸Šï¼Œç”¨äºç›‘æ§ Elasticsearch é›†ç¾¤çŠ¶æ€ç­‰æ•°æ®ä¿¡æ¯ã€‚è¿™æ ·åšä¸€æ¥å‡ºäºæ•°æ®å®‰å…¨è€ƒè™‘ï¼ŒäºŒæ¥å‡ºäºæœåŠ¡æ€§èƒ½è€ƒè™‘ã€‚</p>
<h3 id="ä¸€å°æœåŠ¡å™¨ä¸Šæœ€å¥½åªéƒ¨ç½²ä¸€ä¸ª-node"><a href="#ä¸€å°æœåŠ¡å™¨ä¸Šæœ€å¥½åªéƒ¨ç½²ä¸€ä¸ª-node" class="headerlink" title="ä¸€å°æœåŠ¡å™¨ä¸Šæœ€å¥½åªéƒ¨ç½²ä¸€ä¸ª node"></a>ä¸€å°æœåŠ¡å™¨ä¸Šæœ€å¥½åªéƒ¨ç½²ä¸€ä¸ª node</h3><p>ä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šå¯ä»¥å¯åŠ¨å¤šä¸ª node æœåŠ¡å™¨èŠ‚ç‚¹ï¼ˆé€šè¿‡è®¾ç½®ä¸åŒçš„å¯åŠ¨ portï¼‰ï¼Œä½†ä¸€å°æœåŠ¡å™¨ä¸Šçš„ CPUã€å†…å­˜ã€ç¡¬ç›˜ç­‰èµ„æºæ¯•ç«Ÿæœ‰é™ï¼Œä»æœåŠ¡å™¨æ€§èƒ½è€ƒè™‘ï¼Œä¸å»ºè®®ä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ª node èŠ‚ç‚¹ã€‚</p>
<h3 id="é›†ç¾¤åˆ†ç‰‡è®¾ç½®"><a href="#é›†ç¾¤åˆ†ç‰‡è®¾ç½®" class="headerlink" title="é›†ç¾¤åˆ†ç‰‡è®¾ç½®"></a>é›†ç¾¤åˆ†ç‰‡è®¾ç½®</h3><p>ES ä¸€æ—¦åˆ›å»ºå¥½ç´¢å¼•åï¼Œå°±æ— æ³•è°ƒæ•´åˆ†ç‰‡çš„è®¾ç½®ï¼Œè€Œåœ¨ ES ä¸­ï¼Œä¸€ä¸ªåˆ†ç‰‡å®é™…ä¸Šå¯¹åº”ä¸€ä¸ª lucene ç´¢å¼•ï¼Œè€Œ lucene ç´¢å¼•çš„è¯»å†™ä¼šå ç”¨å¾ˆå¤šçš„ç³»ç»Ÿèµ„æºï¼Œå› æ­¤ï¼Œåˆ†ç‰‡æ•°ä¸èƒ½è®¾ç½®è¿‡å¤§ï¼›æ‰€ä»¥ï¼Œåœ¨åˆ›å»ºç´¢å¼•æ—¶ï¼Œåˆç†é…ç½®åˆ†ç‰‡æ•°æ˜¯éå¸¸é‡è¦çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬éµå¾ªä¸€äº›åŸåˆ™ï¼š</p>
<ol>
<li>æ§åˆ¶æ¯ä¸ªåˆ†ç‰‡å ç”¨çš„ç¡¬ç›˜å®¹é‡ä¸è¶…è¿‡ ES çš„æœ€å¤§ JVM çš„å †ç©ºé—´è®¾ç½®ï¼ˆä¸€èˆ¬è®¾ç½®ä¸è¶…è¿‡ 32 Gï¼Œå‚è€ƒä¸Šé¢çš„ JVM å†…å­˜è®¾ç½®åŸåˆ™ï¼‰ï¼Œå› æ­¤ï¼Œå¦‚æœç´¢å¼•çš„æ€»å®¹é‡åœ¨ 500 G å·¦å³ï¼Œé‚£åˆ†ç‰‡å¤§å°åœ¨ 16 ä¸ªå·¦å³å³å¯ï¼›å½“ç„¶ï¼Œæœ€å¥½åŒæ—¶è€ƒè™‘åŸåˆ™ 2ã€‚</li>
<li>è€ƒè™‘ä¸€ä¸‹ node æ•°é‡ï¼Œä¸€èˆ¬ä¸€ä¸ªèŠ‚ç‚¹æœ‰æ—¶å€™å°±æ˜¯ä¸€å°ç‰©ç†æœºï¼Œå¦‚æœåˆ†ç‰‡æ•°è¿‡å¤šï¼Œå¤§å¤§è¶…è¿‡äº†èŠ‚ç‚¹æ•°ï¼Œå¾ˆå¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå­˜åœ¨å¤šä¸ªåˆ†ç‰‡ï¼Œä¸€æ—¦è¯¥èŠ‚ç‚¹æ•…éšœï¼Œå³ä½¿ä¿æŒäº† 1 ä¸ªä»¥ä¸Šçš„å‰¯æœ¬ï¼ŒåŒæ ·æœ‰å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œé›†ç¾¤æ— æ³•æ¢å¤ã€‚æ‰€ä»¥ï¼Œ<strong>ä¸€èˆ¬éƒ½è®¾ç½®åˆ†ç‰‡æ•°ä¸è¶…è¿‡èŠ‚ç‚¹æ•°çš„ 3 å€</strong>ã€‚</li>
</ol>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.knowledgedict.com/tutorial/elasticsearch-intro.html">Elasticsearch æ•™ç¨‹</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/24baff/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/24baff/" class="post-title-link" itemprop="url">Elasticsearch æ’åº</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-01-19 22:49:16" itemprop="dateCreated datePublished" datetime="2022-01-19T22:49:16+08:00">2022-01-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-23 18:54:25" itemprop="dateModified" datetime="2022-09-23T18:54:25+08:00">2022-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">æ•°æ®åº“</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">æœç´¢å¼•æ“æ•°æ®åº“</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/Elasticsearch/" itemprop="url" rel="index"><span itemprop="name">Elasticsearch</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>4.9k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>4 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Elasticsearch-æ’åº"><a href="#Elasticsearch-æ’åº" class="headerlink" title="Elasticsearch æ’åº"></a>Elasticsearch æ’åº</h1><p>åœ¨ Elasticsearch ä¸­ï¼Œé»˜è®¤æ’åºæ˜¯<strong>æŒ‰ç…§ç›¸å…³æ€§çš„è¯„åˆ†ï¼ˆ_scoreï¼‰</strong>è¿›è¡Œé™åºæ’åºï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§<strong>å­—æ®µçš„å€¼æ’åº</strong>ã€<strong>å¤šçº§æ’åº</strong>ã€<strong>å¤šå€¼å­—æ®µæ’åºã€åŸºäº geoï¼ˆåœ°ç†ä½ç½®ï¼‰æ’åºä»¥åŠè‡ªå®šä¹‰è„šæœ¬æ’åº</strong>ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºç›¸å…³æ€§çš„è¯„åˆ†ä¹Ÿå¯ä»¥ç”¨ rescore äºŒæ¬¡ã€ä¸‰æ¬¡æ‰“åˆ†ï¼Œå®ƒå¯ä»¥é™å®šé‡æ–°æ‰“åˆ†çš„çª—å£å¤§å°ï¼ˆwindow sizeï¼‰ï¼Œå¹¶é’ˆå¯¹ä½œç”¨èŒƒå›´å†…çš„æ–‡æ¡£ä¿®æ”¹å…¶å¾—åˆ†ï¼Œä»è€Œè¾¾åˆ°ç²¾ç»†åŒ–æ§åˆ¶ç»“æœç›¸å…³æ€§çš„ç›®çš„ã€‚</p>
<h2 id="é»˜è®¤ç›¸å…³æ€§æ’åº"><a href="#é»˜è®¤ç›¸å…³æ€§æ’åº" class="headerlink" title="é»˜è®¤ç›¸å…³æ€§æ’åº"></a>é»˜è®¤ç›¸å…³æ€§æ’åº</h2><p>åœ¨ Elasticsearch ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ–‡æ¡£æ˜¯æŒ‰ç…§ç›¸å…³æ€§å¾—åˆ†å€’åºæ’åˆ—çš„ï¼Œå…¶å¯¹åº”çš„ç›¸å…³æ€§å¾—åˆ†å­—æ®µç”¨ <code>_score</code> æ¥è¡¨ç¤ºï¼Œå®ƒæ˜¯æµ®ç‚¹æ•°ç±»å‹ï¼Œ<code>_score</code> è¯„åˆ†è¶Šé«˜ï¼Œç›¸å…³æ€§è¶Šé«˜ã€‚è¯„åˆ†æ¨¡å‹çš„é€‰æ‹©å¯ä»¥é€šè¿‡ <code>similarity</code> å‚æ•°åœ¨æ˜ å°„ä¸­æŒ‡å®šã€‚</p>
<p>ç›¸ä¼¼åº¦ç®—æ³•å¯ä»¥æŒ‰å­—æ®µæŒ‡å®šï¼Œåªéœ€åœ¨æ˜ å°„ä¸­ä¸ºä¸åŒå­—æ®µé€‰å®šå³å¯ï¼Œå¦‚æœè¦ä¿®æ”¹å·²æœ‰å­—æ®µçš„ç›¸ä¼¼åº¦ç®—æ³•ï¼Œåªèƒ½é€šè¿‡ä¸ºæ•°æ®é‡æ–°å»ºç«‹ç´¢å¼•æ¥è¾¾åˆ°ç›®çš„ã€‚å…³äºæ›´å¤š es ç›¸ä¼¼åº¦ç®—æ³•å¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener" href="https://www.knowledgedict.com/tutorial/elasticsearch-similarity.html">æ·±å…¥ç†è§£ es ç›¸ä¼¼åº¦ç®—æ³•ï¼ˆç›¸å…³æ€§å¾—åˆ†è®¡ç®—ï¼‰</a>ã€‚</p>
<h3 id="TF-IDF-æ¨¡å‹"><a href="#TF-IDF-æ¨¡å‹" class="headerlink" title="TF-IDF æ¨¡å‹"></a>TF-IDF æ¨¡å‹</h3><p>Elasticsearch åœ¨ 5.4 ç‰ˆæœ¬ä»¥å‰ï¼Œtext ç±»å‹çš„å­—æ®µï¼Œé»˜è®¤é‡‡ç”¨åŸºäº tf-idf çš„å‘é‡ç©ºé—´æ¨¡å‹ã€‚</p>
<p>åœ¨å¼€å§‹è®¡ç®—å¾—åˆ†ä¹‹æ—¶ï¼ŒElasticsearch ä½¿ç”¨äº†è¢«æœç´¢è¯æ¡çš„é¢‘ç‡ä»¥åŠå®ƒæœ‰å¤šå¸¸è§æ¥å½±å“å¾—åˆ†ã€‚ä¸€ä¸ªç®€çŸ­çš„è§£é‡Šæ˜¯ï¼Œ<strong>ä¸€ä¸ªè¯æ¡å‡ºç°åœ¨æŸä¸ªæ–‡æ¡£ä¸­çš„æ¬¡æ•°è¶Šå¤šï¼Œå®ƒå°±è¶Šç›¸å…³ï¼›ä½†æ˜¯ï¼Œå¦‚æœè¯¥è¯æ¡å‡ºç°åœ¨ä¸åŒçš„æ–‡æ¡£çš„æ¬¡æ•°è¶Šå¤šï¼Œå®ƒå°±è¶Šä¸ç›¸å…³</strong>ã€‚è¿™ä¸€ç‚¹è¢«ç§°ä¸º TF-IDFï¼ŒTF æ˜¯<strong>è¯é¢‘</strong>ï¼ˆterm frequencyï¼‰ï¼ŒIDF æ˜¯<strong>é€†æ–‡æ¡£é¢‘ç‡</strong>ï¼ˆinverse document frequencyï¼‰ã€‚</p>
<p>è€ƒè™‘ç»™ä¸€ç¯‡æ–‡æ¡£æ‰“åˆ†çš„é¦–è¦æ–¹å¼ï¼Œæ˜¯ç»Ÿè®¡ä¸€ä¸ªè¯æ¡åœ¨æ–‡æœ¬ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœåœ¨ç”¨æˆ·çš„åŒºåŸŸæœç´¢å…³äº Elasticsearch çš„ get-togetherï¼Œç”¨æˆ·å¸Œæœ›é¢‘ç¹æåŠ Elasticsearch çš„åˆ†ç»„è¢«ä¼˜å…ˆå±•ç¤ºå‡ºæ¥ã€‚</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&quot;We will discuss Elasticsearch at the next Big Data group.&quot;</span></span><br><span class="line"><span class="comment">&quot;Tuesday the Elasticsearch team will gather to answer questions about Elasticsearch.&quot;</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªå¥å­æåˆ° Elasticsearch ä¸€æ¬¡ï¼Œè€Œç¬¬äºŒä¸ªå¥å­æåˆ° Elasticsearch ä¸¤æ¬¡ï¼Œæ‰€ä»¥åŒ…å«ç¬¬äºŒå¥è¯çš„æ–‡æ¡£åº”è¯¥æ¯”åŒ…å«ç¬¬ä¸€å¥è¯çš„æ–‡æ¡£æ‹¥æœ‰æ›´é«˜çš„å¾—åˆ†ã€‚å¦‚æœæˆ‘ä»¬è¦æŒ‰ç…§æ•°é‡æ¥è®¨è®ºï¼Œç¬¬ä¸€å¥è¯çš„è¯é¢‘ï¼ˆTFï¼‰æ˜¯ 1ï¼Œè€Œç¬¬äºŒå¥è¯çš„è¯é¢‘å°†æ˜¯ 2ã€‚</p>
<p>é€†æ–‡æ¡£é¢‘ç‡æ¯”æ–‡æ¡£è¯é¢‘ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚è¿™ä¸ªå¬ä¸Šå»å¾ˆé…·ç‚«çš„æè¿°æ„å‘³ç€ï¼Œå¦‚æœä¸€ä¸ªåˆ†è¯ï¼ˆé€šå¸¸æ˜¯å•è¯ï¼Œä½†ä¸ä¸€å®šæ˜¯ï¼‰åœ¨ç´¢å¼•çš„ä¸åŒæ–‡æ¡£ä¸­å‡ºç°è¶Šå¤šçš„æ¬¡æ•°ï¼Œé‚£ä¹ˆå®ƒå°±è¶Šä¸é‡è¦ã€‚ä½¿ç”¨å¦‚ä¸‹ä¾‹å­æ›´å®¹æ˜“è§£é‡Šè¿™ä¸€ç‚¹ã€‚</p>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&quot;We use Elasticsearch to power the search for our website.&quot;</span></span><br><span class="line"><span class="comment">&quot;The developers like Elasticsearch so far.&quot;</span></span><br><span class="line"><span class="comment">&quot;The scoring of documents is calculated by the scoring formula.&quot;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šè¿°ä¾‹å­ï¼Œéœ€è¦ç†è§£ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>è¯æ¡ â€œElasticsearchâ€ çš„æ–‡æ¡£é¢‘ç‡æ˜¯ 2ï¼ˆå› ä¸ºå®ƒå‡ºç°åœ¨ä¸¤ç¯‡æ–‡æ¡£ä¸­ï¼‰ã€‚æ–‡æ¡£é¢‘ç‡çš„é€†æºè‡ªå¾—åˆ†ä¹˜ä»¥ 1&#x2F;DFï¼Œè¿™é‡Œ DF æ˜¯è¯¥è¯æ¡çš„æ–‡æ¡£é¢‘ç‡ã€‚è¿™å°±æ„å‘³ç€ï¼Œç”±äºè¯æ¡æ‹¥æœ‰æ›´é«˜çš„æ–‡æ¡£é¢‘ç‡ï¼Œå®ƒçš„æƒé‡å°±ä¼šé™ä½ã€‚</li>
<li>è¯æ¡ â€œtheâ€ çš„æ–‡æ¡£é¢‘ç‡æ˜¯ 3ï¼Œå› ä¸ºå®ƒå‡ºç°åœ¨æ‰€æœ‰çš„ä¸‰ç¯‡æ–‡æ¡£ä¸­ã€‚è¯·æ³¨æ„ï¼Œå°½ç®¡ â€œtheâ€ åœ¨æœ€åä¸€ç¯‡æ–‡æ¡£ä¸­å‡ºç°äº†ä¸¤æ¬¡ï¼Œå®ƒçš„æ–‡æ¡£é¢‘ç‡è¿˜æ˜¯ 3ã€‚è¿™æ˜¯å› ä¸ºï¼Œé€†æ–‡æ¡£é¢‘ç‡åªæ£€æŸ¥ä¸€ä¸ªè¯æ¡æ˜¯å¦å‡ºç°åœ¨æŸæ–‡æ¡£ä¸­ï¼Œè€Œä¸æ£€æŸ¥å®ƒå‡ºç°å¤šå°‘æ¬¡ã€‚é‚£ä¸ªåº”è¯¥æ˜¯è¯é¢‘æ‰€å…³å¿ƒçš„äº‹æƒ…ã€‚</li>
</ul>
<p>é€†æ–‡æ¡£é¢‘ç‡æ˜¯ä¸€ä¸ªé‡è¦çš„å› ç´ ï¼Œç”¨äºå¹³è¡¡è¯æ¡çš„è¯é¢‘ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œè€ƒè™‘æœ‰ä¸€ä¸ªç”¨æˆ·æœç´¢è¯æ¡ â€œthe scoreâ€ï¼Œå•è¯ the å‡ ä¹å‡ºç°åœ¨æ¯ä¸ªæ™®é€šçš„è‹±è¯­æ–‡æœ¬ä¸­ï¼Œå¦‚æœå®ƒä¸è¢«å‡è¡¡ä¸€ä¸‹ï¼Œå•è¯ the çš„é¢‘ç‡è¦å®Œå…¨æ·¹æ²¡å•è¯ score çš„é¢‘ç‡ã€‚é€†æ–‡æ¡£é¢‘ç‡ IDF å‡è¡¡äº† the è¿™ç§å¸¸è§è¯çš„ç›¸å…³æ€§å½±å“ï¼Œæ‰€ä»¥å®é™…çš„ç›¸å…³æ€§å¾—åˆ†å°†ä¼šå¯¹æŸ¥è¯¢çš„è¯æ¡æœ‰ä¸€ä¸ªæ›´å‡†ç¡®çš„æè¿°ã€‚</p>
<p>ä¸€æ—¦è¯é¢‘ TF å’Œé€†æ–‡æ¡£é¢‘ç‡ IDF è®¡ç®—å®Œæˆï¼Œå°±å¯ä»¥ä½¿ç”¨ TF-IDF å…¬å¼æ¥è®¡ç®—æ–‡æ¡£çš„å¾—åˆ†ã€‚</p>
<h3 id="BM25-æ¨¡å‹"><a href="#BM25-æ¨¡å‹" class="headerlink" title="BM25 æ¨¡å‹"></a>BM25 æ¨¡å‹</h3><p>Elasticsearch åœ¨ 5.4 ç‰ˆæœ¬ä¹‹åï¼Œé’ˆå¯¹ text ç±»å‹çš„å­—æ®µï¼Œé»˜è®¤é‡‡ç”¨çš„æ˜¯ BM25 è¯„åˆ†æ¨¡å‹ï¼Œè€Œä¸æ˜¯åŸºäº tf-idf çš„å‘é‡ç©ºé—´æ¨¡å‹ï¼Œè¯„åˆ†æ¨¡å‹çš„é€‰æ‹©å¯ä»¥é€šè¿‡ <code>similarity</code> å‚æ•°åœ¨æ˜ å°„ä¸­æŒ‡å®šã€‚</p>
<h2 id="å­—æ®µçš„å€¼æ’åº"><a href="#å­—æ®µçš„å€¼æ’åº" class="headerlink" title="å­—æ®µçš„å€¼æ’åº"></a>å­—æ®µçš„å€¼æ’åº</h2><p>åœ¨ Elasticsearch ä¸­æŒ‰ç…§å­—æ®µçš„å€¼æ’åºï¼Œå¯ä»¥åˆ©ç”¨ <code>sort</code> å‚æ•°å®ç°ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET books/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;sort&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;price&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;order&quot;</span>: <span class="string">&quot;desc&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;took&quot;</span><span class="punctuation">:</span> <span class="number">132</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hits&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">749244</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hits&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;books&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;book&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8456479&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_score&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">8456479</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">1580.00</span><span class="punctuation">,</span></span><br><span class="line">          ...</span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="number">1580.00</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      ...</span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä»å¦‚ä¸Šè¿”å›ç»“æœï¼Œå¯ä»¥çœ‹å‡ºï¼Œ<code>max_score</code> å’Œ <code>_score</code> å­—æ®µéƒ½è¿”å› <code>null</code>ï¼Œè¿”å›å­—æ®µå¤šå‡º <code>sort</code> å­—æ®µï¼ŒåŒ…å«æ’åºå­—æ®µçš„åˆ†å€¼ã€‚è®¡ç®— _<code>score</code> çš„èŠ±é”€å·¨å¤§ï¼Œå¦‚æœä¸æ ¹æ®ç›¸å…³æ€§æ’åºï¼Œè®°å½• _<code>score</code> æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚å¦‚æœæ— è®ºå¦‚ä½•éƒ½è¦è®¡ç®— _<code>score</code>ï¼Œå¯ä»¥å°† <code>track_scores</code> å‚æ•°è®¾ç½®ä¸º <code>true</code>ã€‚</p>
<h2 id="å¤šå­—æ®µæ’åº"><a href="#å¤šå­—æ®µæ’åº" class="headerlink" title="å¤šå­—æ®µæ’åº"></a>å¤šå­—æ®µæ’åº</h2><p>å¦‚æœæˆ‘ä»¬æƒ³è¦ç»“åˆä½¿ç”¨ priceã€date å’Œ _score è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”åŒ¹é…çš„ç»“æœé¦–å…ˆæŒ‰ç…§ä»·æ ¼æ’åºï¼Œç„¶åæŒ‰ç…§æ—¥æœŸæ’åºï¼Œæœ€åæŒ‰ç…§ç›¸å…³æ€§æ’åºï¼Œå…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">GET books/_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;must&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;match&quot;</span>: &#123; <span class="string">&quot;content&quot;</span>: <span class="string">&quot;java&quot;</span> &#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;term&quot;</span>: &#123; <span class="string">&quot;user_id&quot;</span>: 4868438 &#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">&quot;sort&quot;</span>: [&#123;</span><br><span class="line">			<span class="string">&quot;price&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;order&quot;</span>: <span class="string">&quot;desc&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="string">&quot;date&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;order&quot;</span>: <span class="string">&quot;desc&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="string">&quot;_score&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;order&quot;</span>: <span class="string">&quot;desc&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ’åºæ¡ä»¶çš„é¡ºåºæ˜¯å¾ˆé‡è¦çš„ã€‚ç»“æœé¦–å…ˆæŒ‰ç¬¬ä¸€ä¸ªæ¡ä»¶æ’åºï¼Œä»…å½“ç»“æœé›†çš„ç¬¬ä¸€ä¸ª <code>sort</code> å€¼å®Œå…¨ç›¸åŒæ—¶æ‰ä¼šæŒ‰ç…§ç¬¬äºŒä¸ªæ¡ä»¶è¿›è¡Œæ’åºï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p>å¤šçº§æ’åºå¹¶ä¸ä¸€å®šåŒ…å« <code>_score</code>ã€‚ä½ å¯ä»¥æ ¹æ®ä¸€äº›ä¸åŒçš„å­—æ®µè¿›è¡Œæ’åºï¼Œå¦‚åœ°ç†è·ç¦»æˆ–æ˜¯è„šæœ¬è®¡ç®—çš„ç‰¹å®šå€¼ã€‚</p>
<h2 id="å¤šå€¼å­—æ®µçš„æ’åº"><a href="#å¤šå€¼å­—æ®µçš„æ’åº" class="headerlink" title="å¤šå€¼å­—æ®µçš„æ’åº"></a>å¤šå€¼å­—æ®µçš„æ’åº</h2><p>ä¸€ç§æƒ…å½¢æ˜¯å­—æ®µæœ‰å¤šä¸ªå€¼çš„æ’åºï¼Œéœ€è¦è®°ä½è¿™äº›å€¼å¹¶æ²¡æœ‰å›ºæœ‰çš„é¡ºåºï¼›ä¸€ä¸ªå¤šå€¼çš„å­—æ®µä»…ä»…æ˜¯å¤šä¸ªå€¼çš„åŒ…è£…ï¼Œè¿™æ—¶åº”è¯¥é€‰æ‹©å“ªä¸ªè¿›è¡Œæ’åºå‘¢ï¼Ÿ</p>
<p>å¯¹äºæ•°å­—æˆ–æ—¥æœŸï¼Œä½ å¯ä»¥å°†å¤šå€¼å­—æ®µå‡ä¸ºå•å€¼ï¼Œè¿™å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>min</code>ã€<code>max</code>ã€<code>avg</code> æˆ–æ˜¯ <code>sum</code> æ’åºæ¨¡å¼ã€‚ä¾‹å¦‚ä½ å¯ä»¥æŒ‰ç…§æ¯ä¸ª date å­—æ®µä¸­çš„æœ€æ—©æ—¥æœŸè¿›è¡Œæ’åºï¼Œé€šè¿‡ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dates&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span>  <span class="string">&quot;min&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="åœ°ç†ä½ç½®ä¸Šçš„è·ç¦»æ’åº"><a href="#åœ°ç†ä½ç½®ä¸Šçš„è·ç¦»æ’åº" class="headerlink" title="åœ°ç†ä½ç½®ä¸Šçš„è·ç¦»æ’åº"></a>åœ°ç†ä½ç½®ä¸Šçš„è·ç¦»æ’åº</h2><p>es çš„åœ°ç†ä½ç½®æ’åºä½¿ç”¨ <strong><code>_geo_distance</code></strong> æ¥è¿›è¡Œè·ç¦»æ’åºï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;_geo_distance&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;es_location_field&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">116.407526</span><span class="punctuation">,</span> <span class="number">39.904030</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;order&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;unit&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;km&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;mode&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;min&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;distance_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;plane&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    ......</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><em>_geo_distance</em> çš„é€‰é¡¹å…·ä½“å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¦‚ä¸Šçš„ <em>es_location_field</em> æŒ‡çš„æ˜¯ es å­˜å‚¨ç»çº¬åº¦æ•°æ®çš„å­—æ®µåã€‚</li>
<li>**_<code>order</code><em>**ï¼šæŒ‡å®šæŒ‰è·ç¦»å‡åºæˆ–é™åºï¼Œåˆ†åˆ«å¯¹åº” **</em><code>asc</code><em>** å’Œ **</em><code>desc</code>_**ã€‚</li>
<li>**_<code>unit</code><em>**ï¼šè®¡ç®—è·ç¦»å€¼çš„å•ä½ï¼Œé»˜è®¤æ˜¯ **</em><code>m</code><em>**ï¼Œè¡¨ç¤ºç±³ï¼ˆmetersï¼‰ï¼Œå…¶å®ƒå¯é€‰é¡¹æœ‰ **</em><code>mi</code><em><strong>ã€</strong></em><code>cm</code><em><strong>ã€</strong></em><code>mm</code><em><strong>ã€</strong></em><code>NM</code><em><strong>ã€</strong></em><code>km</code><em><strong>ã€</strong></em><code>ft</code><em><strong>ã€</strong></em><code>yd</code><em>** å’Œ **</em><code>in</code>_**ã€‚</li>
<li>**_<code>mode</code><em>**ï¼šé’ˆå¯¹æ•°ç»„æ•°æ®ï¼ˆå¤šä¸ªå€¼ï¼‰æ—¶ï¼ŒæŒ‡å®šçš„å–å€¼æ¨¡å¼ï¼Œå¯é€‰å€¼æœ‰ **</em><code>min</code><em><strong>ã€</strong></em><code>max</code><em><strong>ã€</strong></em><code>sum</code><em><strong>ã€</strong></em><code>avg</code><em>** å’Œ **</em><code>median</code>_**ï¼Œå½“æ’åºé‡‡ç”¨å‡åºæ—¶ï¼Œé»˜è®¤ä¸º _min_ï¼›æ’åºé‡‡ç”¨é™åºæ—¶ï¼Œé»˜è®¤ä¸º _max_ã€‚</li>
<li>**_<code>distance_type</code><em>**ï¼šç”¨æ¥è®¾ç½®å¦‚ä½•è®¡ç®—è·ç¦»ï¼Œå®ƒçš„å¯é€‰é¡¹æœ‰ **</em><code>sloppy_arc</code><em><strong>ã€</strong></em><code>arc</code><em>** å’Œ **</em><code>plane</code><em>**ï¼Œé»˜è®¤ä¸º <em>sloppy_arc_ï¼Œ_arc</em> å®ƒç›¸å¯¹æ›´ç²¾ç¡®äº›ï¼Œä½†é€Ÿåº¦ä¼šæ˜æ˜¾ä¸‹é™ï¼Œ_plane</em> åˆ™æ˜¯è®¡ç®—å¿«ï¼Œä½†æ˜¯é•¿è·ç¦»è®¡ç®—ç›¸å¯¹ä¸å‡†ç¡®ã€‚</li>
<li>**_<code>ignore_unmapped</code><em>**ï¼šæœªæ˜ å°„å­—æ®µæ—¶ï¼Œæ˜¯å¦å¿½ç•¥å¤„ç†ï¼Œå¯é€‰é¡¹æœ‰ **</em><code>true</code><em>** å’Œ **</em><code>false</code>_**ï¼›é»˜è®¤ä¸º _false_ï¼Œè¡¨ç¤ºå¦‚æœæœªæ˜ å°„å­—æ®µï¼ŒæŸ¥è¯¢å°†å¼•å‘å¼‚å¸¸ï¼›è‹¥è®¾ç½® _true_ï¼Œå°†å¿½ç•¥æœªæ˜ å°„çš„å­—æ®µï¼Œå¹¶ä¸”ä¸åŒ¹é…æ­¤æŸ¥è¯¢çš„ä»»ä½•æ–‡æ¡£ã€‚</li>
<li>**_<code>validation_method</code><em>**ï¼šæŒ‡å®šæ£€éªŒç»çº¬åº¦æ•°æ®çš„æ–¹å¼ï¼Œå¯é€‰é¡¹æœ‰ **</em><code>IGNORE_MALFORMED</code><em><strong>ã€</strong></em><code>COERCE</code><em>** å’Œ **</em><code>STRICT</code><em>**ï¼›_IGNORE_MALFORMED</em> è¡¨ç¤ºå¯æ¥å—çº¬åº¦æˆ–ç»åº¦æ— æ•ˆçš„åœ°ç†ç‚¹ï¼Œå³å¿½ç•¥æ•°æ®ï¼›<em>COERCE</em> è¡¨ç¤ºå¦å¤–å°è¯•å¹¶æ¨æ–­æ­£ç¡®çš„åœ°ç†åæ ‡ï¼›<em>STRICT</em> ä¸ºé»˜è®¤å€¼ï¼Œè¡¨ç¤ºé‡åˆ°ä¸æ­£ç¡®çš„åœ°ç†åæ ‡ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.knowledgedict.com/tutorial/elasticsearch-intro.html">Elasticsearch æ•™ç¨‹</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/f89f66/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/f89f66/" class="post-title-link" itemprop="url">Elasticsearch èšåˆ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-01-19 22:49:16" itemprop="dateCreated datePublished" datetime="2022-01-19T22:49:16+08:00">2022-01-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-23 18:54:25" itemprop="dateModified" datetime="2022-09-23T18:54:25+08:00">2022-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">æ•°æ®åº“</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">æœç´¢å¼•æ“æ•°æ®åº“</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/Elasticsearch/" itemprop="url" rel="index"><span itemprop="name">Elasticsearch</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>13k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>12 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Elasticsearch-èšåˆ"><a href="#Elasticsearch-èšåˆ" class="headerlink" title="Elasticsearch èšåˆ"></a>Elasticsearch èšåˆ</h1><p>Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å…¨æ–‡æœç´¢å¼•æ“ï¼Œç´¢å¼•å’Œæœç´¢æ˜¯ Elasticsearch çš„åŸºæœ¬åŠŸèƒ½ã€‚äº‹å®ä¸Šï¼ŒElasticsearch çš„èšåˆï¼ˆAggregationsï¼‰åŠŸèƒ½ä¹Ÿååˆ†å¼ºå¤§ï¼Œå…è®¸åœ¨æ•°æ®ä¸Šåšå¤æ‚çš„åˆ†æç»Ÿè®¡ã€‚Elasticsearch æä¾›çš„èšåˆåˆ†æåŠŸèƒ½ä¸»è¦æœ‰<strong>æŒ‡æ ‡èšåˆ(metrics aggregations)<strong>ã€</strong>æ¡¶èšåˆ(bucket aggregations)<strong>ã€</strong>ç®¡é“èšåˆ(pipeline aggregations)</strong> å’Œ <strong>çŸ©é˜µèšåˆ(matrix aggregations)</strong> å››å¤§ç±»ï¼Œç®¡é“èšåˆå’ŒçŸ©é˜µèšåˆå®˜æ–¹è¯´æ˜æ˜¯åœ¨è¯•éªŒé˜¶æ®µï¼ŒåæœŸä¼šå®Œå…¨æ›´æ”¹æˆ–è€…ç§»é™¤ï¼Œè¿™é‡Œä¸å†å¯¹ç®¡é“èšåˆå’ŒçŸ©é˜µèšåˆè¿›è¡Œè®²è§£ã€‚</p>
<h2 id="èšåˆçš„å…·ä½“ç»“æ„"><a href="#èšåˆçš„å…·ä½“ç»“æ„" class="headerlink" title="èšåˆçš„å…·ä½“ç»“æ„"></a>èšåˆçš„å…·ä½“ç»“æ„</h2><p>æ‰€æœ‰çš„èšåˆï¼Œæ— è®ºå®ƒä»¬æ˜¯ä»€ä¹ˆç±»å‹ï¼Œéƒ½éµä»ä»¥ä¸‹çš„è§„åˆ™ã€‚</p>
<ul>
<li>ä½¿ç”¨æŸ¥è¯¢ä¸­åŒæ ·çš„ JSON è¯·æ±‚æ¥å®šä¹‰å®ƒä»¬ï¼Œè€Œä¸”ä½ æ˜¯ä½¿ç”¨é”® aggregations æˆ–è€…æ˜¯ aggs æ¥è¿›è¡Œæ ‡è®°ã€‚éœ€è¦ç»™æ¯ä¸ªèšåˆèµ·ä¸€ä¸ªåå­—ï¼ŒæŒ‡å®šå®ƒçš„ç±»å‹ä»¥åŠå’Œè¯¥ç±»å‹ç›¸å…³çš„é€‰é¡¹ã€‚</li>
<li>å®ƒä»¬è¿è¡Œåœ¨æŸ¥è¯¢çš„ç»“æœä¹‹ä¸Šã€‚å’ŒæŸ¥è¯¢ä¸åŒ¹é…çš„æ–‡æ¡£ä¸ä¼šè®¡ç®—åœ¨å†…ï¼Œé™¤éä½ ä½¿ç”¨ global èšé›†å°†ä¸åŒ¹é…çš„æ–‡æ¡£å›Šæ‹¬å…¶ä¸­ã€‚</li>
<li>å¯ä»¥è¿›ä¸€æ­¥è¿‡æ»¤æŸ¥è¯¢çš„ç»“æœï¼Œè€Œä¸å½±å“èšé›†ã€‚</li>
</ul>
<p>ä»¥ä¸‹æ˜¯èšåˆçš„åŸºæœ¬ç»“æ„ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;aggregations&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> &lt;!-- æœ€å¤–å±‚çš„èšåˆé”®ï¼Œä¹Ÿå¯ä»¥ç¼©å†™ä¸º aggs --&gt;</span><br><span class="line">    <span class="attr">&quot;&lt;aggregation_name&gt;&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> &lt;!-- èšåˆçš„è‡ªå®šä¹‰åå­— --&gt;</span><br><span class="line">        <span class="attr">&quot;&lt;aggregation_type&gt;&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> &lt;!-- èšåˆçš„ç±»å‹ï¼ŒæŒ‡æ ‡ç›¸å…³çš„ï¼Œå¦‚ maxã€minã€avgã€sumï¼Œæ¡¶ç›¸å…³çš„ termsã€filter ç­‰ --&gt;</span><br><span class="line">            &lt;aggregation_body&gt; &lt;!-- èšåˆä½“ï¼šå¯¹å“ªäº›å­—æ®µè¿›è¡Œèšåˆï¼Œå¯ä»¥å–å­—æ®µçš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯è„šæœ¬è®¡ç®—çš„ç»“æœ --&gt;</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">[</span><span class="punctuation">,</span><span class="attr">&quot;meta&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span>  <span class="punctuation">[</span>&lt;meta_data_body&gt;<span class="punctuation">]</span> <span class="punctuation">&#125;</span> <span class="punctuation">]</span>? &lt;!-- å…ƒ --&gt;</span><br><span class="line">        <span class="punctuation">[</span><span class="punctuation">,</span><span class="attr">&quot;aggregations&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="punctuation">[</span>&lt;sub_aggregation&gt;<span class="punctuation">]</span>+ <span class="punctuation">&#125;</span> <span class="punctuation">]</span>? &lt;!-- åœ¨èšåˆé‡Œé¢åœ¨å®šä¹‰å­èšåˆ --&gt;</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">[</span><span class="punctuation">,</span><span class="attr">&quot;&lt;aggregation_name_2&gt;&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> ... <span class="punctuation">&#125;</span> <span class="punctuation">]</span>* &lt;!-- èšåˆçš„è‡ªå®šä¹‰åå­— <span class="number">2</span> --&gt;</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>åœ¨æœ€ä¸Šå±‚æœ‰ä¸€ä¸ª aggregations çš„é”®ï¼Œå¯ä»¥ç¼©å†™ä¸º aggs</strong>ã€‚</li>
<li>åœ¨ä¸‹é¢ä¸€å±‚ï¼Œéœ€è¦ä¸ºèšåˆæŒ‡å®šä¸€ä¸ªåå­—ã€‚å¯ä»¥åœ¨è¯·æ±‚çš„è¿”å›ä¸­çœ‹åˆ°è¿™ä¸ªåå­—ã€‚åœ¨åŒä¸€ä¸ªè¯·æ±‚ä¸­ä½¿ç”¨å¤šä¸ªèšåˆæ—¶ï¼Œè¿™ä¸€ç‚¹éå¸¸æœ‰ç”¨ï¼Œå®ƒè®©ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°ç†è§£æ¯ç»„ç»“æœçš„å«ä¹‰ã€‚</li>
<li>æœ€åï¼Œå¿…é¡»è¦æŒ‡å®šèšåˆçš„ç±»å‹ã€‚</li>
</ul>
<blockquote>
<p>å…³äºèšåˆåˆ†æçš„å€¼æ¥æºï¼Œå¯ä»¥<strong>å–å­—æ®µçš„å€¼</strong>ï¼Œä¹Ÿå¯ä»¥æ˜¯<strong>è„šæœ¬è®¡ç®—çš„ç»“æœ</strong>ã€‚</p>
<p>ä½†æ˜¯ç”¨è„šæœ¬è®¡ç®—çš„ç»“æœæ—¶ï¼Œéœ€è¦æ³¨æ„è„šæœ¬çš„æ€§èƒ½å’Œå®‰å…¨æ€§ï¼›å°½ç®¡å¤šæ•°èšé›†ç±»å‹å…è®¸ä½¿ç”¨è„šæœ¬ï¼Œä½†æ˜¯è„šæœ¬ä½¿å¾—èšé›†å˜å¾—ç¼“æ…¢ï¼Œå› ä¸ºè„šæœ¬å¿…é¡»åœ¨æ¯ç¯‡æ–‡æ¡£ä¸Šè¿è¡Œã€‚ä¸ºäº†é¿å…è„šæœ¬çš„è¿è¡Œï¼Œå¯ä»¥åœ¨ç´¢å¼•é˜¶æ®µè¿›è¡Œè®¡ç®—ã€‚</p>
<p>æ­¤å¤–ï¼Œè„šæœ¬ä¹Ÿå¯ä»¥è¢«äººå¯èƒ½åˆ©ç”¨è¿›è¡Œæ¶æ„ä»£ç æ”»å‡»ï¼Œå°½é‡ä½¿ç”¨æ²™ç›’ï¼ˆsandboxï¼‰å†…çš„è„šæœ¬è¯­è¨€ã€‚</p>
</blockquote>
<p>ç¤ºä¾‹ï¼šæŸ¥è¯¢æ‰€æœ‰çƒå‘˜çš„å¹³å‡å¹´é¾„æ˜¯å¤šå°‘ï¼Œå¹¶å¯¹çƒå‘˜çš„å¹³å‡è–ªæ°´åŠ  188ï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºæ¯åçƒå‘˜åŠ  188 åçš„å¹³å‡è–ªæ°´ï¼‰ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /player/_search?size=0</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;avg_age&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;avg&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;age&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;avg_salary_188&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;avg&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;source&quot;</span>: <span class="string">&quot;doc.salary.value + 188&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æŒ‡æ ‡èšåˆ"><a href="#æŒ‡æ ‡èšåˆ" class="headerlink" title="æŒ‡æ ‡èšåˆ"></a>æŒ‡æ ‡èšåˆ</h2><p>æŒ‡æ ‡èšåˆï¼ˆåˆç§°åº¦é‡èšåˆï¼‰ä¸»è¦ä»ä¸åŒæ–‡æ¡£çš„åˆ†ç»„ä¸­æå–ç»Ÿè®¡æ•°æ®ï¼Œæˆ–è€…ï¼Œä»æ¥è‡ªå…¶ä»–èšåˆçš„æ–‡æ¡£æ¡¶æ¥æå–ç»Ÿè®¡æ•°æ®ã€‚</p>
<p>è¿™äº›ç»Ÿè®¡æ•°æ®é€šå¸¸æ¥è‡ªæ•°å€¼å‹å­—æ®µï¼Œå¦‚æœ€å°æˆ–è€…å¹³å‡ä»·æ ¼ã€‚ç”¨æˆ·å¯ä»¥å•ç‹¬è·å–æ¯é¡¹ç»Ÿè®¡æ•°æ®ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ stats èšåˆæ¥åŒæ—¶è·å–å®ƒä»¬ã€‚æ›´é«˜çº§çš„ç»Ÿè®¡æ•°æ®ï¼Œå¦‚å¹³æ–¹å’Œæˆ–è€…æ˜¯æ ‡å‡†å·®ï¼Œå¯ä»¥é€šè¿‡ extended stats èšåˆæ¥è·å–ã€‚</p>
<h3 id="Max-Aggregation"><a href="#Max-Aggregation" class="headerlink" title="Max Aggregation"></a>Max Aggregation</h3><p>Max Aggregation ç”¨äºæœ€å¤§å€¼ç»Ÿè®¡ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡ sales ç´¢å¼•ä¸­ä»·æ ¼æœ€é«˜çš„æ˜¯å“ªæœ¬ä¹¦ï¼Œå¹¶ä¸”è®¡ç®—å‡ºå¯¹åº”çš„ä»·æ ¼çš„ 2 å€å€¼ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> /sales/_search?<span class="attribute">size</span>=0</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;max_price&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;max&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span> : <span class="string">&quot;price&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_price_2&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;max&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span> : <span class="string">&quot;price&quot;</span>,</span><br><span class="line">        <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;source&quot;</span>: <span class="string">&quot;_value * 2.0&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æŒ‡å®šçš„ fieldï¼Œåœ¨è„šæœ¬ä¸­å¯ä»¥ç”¨ _value å–å­—æ®µçš„å€¼</strong>ã€‚</p>
<p>èšåˆç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;max_price&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: 188.0</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_price_2&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: 376.0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Min-Aggregation"><a href="#Min-Aggregation" class="headerlink" title="Min Aggregation"></a>Min Aggregation</h3><p>Min Aggregation ç”¨äºæœ€å°å€¼ç»Ÿè®¡ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡ sales ç´¢å¼•ä¸­ä»·æ ¼æœ€ä½çš„æ˜¯å“ªæœ¬ä¹¦ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> /sales/_search?<span class="attribute">size</span>=0</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;min_price&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;min&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span> : <span class="string">&quot;price&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>èšåˆç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;min_price&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: 18.0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Avg-Aggregation"><a href="#Avg-Aggregation" class="headerlink" title="Avg Aggregation"></a>Avg Aggregation</h3><p>Avg Aggregation ç”¨äºè®¡ç®—å¹³å‡å€¼ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡ exams ç´¢å¼•ä¸­è€ƒè¯•çš„å¹³å‡åˆ†æ•°ï¼Œå¦‚æœªå­˜åœ¨åˆ†æ•°ï¼Œé»˜è®¤ä¸º 60 åˆ†ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> /exams/_search?<span class="attribute">size</span>=0</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;avg_grade&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;avg&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span> : <span class="string">&quot;grade&quot;</span>,</span><br><span class="line">        <span class="string">&quot;missing&quot;</span>: 60</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœæŒ‡å®šå­—æ®µæ²¡æœ‰å€¼ï¼Œå¯ä»¥é€šè¿‡ missing æŒ‡å®šé»˜è®¤å€¼ï¼›è‹¥æœªæŒ‡å®šé»˜è®¤å€¼ï¼Œç¼ºå¤±è¯¥å­—æ®µå€¼çš„æ–‡æ¡£å°†è¢«å¿½ç•¥ï¼ˆè®¡ç®—ï¼‰</strong>ã€‚</p>
<p>èšåˆç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;avg_grade&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: 78.0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†å¸¸è§„çš„å¹³å‡å€¼èšåˆè®¡ç®—å¤–ï¼Œelasticsearch è¿˜æä¾›äº†åŠ æƒå¹³å‡å€¼çš„èšåˆè®¡ç®—ï¼Œè¯¦æƒ…å‚è§ <a target="_blank" rel="noopener" href="https://www.knowledgedict.com/tutorial/elasticsearch-aggregations-metrics-weighted-avg-aggregation.html">Elasticsearch æŒ‡æ ‡èšåˆä¹‹ Weighted Avg Aggregation</a>ã€‚</p>
<h3 id="Sum-Aggregation"><a href="#Sum-Aggregation" class="headerlink" title="Sum Aggregation"></a>Sum Aggregation</h3><p>Sum Aggregation ç”¨äºè®¡ç®—æ€»å’Œã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡ sales ç´¢å¼•ä¸­ type å­—æ®µä¸­åŒ¹é… hat çš„ä»·æ ¼æ€»å’Œï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> /exams/_search?<span class="attribute">size</span>=0</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;constant_score&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;filter&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;match&quot;</span> : &#123; <span class="string">&quot;type&quot;</span> : <span class="string">&quot;hat&quot;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;hat_prices&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;sum&quot;</span> : &#123; <span class="string">&quot;field&quot;</span> : <span class="string">&quot;price&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>èšåˆç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;hat_prices&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: 567.0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Value-Count-Aggregation"><a href="#Value-Count-Aggregation" class="headerlink" title="Value Count Aggregation"></a>Value Count Aggregation</h3><p>Value Count Aggregation å¯æŒ‰å­—æ®µç»Ÿè®¡æ–‡æ¡£æ•°é‡ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡ books ç´¢å¼•ä¸­åŒ…å« author å­—æ®µçš„æ–‡æ¡£æ•°é‡ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> /books/_search?<span class="attribute">size</span>=0</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;doc_count&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value_count&quot;</span> : &#123; <span class="string">&quot;field&quot;</span> : <span class="string">&quot;author&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>èšåˆç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;doc_count&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: 5</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Cardinality-Aggregation"><a href="#Cardinality-Aggregation" class="headerlink" title="Cardinality Aggregation"></a>Cardinality Aggregation</h3><p>Cardinality Aggregation ç”¨äºåŸºæ•°ç»Ÿè®¡ï¼Œå…¶ä½œç”¨æ˜¯å…ˆæ‰§è¡Œç±»ä¼¼ SQL ä¸­çš„ distinct æ“ä½œï¼Œå»æ‰é›†åˆä¸­çš„é‡å¤é¡¹ï¼Œç„¶åç»Ÿè®¡å»é‡åçš„é›†åˆé•¿åº¦ã€‚ä¾‹å¦‚ï¼Œåœ¨ books ç´¢å¼•ä¸­å¯¹ language å­—æ®µè¿›è¡Œ cardinality æ“ä½œå¯ä»¥ç»Ÿè®¡å‡ºç¼–ç¨‹è¯­è¨€çš„ç§ç±»æ•°ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> /books/_search?<span class="attribute">size</span>=0</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;all_lan&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;cardinality&quot;</span> : &#123; <span class="string">&quot;field&quot;</span> : <span class="string">&quot;language&quot;</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;title_cnt&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;cardinality&quot;</span> : &#123; <span class="string">&quot;field&quot;</span> : <span class="string">&quot;title.keyword&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å‡è®¾ title å­—æ®µä¸ºæ–‡æœ¬ç±»å‹ï¼ˆtextï¼‰ï¼Œå»é‡æ—¶éœ€è¦æŒ‡å®š keywordï¼Œè¡¨ç¤ºæŠŠ title ä½œä¸ºæ•´ä½“å»é‡ï¼Œå³ä¸åˆ†è¯ç»Ÿè®¡</strong>ã€‚</p>
<p>èšåˆç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;all_lan&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: 8</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;title_cnt&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: 18</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Stats-Aggregation"><a href="#Stats-Aggregation" class="headerlink" title="Stats Aggregation"></a>Stats Aggregation</h3><p>Stats Aggregation ç”¨äºåŸºæœ¬ç»Ÿè®¡ï¼Œä¼šä¸€æ¬¡è¿”å› countã€maxã€minã€avg å’Œ sum è¿™ 5 ä¸ªæŒ‡æ ‡ã€‚ä¾‹å¦‚ï¼Œåœ¨ exams ç´¢å¼•ä¸­å¯¹ grade å­—æ®µè¿›è¡Œåˆ†æ•°ç›¸å…³çš„åŸºæœ¬ç»Ÿè®¡ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> /exams/_search?<span class="attribute">size</span>=0</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;grades_stats&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;stats&quot;</span> : &#123; <span class="string">&quot;field&quot;</span> : <span class="string">&quot;grade&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>èšåˆç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;grades_stats&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;count&quot;</span>: 2,</span><br><span class="line">      <span class="string">&quot;min&quot;</span>: 50.0,</span><br><span class="line">      <span class="string">&quot;max&quot;</span>: 100.0,</span><br><span class="line">      <span class="string">&quot;avg&quot;</span>: 75.0,</span><br><span class="line">      <span class="string">&quot;sum&quot;</span>: 150.0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Extended-Stats-Aggregation"><a href="#Extended-Stats-Aggregation" class="headerlink" title="Extended Stats Aggregation"></a>Extended Stats Aggregation</h3><p>Extended Stats Aggregation ç”¨äºé«˜çº§ç»Ÿè®¡ï¼Œå’ŒåŸºæœ¬ç»Ÿè®¡åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ˜¯ä¼šæ¯”åŸºæœ¬ç»Ÿè®¡å¤šå‡ºä»¥ä¸‹å‡ ä¸ªç»Ÿè®¡ç»“æœï¼Œsum_of_squaresï¼ˆå¹³æ–¹å’Œï¼‰ã€varianceï¼ˆæ–¹å·®ï¼‰ã€std_deviationï¼ˆæ ‡å‡†å·®ï¼‰ã€std_deviation_boundsï¼ˆå¹³å‡å€¼åŠ &#x2F;å‡ä¸¤ä¸ªæ ‡å‡†å·®çš„åŒºé—´ï¼‰ã€‚åœ¨ exams ç´¢å¼•ä¸­å¯¹ grade å­—æ®µè¿›è¡Œåˆ†æ•°ç›¸å…³çš„é«˜çº§ç»Ÿè®¡ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> /exams/_search?<span class="attribute">size</span>=0</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;grades_stats&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;extended_stats&quot;</span> : &#123; <span class="string">&quot;field&quot;</span> : <span class="string">&quot;grade&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>èšåˆç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;grades_stats&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;count&quot;</span>: 2,</span><br><span class="line">      <span class="string">&quot;min&quot;</span>: 50.0,</span><br><span class="line">      <span class="string">&quot;max&quot;</span>: 100.0,</span><br><span class="line">      <span class="string">&quot;avg&quot;</span>: 75.0,</span><br><span class="line">      <span class="string">&quot;sum&quot;</span>: 150.0,</span><br><span class="line">      <span class="string">&quot;sum_of_squares&quot;</span>: 12500.0,</span><br><span class="line">      <span class="string">&quot;variance&quot;</span>: 625.0,</span><br><span class="line">      <span class="string">&quot;std_deviation&quot;</span>: 25.0,</span><br><span class="line">      <span class="string">&quot;std_deviation_bounds&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;upper&quot;</span>: 125.0,</span><br><span class="line">        <span class="string">&quot;lower&quot;</span>: 25.0</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Percentiles-Aggregation"><a href="#Percentiles-Aggregation" class="headerlink" title="Percentiles Aggregation"></a>Percentiles Aggregation</h3><p>Percentiles Aggregation ç”¨äºç™¾åˆ†ä½ç»Ÿè®¡ã€‚ç™¾åˆ†ä½æ•°æ˜¯ä¸€ä¸ªç»Ÿè®¡å­¦æœ¯è¯­ï¼Œå¦‚æœå°†ä¸€ç»„æ•°æ®ä»å¤§åˆ°å°æ’åºï¼Œå¹¶è®¡ç®—ç›¸åº”çš„ç´¯è®¡ç™¾åˆ†ä½ï¼ŒæŸä¸€ç™¾åˆ†ä½æ‰€å¯¹åº”æ•°æ®çš„å€¼å°±ç§°ä¸ºè¿™ä¸€ç™¾åˆ†ä½çš„ç™¾åˆ†ä½æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç´¯è®¡ç™¾åˆ†ä½ä¸º [ 1, 5, 25, 50, 75, 95, 99 ]ã€‚ä»¥ä¸‹ä¾‹å­ç»™å‡ºäº†åœ¨ latency ç´¢å¼•ä¸­å¯¹ load_time å­—æ®µè¿›è¡ŒåŠ è½½æ—¶é—´çš„ç™¾åˆ†ä½ç»Ÿè®¡ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET latency/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;load_time_outlier&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;percentiles&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span> : &quot;<span class="type">load_time</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚ä¸Šçš„ <code>load_time</code> å­—æ®µå¿…é¡»æ˜¯æ•°å­—ç±»å‹</strong>ã€‚</p>
<p>èšåˆç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;load_time_outlier&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;values&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;1.0&quot;</span>: <span class="number">5.0</span>,</span><br><span class="line">        <span class="string">&quot;5.0&quot;</span>: <span class="number">25.0</span>,</span><br><span class="line">        <span class="string">&quot;25.0&quot;</span>: <span class="number">165.0</span>,</span><br><span class="line">        <span class="string">&quot;50.0&quot;</span>: <span class="number">445.0</span>,</span><br><span class="line">        <span class="string">&quot;75.0&quot;</span>: <span class="number">725.0</span>,</span><br><span class="line">        <span class="string">&quot;95.0&quot;</span>: <span class="number">945.0</span>,</span><br><span class="line">        <span class="string">&quot;99.0&quot;</span>: <span class="number">985.0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç™¾åˆ†ä½çš„ç»Ÿè®¡ä¹Ÿå¯ä»¥æŒ‡å®š percents å‚æ•°æŒ‡å®šç™¾åˆ†ä½ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET latency/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;load_time_outlier&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;percentiles&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span> : &quot;<span class="type">load_time</span><span class="string">&quot;,</span></span><br><span class="line"><span class="string">        &quot;</span>percents<span class="string">&quot;: [60, 80, 95]</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Percentiles-Ranks-Aggregation"><a href="#Percentiles-Ranks-Aggregation" class="headerlink" title="Percentiles Ranks Aggregation"></a>Percentiles Ranks Aggregation</h3><p>Percentiles Ranks Aggregation ä¸ Percentiles Aggregation ç»Ÿè®¡æ°æ°ç›¸åï¼Œå°±æ˜¯æƒ³çœ‹å½“å‰æ•°å€¼å¤„åœ¨ä»€ä¹ˆèŒƒå›´å†…ï¼ˆç™¾åˆ†ä½ï¼‰ï¼Œ å‡å¦‚ä½ æŸ¥ä¸€ä¸‹å½“å‰å€¼ 500 å’Œ 600 æ‰€å¤„çš„ç™¾åˆ†ä½ï¼Œå‘ç°æ˜¯ 90.01 å’Œ 100ï¼Œé‚£ä¹ˆè¯´æ˜æœ‰ 90.01 % çš„æ•°å€¼éƒ½åœ¨ 500 ä»¥å†…ï¼Œ100 % çš„æ•°å€¼åœ¨ 600 ä»¥å†…ã€‚</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET latency/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;load_time_ranks&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;percentile_ranks&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;field&quot;</span> : &quot;<span class="type">load_time</span><span class="string">&quot;,</span></span><br><span class="line"><span class="string">          &quot;</span>values<span class="string">&quot; : [500, 600]</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong><code>åŒæ · load_time</code> å­—æ®µå¿…é¡»æ˜¯æ•°å­—ç±»å‹</strong>ã€‚</p>
<p>è¿”å›ç»“æœå¤§æ¦‚ç±»ä¼¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;load_time_ranks&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;values&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;500.0&quot;</span>: <span class="number">90.01</span>,</span><br><span class="line">        <span class="string">&quot;600.0&quot;</span>: <span class="number">100.0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è®¾ç½® <code>keyed</code> å‚æ•°ä¸º <code>true</code>ï¼Œå°†å¯¹åº”çš„ values ä½œä¸ºæ¡¶ key ä¸€èµ·è¿”å›ï¼Œé»˜è®¤æ˜¯ <code>false</code>ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> latency/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;load_time_ranks&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;percentile_ranks&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;load_time&quot;</span>,</span><br><span class="line">        <span class="string">&quot;values&quot;</span>: [500, 600],</span><br><span class="line">        <span class="string">&quot;keyed&quot;</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;load_time_ranks&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;values&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="number">500.0</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="number">90.01</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: <span class="number">600.0</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="number">100.0</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ¡¶èšåˆ"><a href="#æ¡¶èšåˆ" class="headerlink" title="æ¡¶èšåˆ"></a>æ¡¶èšåˆ</h2><p>bucket å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ¡¶ï¼Œå®ƒä¼šéå†æ–‡æ¡£ä¸­çš„å†…å®¹ï¼Œå‡¡æ˜¯ç¬¦åˆæŸä¸€è¦æ±‚çš„å°±æ”¾å…¥ä¸€ä¸ªæ¡¶ä¸­ï¼Œåˆ†æ¡¶ç›¸å½“äº SQL ä¸­çš„ group byã€‚ä»å¦å¤–ä¸€ä¸ªè§’åº¦ï¼Œå¯ä»¥å°†æŒ‡æ ‡èšåˆçœ‹æˆå•æ¡¶èšåˆï¼Œå³æŠŠæ‰€æœ‰æ–‡æ¡£æ”¾åˆ°ä¸€ä¸ªæ¡¶ä¸­ï¼Œè€Œæ¡¶èšåˆæ˜¯å¤šæ¡¶å‹èšåˆï¼Œå®ƒæ ¹æ®ç›¸åº”çš„æ¡ä»¶è¿›è¡Œåˆ†ç»„ã€‚</p>
<table>
<thead>
<tr>
<th align="left">ç§ç±»</th>
<th align="left">æè¿°&#x2F;åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td align="left">è¯é¡¹èšåˆï¼ˆTerms Aggregationï¼‰</td>
<td align="left">ç”¨äºåˆ†ç»„èšåˆï¼Œè®©ç”¨æˆ·å¾—çŸ¥æ–‡æ¡£ä¸­æ¯ä¸ªè¯é¡¹çš„é¢‘ç‡ï¼Œå®ƒè¿”å›æ¯ä¸ªè¯é¡¹å‡ºç°çš„æ¬¡æ•°ã€‚</td>
</tr>
<tr>
<td align="left">å·®å¼‚è¯é¡¹èšåˆï¼ˆSignificant Terms Aggregationï¼‰</td>
<td align="left">å®ƒä¼šè¿”å›æŸä¸ªè¯é¡¹åœ¨æ•´ä¸ªç´¢å¼•ä¸­å’Œåœ¨æŸ¥è¯¢ç»“æœä¸­çš„è¯é¢‘å·®å¼‚ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬å‘ç°æœç´¢åœºæ™¯ä¸­æœ‰æ„ä¹‰çš„è¯ã€‚</td>
</tr>
<tr>
<td align="left">è¿‡æ»¤å™¨èšåˆï¼ˆFilter Aggregationï¼‰</td>
<td align="left">æŒ‡å®šè¿‡æ»¤å™¨åŒ¹é…çš„æ‰€æœ‰æ–‡æ¡£åˆ°å•ä¸ªæ¡¶ï¼ˆbucketï¼‰ï¼Œé€šå¸¸è¿™å°†ç”¨äºå°†å½“å‰èšåˆä¸Šä¸‹æ–‡ç¼©å°åˆ°ä¸€ç»„ç‰¹å®šçš„æ–‡æ¡£ã€‚</td>
</tr>
<tr>
<td align="left">å¤šè¿‡æ»¤å™¨èšåˆï¼ˆFilters Aggregationï¼‰</td>
<td align="left">æŒ‡å®šå¤šä¸ªè¿‡æ»¤å™¨åŒ¹é…æ‰€æœ‰æ–‡æ¡£åˆ°å¤šä¸ªæ¡¶ï¼ˆbucketï¼‰ã€‚</td>
</tr>
<tr>
<td align="left">èŒƒå›´èšåˆï¼ˆRange Aggregationï¼‰</td>
<td align="left">èŒƒå›´èšåˆï¼Œç”¨äºåæ˜ æ•°æ®çš„åˆ†å¸ƒæƒ…å†µã€‚</td>
</tr>
<tr>
<td align="left">æ—¥æœŸèŒƒå›´èšåˆï¼ˆDate Range Aggregationï¼‰</td>
<td align="left">ä¸“é—¨ç”¨äºæ—¥æœŸç±»å‹çš„èŒƒå›´èšåˆã€‚</td>
</tr>
<tr>
<td align="left">IP èŒƒå›´èšåˆï¼ˆIP Range Aggregationï¼‰</td>
<td align="left">ç”¨äºå¯¹ IP ç±»å‹æ•°æ®èŒƒå›´èšåˆã€‚</td>
</tr>
<tr>
<td align="left">ç›´æ–¹å›¾èšåˆï¼ˆHistogram Aggregationï¼‰</td>
<td align="left">å¯èƒ½æ˜¯æ•°å€¼ï¼Œæˆ–è€…æ—¥æœŸå‹ï¼Œå’ŒèŒƒå›´èšé›†ç±»ä¼¼ã€‚</td>
</tr>
<tr>
<td align="left">æ—¶é—´ç›´æ–¹å›¾èšåˆï¼ˆDate Histogram Aggregationï¼‰</td>
<td align="left">æ—¶é—´ç›´æ–¹å›¾èšåˆï¼Œå¸¸ç”¨äºæŒ‰ç…§æ—¥æœŸå¯¹æ–‡æ¡£è¿›è¡Œç»Ÿè®¡å¹¶ç»˜åˆ¶æ¡å½¢å›¾ã€‚</td>
</tr>
<tr>
<td align="left">ç©ºå€¼èšåˆï¼ˆMissing Aggregationï¼‰</td>
<td align="left">ç©ºå€¼èšåˆï¼Œå¯ä»¥æŠŠæ–‡æ¡£é›†ä¸­æ‰€æœ‰ç¼ºå¤±å­—æ®µçš„æ–‡æ¡£åˆ†åˆ°ä¸€ä¸ªæ¡¶ä¸­ã€‚</td>
</tr>
<tr>
<td align="left">åœ°ç†ç‚¹èŒƒå›´èšåˆï¼ˆGeo Distance Aggregationï¼‰</td>
<td align="left">ç”¨äºå¯¹åœ°ç†ç‚¹ï¼ˆgeo pointï¼‰åšèŒƒå›´ç»Ÿè®¡ã€‚</td>
</tr>
</tbody></table>
<h3 id="Terms-Aggregation"><a href="#Terms-Aggregation" class="headerlink" title="Terms Aggregation"></a>Terms Aggregation</h3><p>Terms Aggregation ç”¨äºè¯é¡¹çš„åˆ†ç»„èšåˆã€‚æœ€ä¸ºç»å…¸çš„ç”¨ä¾‹æ˜¯è·å– X ä¸­æœ€é¢‘ç¹ï¼ˆtop frequentï¼‰çš„é¡¹ç›®ï¼Œå…¶ä¸­ X æ˜¯æ–‡æ¡£ä¸­çš„æŸä¸ªå­—æ®µï¼Œå¦‚ç”¨æˆ·çš„åç§°ã€æ ‡ç­¾æˆ–åˆ†ç±»ã€‚ç”±äº terms èšé›†ç»Ÿè®¡çš„æ˜¯æ¯ä¸ªè¯æ¡ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå­—æ®µå€¼ï¼Œå› æ­¤é€šå¸¸éœ€è¦åœ¨ä¸€ä¸ªéåˆ†æå‹çš„å­—æ®µä¸Šè¿è¡Œè¿™ç§èšé›†ã€‚åŸå› æ˜¯, ä½ æœŸæœ›â€œbig dataâ€ä½œä¸ºè¯ç»„ç»Ÿè®¡ï¼Œè€Œä¸æ˜¯â€œbigâ€å•ç‹¬ç»Ÿè®¡ä¸€æ¬¡ï¼Œâ€œdataâ€å†å•ç‹¬ç»Ÿè®¡ä¸€æ¬¡ã€‚</p>
<p>ç”¨æˆ·å¯ä»¥ä½¿ç”¨ terms èšé›†ï¼Œä»åˆ†æå‹å­—æ®µï¼ˆå¦‚å†…å®¹ï¼‰ä¸­æŠ½å–æœ€ä¸ºé¢‘ç¹çš„è¯æ¡ã€‚è¿˜å¯ä»¥ä½¿ç”¨è¿™ç§ä¿¡æ¯æ¥ç”Ÿæˆä¸€ä¸ªå•è¯äº‘ã€‚</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;profit_terms&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123; <span class="comment">// terms èšåˆ å…³é”®å­—</span></span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;profit&quot;</span>,</span><br><span class="line">        <span class="params">...</span><span class="params">...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ terms åˆ†æ¡¶çš„åŸºç¡€ä¸Šï¼Œè¿˜å¯ä»¥å¯¹æ¯ä¸ªæ¡¶è¿›è¡ŒæŒ‡æ ‡ç»Ÿè®¡ï¼Œä¹Ÿå¯ä»¥åŸºäºä¸€äº›æŒ‡æ ‡æˆ–å­—æ®µå€¼è¿›è¡Œæ’åºã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;item_terms&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;item_id&quot;</span>,</span><br><span class="line">        <span class="string">&quot;size&quot;</span>: <span class="number">1000</span>,</span><br><span class="line">        <span class="string">&quot;order&quot;</span>:[&#123;</span><br><span class="line">          <span class="string">&quot;gmv_stat&quot;</span>: <span class="string">&quot;desc&quot;</span></span><br><span class="line">        &#125;,&#123;</span><br><span class="line">          <span class="string">&quot;gmv_180d&quot;</span>: <span class="string">&quot;desc&quot;</span></span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;gmv_stat&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;sum&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;gmv&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;gmv_180d&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;sum&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;script&quot;</span>: <span class="string">&quot;doc[&#x27;gmv_90d&#x27;].value*2&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;hospital_id_agg&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;doc_count_error_upper_bound&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;sum_other_doc_count&quot;</span>: 260,</span><br><span class="line">      <span class="string">&quot;buckets&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: 23388,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 18,</span><br><span class="line">          <span class="string">&quot;gmv_stat&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;value&quot;</span>: 176220</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;gmv_180d&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;value&quot;</span>: 89732</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span>: 96117,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 16,</span><br><span class="line">          <span class="string">&quot;gmv_stat&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;value&quot;</span>: 129306</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;gmv_180d&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;value&quot;</span>: 56988</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">...</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹è¿”å›æŒ‰æ–‡æ¡£è®¡æ•°ä»é«˜åˆ°ä½çš„å‰ 10 ä¸ªåˆ†ç»„ï¼Œå¯ä»¥é€šè¿‡ size å‚æ•°æŒ‡å®šè¿”å›çš„åˆ†ç»„æ•°ã€‚</p>
<h3 id="Filter-Aggregation"><a href="#Filter-Aggregation" class="headerlink" title="Filter Aggregation"></a>Filter Aggregation</h3><p>Filter Aggregation æ˜¯è¿‡æ»¤å™¨èšåˆï¼Œå¯ä»¥æŠŠç¬¦åˆè¿‡æ»¤å™¨ä¸­çš„æ¡ä»¶çš„æ–‡æ¡£åˆ†åˆ°ä¸€ä¸ªæ¡¶ä¸­ï¼Œå³æ˜¯å•åˆ†ç»„èšåˆã€‚</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;age_terms&quot;: &#123;</span><br><span class="line">      &quot;<span class="attribute">filter</span>&quot;: &#123;&quot;match&quot;:&#123;&quot;gender&quot;:<span class="string">&quot;F&quot;</span>&#125;&#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123;</span><br><span class="line">        &quot;avg_age&quot;: &#123;</span><br><span class="line">          &quot;avg&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: <span class="string">&quot;age&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Filters-Aggregation"><a href="#Filters-Aggregation" class="headerlink" title="Filters Aggregation"></a>Filters Aggregation</h3><p>Filters Aggregation æ˜¯å¤šè¿‡æ»¤å™¨èšåˆï¼Œå¯ä»¥æŠŠç¬¦åˆå¤šä¸ªè¿‡æ»¤æ¡ä»¶çš„æ–‡æ¡£åˆ†åˆ°ä¸åŒçš„æ¡¶ä¸­ï¼Œå³æ¯ä¸ªåˆ†ç»„å…³è”ä¸€ä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œå¹¶æ”¶é›†æ‰€æœ‰æ»¡è¶³è‡ªèº«è¿‡æ»¤æ¡ä»¶çš„æ–‡æ¡£ã€‚</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: <span class="number">0</span>,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    &quot;messages&quot;: &#123;</span><br><span class="line">      &quot;filters&quot;: &#123;</span><br><span class="line">        &quot;filters&quot;: &#123;</span><br><span class="line">          &quot;errors&quot;: &#123; &quot;match&quot;: &#123; &quot;<span class="selector-tag">body</span>&quot;: <span class="string">&quot;error&quot;</span> &#125; &#125;,</span><br><span class="line">          &quot;warnings&quot;: &#123; &quot;match&quot;: &#123; &quot;<span class="selector-tag">body</span>&quot;: <span class="string">&quot;warning&quot;</span> &#125; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬åˆ†ææ—¥å¿—ä¿¡æ¯ã€‚èšåˆä¼šåˆ›å»ºä¸¤ä¸ªå…³äºæ—¥å¿—æ•°æ®çš„åˆ†ç»„ï¼Œä¸€ä¸ªæ”¶é›†åŒ…å«é”™è¯¯ä¿¡æ¯çš„æ–‡æ¡£ï¼Œå¦ä¸€ä¸ªæ”¶é›†åŒ…å«å‘Šè­¦ä¿¡æ¯çš„æ–‡æ¡£ã€‚è€Œä¸”æ¯ä¸ªåˆ†ç»„ä¼šæŒ‰æœˆä»½åˆ’åˆ†ã€‚</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;messages&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;buckets&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;errors&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 1</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;warnings&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span>: 2</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Range-Aggregation"><a href="#Range-Aggregation" class="headerlink" title="Range Aggregation"></a>Range Aggregation</h3><p>Range Aggregation èŒƒå›´èšåˆæ˜¯ä¸€ä¸ªåŸºäºå¤šç»„å€¼æ¥æºçš„èšåˆï¼Œå¯ä»¥è®©ç”¨æˆ·å®šä¹‰ä¸€ç³»åˆ—èŒƒå›´ï¼Œæ¯ä¸ªèŒƒå›´ä»£è¡¨ä¸€ä¸ªåˆ†ç»„ã€‚åœ¨èšåˆæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä»æ¯ä¸ªæ–‡æ¡£æå–å‡ºæ¥çš„å€¼éƒ½ä¼šæ£€æŸ¥æ¯ä¸ªåˆ†ç»„çš„èŒƒå›´ï¼Œå¹¶ä¸”ä½¿ç›¸å…³çš„æ–‡æ¡£è½å…¥åˆ†ç»„ä¸­ã€‚æ³¨æ„ï¼ŒèŒƒå›´èšåˆçš„æ¯ä¸ªèŒƒå›´å†…åŒ…å« from å€¼ä½†æ˜¯æ’é™¤ to å€¼ã€‚</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;age_range&quot;: &#123;</span><br><span class="line">      &quot;range&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: <span class="string">&quot;age&quot;</span>,</span><br><span class="line">          <span class="string">&quot;ranges&quot;</span>: [&#123;</span><br><span class="line">            &quot;<span class="selector-tag">to</span>&quot;: <span class="number">25</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;<span class="selector-tag">from</span>&quot;: <span class="number">25</span>,</span><br><span class="line">            <span class="string">&quot;to&quot;</span>: <span class="number">35</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;<span class="selector-tag">from</span>&quot;: <span class="number">35</span></span><br><span class="line">          &#125;]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;aggs&quot;: &#123;</span><br><span class="line">          &quot;bmax&quot;: &#123;</span><br><span class="line">            &quot;max&quot;: &#123;</span><br><span class="line">              &quot;field&quot;: <span class="string">&quot;balance&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;age_range&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;buckets&quot;</span>: [&#123;</span><br><span class="line">        <span class="string">&quot;key&quot;</span>: <span class="string">&quot;*-25.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;to&quot;</span>: <span class="number">25</span>,</span><br><span class="line">        <span class="string">&quot;doc_count&quot;</span>: <span class="number">225</span>,</span><br><span class="line">        <span class="string">&quot;bmax&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="number">49587</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;key&quot;</span>: <span class="string">&quot;25.0-35.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;from&quot;</span>: <span class="number">25</span>,</span><br><span class="line">        <span class="string">&quot;to&quot;</span>: <span class="number">35</span>,</span><br><span class="line">        <span class="string">&quot;doc_count&quot;</span>: <span class="number">485</span>,</span><br><span class="line">        <span class="string">&quot;bmax&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="number">49795</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;key&quot;</span>: <span class="string">&quot;35.0-*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;from&quot;</span>: <span class="number">35</span>,</span><br><span class="line">        <span class="string">&quot;doc_count&quot;</span>: <span class="number">290</span>,</span><br><span class="line">        <span class="string">&quot;bmax&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="number">49989</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.knowledgedict.com/tutorial/elasticsearch-intro.html">Elasticsearch æ•™ç¨‹</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/83bd15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/83bd15/" class="post-title-link" itemprop="url">Elasticsearch æŸ¥è¯¢</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-01-18 08:01:08" itemprop="dateCreated datePublished" datetime="2022-01-18T08:01:08+08:00">2022-01-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-23 18:54:25" itemprop="dateModified" datetime="2022-09-23T18:54:25+08:00">2022-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">æ•°æ®åº“</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">æœç´¢å¼•æ“æ•°æ®åº“</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/Elasticsearch/" itemprop="url" rel="index"><span itemprop="name">Elasticsearch</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>34k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>31 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Elasticsearch-æŸ¥è¯¢"><a href="#Elasticsearch-æŸ¥è¯¢" class="headerlink" title="Elasticsearch æŸ¥è¯¢"></a>Elasticsearch æŸ¥è¯¢</h1><p>Elasticsearch æŸ¥è¯¢è¯­å¥é‡‡ç”¨åŸºäº RESTful é£æ ¼çš„æ¥å£å°è£…æˆ JSON æ ¼å¼çš„å¯¹è±¡ï¼Œç§°ä¹‹ä¸º Query DSLã€‚Elasticsearch æŸ¥è¯¢åˆ†ç±»å¤§è‡´åˆ†ä¸º<strong>å…¨æ–‡æŸ¥è¯¢</strong>ã€<strong>è¯é¡¹æŸ¥è¯¢</strong>ã€<strong>å¤åˆæŸ¥è¯¢</strong>ã€<strong>åµŒå¥—æŸ¥è¯¢</strong>ã€<strong>ä½ç½®æŸ¥è¯¢</strong>ã€<strong>ç‰¹æ®ŠæŸ¥è¯¢</strong>ã€‚Elasticsearch æŸ¥è¯¢ä»æœºåˆ¶åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯æ ¹æ®ç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢è¯ï¼Œé€šè¿‡æ’åºæ¨¡å‹è®¡ç®—æ–‡æ¡£ä¸æŸ¥è¯¢è¯ä¹‹é—´çš„<strong>ç›¸å…³åº¦</strong>ï¼Œå¹¶æ ¹æ®è¯„åˆ†é«˜ä½æ’åºè¿”å›ï¼›å¦ä¸€ç§æ˜¯<strong>è¿‡æ»¤æœºåˆ¶</strong>ï¼Œåªæ ¹æ®è¿‡æ»¤æ¡ä»¶å¯¹æ–‡æ¡£è¿›è¡Œè¿‡æ»¤ï¼Œä¸è®¡ç®—è¯„åˆ†ï¼Œé€Ÿåº¦ç›¸å¯¹è¾ƒå¿«ã€‚</p>
<h2 id="å…¨æ–‡æŸ¥è¯¢"><a href="#å…¨æ–‡æŸ¥è¯¢" class="headerlink" title="å…¨æ–‡æŸ¥è¯¢"></a>å…¨æ–‡æŸ¥è¯¢</h2><p>ES å…¨æ–‡æŸ¥è¯¢ä¸»è¦ç”¨äºåœ¨å…¨æ–‡å­—æ®µä¸Šï¼Œä¸»è¦è€ƒè™‘æŸ¥è¯¢è¯ä¸æ–‡æ¡£çš„ç›¸å…³æ€§ï¼ˆRelevanceï¼‰ã€‚</p>
<h3 id="intervals-query"><a href="#intervals-query" class="headerlink" title="intervals query"></a>intervals query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-intervals-query.html"><strong><code>intervals query</code></strong></a> æ ¹æ®åŒ¹é…è¯çš„é¡ºåºå’Œè¿‘ä¼¼åº¦è¿”å›æ–‡æ¡£ã€‚</p>
<p>intervals query ä½¿ç”¨<strong>åŒ¹é…è§„åˆ™</strong>ï¼Œè¿™äº›è§„åˆ™åº”ç”¨äºæŒ‡å®šå­—æ®µä¸­çš„ termã€‚</p>
<p>ç¤ºä¾‹ï¼šä¸‹é¢ç¤ºä¾‹æœç´¢ <code>query</code> å­—æ®µï¼Œæœç´¢å€¼æ˜¯ <code>my favorite food</code>ï¼Œæ²¡æœ‰ä»»ä½•é—´éš™ï¼›ç„¶åæ˜¯ <code>my_text</code> å­—æ®µæœç´¢åŒ¹é… <code>hot water</code>ã€<code>cold porridge</code> çš„ termã€‚</p>
<p>å½“ my_text ä¸­çš„å€¼ä¸º <code>my favorite food is cold porridge</code> æ—¶ï¼Œä¼šåŒ¹é…æˆåŠŸï¼Œä½†æ˜¯ <code>when it&#39;s cold my favorite food is porridge</code> åˆ™åŒ¹é…å¤±è´¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">POST _search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;intervals&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;my_text&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;all_of&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;ordered&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">          <span class="string">&quot;intervals&quot;</span> : [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">&quot;match&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;query&quot;</span> : <span class="string">&quot;my favorite food&quot;</span>,</span><br><span class="line">                <span class="string">&quot;max_gaps&quot;</span> : 0,</span><br><span class="line">                <span class="string">&quot;ordered&quot;</span> : <span class="literal">true</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">&quot;any_of&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;intervals&quot;</span> : [</span><br><span class="line">                  &#123; <span class="string">&quot;match&quot;</span> : &#123; <span class="string">&quot;query&quot;</span> : <span class="string">&quot;hot water&quot;</span> &#125; &#125;,</span><br><span class="line">                  &#123; <span class="string">&quot;match&quot;</span> : &#123; <span class="string">&quot;query&quot;</span> : <span class="string">&quot;cold porridge&quot;</span> &#125; &#125;</span><br><span class="line">                ]</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="match-query"><a href="#match-query" class="headerlink" title="match query"></a>match query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html"><strong><code>match query</code></strong></a> <strong>ç”¨äºæœç´¢å•ä¸ªå­—æ®µ</strong>ï¼Œé¦–å…ˆä¼šé’ˆå¯¹æŸ¥è¯¢è¯­å¥è¿›è¡Œè§£æï¼ˆç»è¿‡ analyzerï¼‰ï¼Œä¸»è¦æ˜¯å¯¹æŸ¥è¯¢è¯­å¥è¿›è¡Œåˆ†è¯ï¼Œåˆ†è¯åæŸ¥è¯¢è¯­å¥çš„ä»»ä½•ä¸€ä¸ªè¯é¡¹è¢«åŒ¹é…ï¼Œæ–‡æ¡£å°±ä¼šè¢«æœåˆ°ï¼Œé»˜è®¤æƒ…å†µä¸‹ç›¸å½“äºå¯¹åˆ†è¯åè¯é¡¹è¿›è¡Œ or åŒ¹é…æ“ä½œã€‚</p>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html"><strong><code>match query</code></strong></a> æ˜¯æ‰§è¡Œå…¨æ–‡æœç´¢çš„æ ‡å‡†æŸ¥è¯¢ï¼ŒåŒ…æ‹¬æ¨¡ç³ŠåŒ¹é…é€‰é¡¹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;customer_full_name&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: <span class="string">&quot;George Hubbard&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç­‰åŒäº <code>or</code> åŒ¹é…æ“ä½œï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;customer_full_name&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: <span class="string">&quot;George Hubbard&quot;</span>,</span><br><span class="line">        <span class="string">&quot;operator&quot;</span>: <span class="string">&quot;or&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="match-query-ç®€å†™"><a href="#match-query-ç®€å†™" class="headerlink" title="match query ç®€å†™"></a>match query ç®€å†™</h4><p>å¯ä»¥é€šè¿‡ç»„åˆ <code>&lt;field&gt;</code> å’Œ <code>query</code> å‚æ•°æ¥ç®€åŒ–åŒ¹é…æŸ¥è¯¢è¯­æ³•ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: <span class="string">&quot;this is a test&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="match-query-å¦‚ä½•å·¥ä½œ"><a href="#match-query-å¦‚ä½•å·¥ä½œ" class="headerlink" title="match query å¦‚ä½•å·¥ä½œ"></a>match query å¦‚ä½•å·¥ä½œ</h4><p>åŒ¹é…æŸ¥è¯¢æ˜¯å¸ƒå°”ç±»å‹ã€‚è¿™æ„å‘³ç€ä¼šå¯¹æä¾›çš„æ–‡æœ¬è¿›è¡Œåˆ†æï¼Œåˆ†æè¿‡ç¨‹ä»æä¾›çš„æ–‡æœ¬æ„é€ ä¸€ä¸ªå¸ƒå°”æŸ¥è¯¢ã€‚ <code>operator</code> å‚æ•°å¯ä»¥è®¾ç½®ä¸º <code>or</code> æˆ– <code>and</code> æ¥æ§åˆ¶å¸ƒå°”å­å¥ï¼ˆé»˜è®¤ä¸º <code>or</code>ï¼‰ã€‚å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-minimum-should-match.html"><code>minimum_should_match</code></a> å‚æ•°è®¾ç½®è¦åŒ¹é…çš„å¯é€‰ <code>should</code> å­å¥çš„æœ€å°æ•°é‡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;customer_full_name&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: <span class="string">&quot;George Hubbard&quot;</span>,</span><br><span class="line">        <span class="string">&quot;operator&quot;</span>: <span class="string">&quot;and&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è®¾ç½® <code>analyzer</code> æ¥æ§åˆ¶å“ªä¸ªåˆ†æå™¨å°†å¯¹æ–‡æœ¬æ‰§è¡Œåˆ†æè¿‡ç¨‹ã€‚å®ƒé»˜è®¤ä¸ºå­—æ®µæ˜¾å¼æ˜ å°„å®šä¹‰æˆ–é»˜è®¤æœç´¢åˆ†æå™¨ã€‚</p>
<p><code>lenient</code> å‚æ•°å¯ä»¥è®¾ç½®ä¸º <code>true</code> ä»¥å¿½ç•¥ç”±æ•°æ®ç±»å‹ä¸åŒ¹é…å¯¼è‡´çš„å¼‚å¸¸ï¼Œä¾‹å¦‚å°è¯•ä½¿ç”¨æ–‡æœ¬æŸ¥è¯¢å­—ç¬¦ä¸²æŸ¥è¯¢æ•°å­—å­—æ®µã€‚é»˜è®¤ä¸º <code>false</code>ã€‚</p>
<h4 id="match-query-çš„æ¨¡ç³ŠæŸ¥è¯¢"><a href="#match-query-çš„æ¨¡ç³ŠæŸ¥è¯¢" class="headerlink" title="match query çš„æ¨¡ç³ŠæŸ¥è¯¢"></a>match query çš„æ¨¡ç³ŠæŸ¥è¯¢</h4><p><code>fuzziness</code> å…è®¸åŸºäºè¢«æŸ¥è¯¢å­—æ®µçš„ç±»å‹è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ã€‚è¯·å‚é˜… <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/common-options.html#fuzziness">Fuzziness</a> çš„é…ç½®ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥è®¾ç½® <code>prefix_length</code> å’Œ <code>max_expansions</code> æ¥æ§åˆ¶æ¨¡ç³ŠåŒ¹é…ã€‚å¦‚æœè®¾ç½®äº†æ¨¡ç³Šé€‰é¡¹ï¼ŒæŸ¥è¯¢å°†ä½¿ç”¨ <code>top_terms_blended_freqs_$&#123;max_expansions&#125;</code> ä½œä¸ºå…¶é‡å†™æ–¹æ³•ï¼Œ<code>fuzzy_rewrite</code> å‚æ•°å…è®¸æ§åˆ¶æŸ¥è¯¢å°†å¦‚ä½•è¢«é‡å†™ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹å…è®¸æ¨¡ç³Šå€’è½¬ (<code>ab</code> â†’ <code>ba</code>)ï¼Œä½†å¯ä»¥é€šè¿‡å°† <code>fuzzy_transpositions</code> è®¾ç½®ä¸º <code>false</code> æ¥ç¦ç”¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: <span class="string">&quot;this is a testt&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fuzziness&quot;</span>: <span class="string">&quot;AUTO&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="zero-terms-æŸ¥è¯¢"><a href="#zero-terms-æŸ¥è¯¢" class="headerlink" title="zero terms æŸ¥è¯¢"></a>zero terms æŸ¥è¯¢</h4><p>å¦‚æœä½¿ç”¨çš„åˆ†æå™¨åƒ stop è¿‡æ»¤å™¨ä¸€æ ·åˆ é™¤æŸ¥è¯¢ä¸­çš„æ‰€æœ‰æ ‡è®°ï¼Œåˆ™é»˜è®¤è¡Œä¸ºæ˜¯ä¸åŒ¹é…ä»»ä½•æ–‡æ¡£ã€‚å¯ä»¥ä½¿ç”¨ <code>zero_terms_query</code> é€‰é¡¹æ¥æ”¹å˜é»˜è®¤è¡Œä¸ºï¼Œå®ƒæ¥å— <code>none</code>ï¼ˆé»˜è®¤ï¼‰å’Œ <code>all</code> ï¼ˆç›¸å½“äº <code>match_all</code> æŸ¥è¯¢ï¼‰ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: <span class="string">&quot;to be or not to be&quot;</span>,</span><br><span class="line">        <span class="string">&quot;operator&quot;</span>: <span class="string">&quot;and&quot;</span>,</span><br><span class="line">        <span class="string">&quot;zero_terms_query&quot;</span>: <span class="string">&quot;all&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="match-bool-prefix-query"><a href="#match-bool-prefix-query" class="headerlink" title="match_bool_prefix query"></a>match_bool_prefix query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-bool-prefix-query.html"><strong><code>match_bool_prefix query</code></strong></a> åˆ†æå…¶è¾“å…¥å¹¶æ ¹æ®è¿™äº›è¯æ„é€ ä¸€ä¸ªå¸ƒå°”æŸ¥è¯¢ã€‚é™¤äº†æœ€åä¸€ä¸ªæœ¯è¯­ä¹‹å¤–çš„æ¯ä¸ªæœ¯è¯­éƒ½ç”¨äºæœ¯è¯­æŸ¥è¯¢ã€‚æœ€åä¸€ä¸ªè¯ç”¨äº <code>prefix query</code>ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_bool_prefix&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span> : <span class="string">&quot;quick brown f&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç­‰ä»·äº</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;bool&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;should&quot;</span>: [</span><br><span class="line">        &#123; <span class="string">&quot;term&quot;</span>: &#123; <span class="string">&quot;message&quot;</span>: <span class="string">&quot;quick&quot;</span> &#125;&#125;,</span><br><span class="line">        &#123; <span class="string">&quot;term&quot;</span>: &#123; <span class="string">&quot;message&quot;</span>: <span class="string">&quot;brown&quot;</span> &#125;&#125;,</span><br><span class="line">        &#123; <span class="string">&quot;prefix&quot;</span>: &#123; <span class="string">&quot;message&quot;</span>: <span class="string">&quot;f&quot;</span>&#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>match_bool_prefix query</code> å’Œ <code>match_phrase_prefix query</code> ä¹‹é—´çš„ä¸€ä¸ªé‡è¦åŒºåˆ«æ˜¯ï¼š<code>match_phrase_prefix query</code> å°†å…¶ term åŒ¹é…ä¸ºçŸ­è¯­ï¼Œä½† <code>match_bool_prefix query</code> å¯ä»¥åœ¨ä»»ä½•ä½ç½®åŒ¹é…å…¶ termã€‚</p>
<p>ä¸Šé¢çš„ç¤ºä¾‹ <code>match_bool_prefix query</code> æŸ¥è¯¢å¯ä»¥åŒ¹é…åŒ…å« <code>quick brown fox</code> çš„å­—æ®µï¼Œä½†å®ƒä¹Ÿå¯ä»¥å¿«é€ŸåŒ¹é… <code>brown fox</code>ã€‚å®ƒè¿˜å¯ä»¥åŒ¹é…åŒ…å« <code>quick</code>ã€<code>brown</code> å’Œä»¥ <code>f</code> å¼€å¤´çš„å­—æ®µï¼Œå‡ºç°åœ¨ä»»ä½•ä½ç½®ã€‚</p>
<h3 id="match-phrase-query"><a href="#match-phrase-query" class="headerlink" title="match_phrase query"></a>match_phrase query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html"><strong><code>match_phrase query</code></strong></a> å³çŸ­è¯­åŒ¹é…ï¼Œé¦–å…ˆä¼šæŠŠ query å†…å®¹åˆ†è¯ï¼Œåˆ†è¯å™¨å¯ä»¥è‡ªå®šä¹‰ï¼ŒåŒæ—¶æ–‡æ¡£è¿˜è¦æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ‰ä¼šè¢«æœç´¢åˆ°ï¼š</p>
<ol>
<li><strong>åˆ†è¯åæ‰€æœ‰è¯é¡¹éƒ½è¦å‡ºç°åœ¨è¯¥å­—æ®µä¸­ï¼ˆç›¸å½“äº and æ“ä½œï¼‰</strong>ã€‚</li>
<li><strong>å­—æ®µä¸­çš„è¯é¡¹é¡ºåºè¦ä¸€è‡´</strong>ã€‚</li>
</ol>
<p>ä¾‹å¦‚ï¼Œæœ‰ä»¥ä¸‹ 3 ä¸ªæ–‡æ¡£ï¼Œä½¿ç”¨ <strong><code>match_phrase</code></strong> æŸ¥è¯¢ â€œHow are youâ€ï¼Œåªæœ‰å‰ä¸¤ä¸ªæ–‡æ¡£ä¼šè¢«åŒ¹é…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PUT demo/_create/1</span><br><span class="line">&#123; <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;How are you&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">PUT demo/_create/2</span><br><span class="line">&#123; <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;How are you, Jack?&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">PUT demo/_create/3</span><br><span class="line">&#123; <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;are you&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">GET demo/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_phrase&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;How are you&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¯´æ˜ï¼š</p>
<p>ä¸€ä¸ªè¢«è®¤å®šä¸ºå’ŒçŸ­è¯­ How are you åŒ¹é…çš„æ–‡æ¡£ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹è¿™äº›è¦æ±‚ï¼š</p>
<ul>
<li>Howã€ are å’Œ you éœ€è¦å…¨éƒ¨å‡ºç°åœ¨åŸŸä¸­ã€‚</li>
<li>are çš„ä½ç½®åº”è¯¥æ¯” How çš„ä½ç½®å¤§ 1 ã€‚</li>
<li>you çš„ä½ç½®åº”è¯¥æ¯” How çš„ä½ç½®å¤§ 2 ã€‚</li>
</ul>
</blockquote>
<h3 id="match-phrase-prefix-query"><a href="#match-phrase-prefix-query" class="headerlink" title="match_phrase_prefix query"></a>match_phrase_prefix query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase-prefix.html"><strong><code>match_phrase_prefix query</code></strong></a> å’Œ <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html"><strong><code>match_phrase query</code></strong></a> ç±»ä¼¼ï¼Œåªä¸è¿‡ <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase-prefix.html"><strong><code>match_phrase_prefix query</code></strong></a> æœ€åä¸€ä¸ª term ä¼šè¢«ä½œä¸ºå‰ç¼€åŒ¹é…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET demo/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_phrase_prefix&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;are yo&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="multi-match-query"><a href="#multi-match-query" class="headerlink" title="multi_match query"></a>multi_match query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-match-query.html"><strong><code>multi_match query</code></strong></a> æ˜¯ <strong><code>match query</code></strong> çš„å‡çº§ï¼Œ<strong>ç”¨äºæœç´¢å¤šä¸ªå­—æ®µ</strong>ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;multi_match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: 34.98,</span><br><span class="line">      <span class="string">&quot;fields&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;taxful_total_price&quot;</span>,</span><br><span class="line">        <span class="string">&quot;taxless_total_price&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>multi_match query</code></strong> çš„æœç´¢å­—æ®µå¯ä»¥ä½¿ç”¨é€šé…ç¬¦æŒ‡å®šï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;multi_match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: 34.98,</span><br><span class="line">      <span class="string">&quot;fields&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;taxful_*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;taxless_total_price&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ï¼Œä¹Ÿå¯ä»¥ç”¨<strong>æŒ‡æ•°ç¬¦æŒ‡å®šæœç´¢å­—æ®µçš„æƒé‡</strong>ã€‚</p>
<p>ç¤ºä¾‹ï¼šæŒ‡å®š taxful_total_price å­—æ®µçš„æƒé‡æ˜¯ taxless_total_price å­—æ®µçš„ 3 å€ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;multi_match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: 34.98,</span><br><span class="line">      <span class="string">&quot;fields&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;taxful_total_price^3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;taxless_total_price&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="combined-fields-query"><a href="#combined-fields-query" class="headerlink" title="combined_fields query"></a>combined_fields query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-combined-fields-query.html"><strong><code>combined_fields query</code></strong></a> æ”¯æŒæœç´¢å¤šä¸ªæ–‡æœ¬å­—æ®µï¼Œå°±å¥½åƒå®ƒä»¬çš„å†…å®¹å·²è¢«ç´¢å¼•åˆ°ä¸€ä¸ªç»„åˆå­—æ®µä¸­ä¸€æ ·ã€‚è¯¥æŸ¥è¯¢ä¼šç”Ÿæˆä»¥ term ä¸ºä¸­å¿ƒçš„è¾“å…¥å­—ç¬¦ä¸²è§†å›¾ï¼šé¦–å…ˆå®ƒå°†æŸ¥è¯¢å­—ç¬¦ä¸²è§£æä¸ºç‹¬ç«‹çš„ termï¼Œç„¶ååœ¨æ‰€æœ‰å­—æ®µä¸­æŸ¥æ‰¾æ¯ä¸ª termã€‚å½“åŒ¹é…ç»“æœå¯èƒ½è·¨è¶Šå¤šä¸ªæ–‡æœ¬å­—æ®µæ—¶ï¼Œæ­¤æŸ¥è¯¢ç‰¹åˆ«æœ‰ç”¨ï¼Œä¾‹å¦‚æ–‡ç« çš„æ ‡é¢˜ã€æ‘˜è¦å’Œæ­£æ–‡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;combined_fields&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;query&quot;</span>:      <span class="string">&quot;database systems&quot;</span>,</span><br><span class="line">      <span class="string">&quot;fields&quot;</span>:     [ <span class="string">&quot;title&quot;</span>, <span class="string">&quot;abstract&quot;</span>, <span class="string">&quot;body&quot;</span>],</span><br><span class="line">      <span class="string">&quot;operator&quot;</span>:   <span class="string">&quot;and&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å­—æ®µå‰ç¼€æƒé‡"><a href="#å­—æ®µå‰ç¼€æƒé‡" class="headerlink" title="å­—æ®µå‰ç¼€æƒé‡"></a>å­—æ®µå‰ç¼€æƒé‡</h4><p>å­—æ®µå‰ç¼€æƒé‡æ ¹æ®ç»„åˆå­—æ®µæ¨¡å‹è¿›è¡Œè®¡ç®—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ title å­—æ®µçš„æƒé‡ä¸º 2ï¼Œåˆ™åŒ¹é…åº¦æ‰“åˆ†æ—¶ä¼šå°† title ä¸­çš„æ¯ä¸ª term å½¢æˆçš„ç»„åˆå­—æ®µï¼ŒæŒ‰å‡ºç°ä¸¤æ¬¡è¿›è¡Œæ‰“åˆ†ã€‚</p>
<h3 id="common-terms-query"><a href="#common-terms-query" class="headerlink" title="common_terms query"></a>common_terms query</h3><blockquote>
<p>7.3.0 åºŸå¼ƒ</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-common-terms-query.html"><strong><code>common_terms query</code></strong></a> æ˜¯ä¸€ç§åœ¨ä¸ç‰ºç‰²æ€§èƒ½çš„æƒ…å†µä¸‹æ›¿ä»£åœç”¨è¯æé«˜æœç´¢å‡†ç¡®ç‡å’Œå¬å›ç‡çš„æ–¹æ¡ˆã€‚</p>
<p>æŸ¥è¯¢ä¸­çš„æ¯ä¸ªè¯é¡¹éƒ½æœ‰ä¸€å®šçš„ä»£ä»·ï¼Œä»¥æœç´¢â€œThe brown foxâ€ä¸ºä¾‹ï¼Œquery ä¼šè¢«è§£ææˆä¸‰ä¸ªè¯é¡¹â€œtheâ€â€œbrownâ€å’Œâ€œfoxâ€ï¼Œæ¯ä¸ªè¯é¡¹éƒ½ä¼šåˆ°ç´¢å¼•ä¸­æ‰§è¡Œä¸€æ¬¡æŸ¥è¯¢ã€‚å¾ˆæ˜¾ç„¶åŒ…å«â€œtheâ€çš„æ–‡æ¡£éå¸¸å¤šï¼Œç›¸æ¯”å…¶ä»–è¯é¡¹ï¼Œâ€œtheâ€çš„é‡è¦æ€§ä¼šä½å¾ˆå¤šã€‚ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆæ˜¯æŠŠâ€œtheâ€å½“ä½œåœç”¨è¯å¤„ç†ï¼Œå»é™¤åœç”¨è¯ä¹‹åå¯ä»¥å‡å°‘ç´¢å¼•å¤§å°ï¼ŒåŒæ—¶åœ¨æœç´¢æ—¶å‡å°‘å¯¹åœç”¨è¯çš„æ”¶ç¼©ã€‚</p>
<p>è™½ç„¶åœç”¨è¯å¯¹æ–‡æ¡£è¯„åˆ†å½±å“ä¸å¤§ï¼Œä½†æ˜¯å½“åœç”¨è¯ä»ç„¶æœ‰é‡è¦æ„ä¹‰çš„æ—¶å€™ï¼Œå»é™¤åœç”¨è¯å°±ä¸æ˜¯å®Œç¾çš„è§£å†³æ–¹æ¡ˆäº†ã€‚å¦‚æœå»é™¤åœç”¨è¯ï¼Œå°±æ— æ³•åŒºåˆ†â€œhappyâ€å’Œâ€œnot happyâ€, â€œTheâ€â€œTo be or not to beâ€å°±ä¸ä¼šåœ¨ç´¢å¼•ä¸­å­˜åœ¨ï¼Œæœç´¢çš„å‡†ç¡®ç‡å’Œå¬å›ç‡å°±ä¼šé™ä½ã€‚</p>
<p>common_terms query æä¾›äº†ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå®ƒæŠŠ query åˆ†è¯åçš„è¯é¡¹åˆ†æˆé‡è¦è¯é¡¹ï¼ˆä½é¢‘è¯é¡¹ï¼‰å’Œä¸é‡è¦çš„è¯é¡¹ï¼ˆé«˜é¢‘è¯ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰çš„åœç”¨è¯ï¼‰ã€‚åœ¨æœç´¢çš„æ—¶å€™ï¼Œé¦–å…ˆæœç´¢å’Œé‡è¦è¯é¡¹åŒ¹é…çš„æ–‡æ¡£ï¼Œè¿™äº›æ–‡æ¡£æ˜¯è¯é¡¹å‡ºç°è¾ƒå°‘å¹¶ä¸”è¯é¡¹å¯¹å…¶è¯„åˆ†å½±å“è¾ƒå¤§çš„æ–‡æ¡£ã€‚ç„¶åæ‰§è¡Œç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œæœç´¢å¯¹è¯„åˆ†å½±å“è¾ƒå°çš„é«˜é¢‘è¯é¡¹ï¼Œä½†æ˜¯ä¸è®¡ç®—æ‰€æœ‰æ–‡æ¡£çš„è¯„åˆ†ï¼Œè€Œæ˜¯åªè®¡ç®—ç¬¬ä¸€æ¬¡æŸ¥è¯¢å·²ç»åŒ¹é…çš„æ–‡æ¡£å¾—åˆ†ã€‚å¦‚æœä¸€ä¸ªæŸ¥è¯¢ä¸­åªåŒ…å«é«˜é¢‘è¯ï¼Œé‚£ä¹ˆä¼šé€šè¿‡ and è¿æ¥ç¬¦æ‰§è¡Œä¸€ä¸ªå•ç‹¬çš„æŸ¥è¯¢ï¼Œæ¢è¨€ä¹‹ï¼Œä¼šæœç´¢æ‰€æœ‰çš„è¯é¡¹ã€‚</p>
<p>è¯é¡¹æ˜¯é«˜é¢‘è¯è¿˜æ˜¯ä½é¢‘è¯æ˜¯é€šè¿‡ cutoff frequency æ¥è®¾ç½®é˜€å€¼çš„ï¼Œå–å€¼å¯ä»¥æ˜¯ç»å¯¹é¢‘ç‡ï¼ˆé¢‘ç‡å¤§äº 1ï¼‰æˆ–è€…ç›¸å¯¹é¢‘ç‡ï¼ˆ0 ï½ 1ï¼‰ã€‚common_terms query æœ€æœ‰è¶£ä¹‹å¤„åœ¨äºå®ƒèƒ½è‡ªé€‚åº”ç‰¹å®šé¢†åŸŸçš„åœç”¨è¯ï¼Œä¾‹å¦‚ï¼Œåœ¨è§†é¢‘æ‰˜ç®¡ç½‘ç«™ä¸Šï¼Œè¯¸å¦‚â€œclipâ€æˆ–â€œvideoâ€ä¹‹ç±»çš„é«˜é¢‘è¯é¡¹å°†è‡ªåŠ¨è¡¨ç°ä¸ºåœç”¨è¯ï¼Œæ— é¡»ä¿ç•™æ‰‹åŠ¨åˆ—è¡¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ–‡æ¡£é¢‘ç‡é«˜äº 0.1% çš„è¯é¡¹å°†ä¼šè¢«å½“ä½œé«˜é¢‘è¯é¡¹ï¼Œè¯é¢‘ä¹‹é—´å¯ä»¥ç”¨ low_freq_operatorã€high_freq_operator å‚æ•°è¿æ¥ã€‚è®¾ç½®ä½é¢‘è¯æ“ä½œç¬¦ä¸ºâ€œandâ€ä½¿æ‰€æœ‰çš„ä½é¢‘è¯éƒ½æ˜¯å¿…é¡»æœç´¢çš„ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET books/_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;common&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;body&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;query&quot;</span>: <span class="string">&quot;nelly the elephant as a cartoon&quot;</span>,</span><br><span class="line">				<span class="string">&quot;cutoff_frequency&quot;</span>: 0.001,</span><br><span class="line">				<span class="string">&quot;low_freq_operator&quot;</span>: <span class="string">&quot;and&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°æ“ä½œç­‰ä»·äºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">GET books/_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;must&quot;</span>: [</span><br><span class="line">			  &#123; <span class="string">&quot;term&quot;</span>: &#123; <span class="string">&quot;body&quot;</span>: <span class="string">&quot;nelly&quot;</span> &#125; &#125;,</span><br><span class="line">			  &#123; <span class="string">&quot;term&quot;</span>: &#123; <span class="string">&quot;body&quot;</span>: <span class="string">&quot;elephant&quot;</span> &#125; &#125;,</span><br><span class="line">			  &#123; <span class="string">&quot;term&quot;</span>: &#123; <span class="string">&quot;body&quot;</span>: <span class="string">&quot;cartoon&quot;</span> &#125; &#125;</span><br><span class="line">			],</span><br><span class="line">			<span class="string">&quot;should&quot;</span>: [</span><br><span class="line">			  &#123; <span class="string">&quot;term&quot;</span>: &#123; <span class="string">&quot;body&quot;</span>: <span class="string">&quot;the&quot;</span> &#125; &#125;,</span><br><span class="line">			  &#123; <span class="string">&quot;term&quot;</span>: &#123; <span class="string">&quot;body&quot;</span>: <span class="string">&quot;as&quot;</span> &#125; &#125;,</span><br><span class="line">			  &#123; <span class="string">&quot;term&quot;</span>: &#123; <span class="string">&quot;body&quot;</span>: <span class="string">&quot;a&quot;</span> &#125; &#125;</span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="query-string-query"><a href="#query-string-query" class="headerlink" title="query_string query"></a>query_string query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html"><strong><code>query_string query</code></strong></a> æ˜¯ä¸ Lucene æŸ¥è¯¢è¯­å¥çš„è¯­æ³•ç»“åˆéå¸¸ç´§å¯†çš„ä¸€ç§æŸ¥è¯¢ï¼Œå…è®¸åœ¨ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨å¤šä¸ªç‰¹æ®Šæ¡ä»¶å…³é”®å­—ï¼ˆå¦‚ï¼šAND | OR | NOTï¼‰å¯¹å¤šä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œå»ºè®®ç†Ÿæ‚‰ Lucene æŸ¥è¯¢è¯­æ³•çš„ç”¨æˆ·å»ä½¿ç”¨ã€‚</p>
<p>ç”¨æˆ·å¯ä»¥ä½¿ç”¨ query_string query æ¥åˆ›å»ºåŒ…å«é€šé…ç¬¦ã€è·¨å¤šä¸ªå­—æ®µçš„æœç´¢ç­‰å¤æ‚æœç´¢ã€‚è™½ç„¶é€šç”¨ï¼Œä½†æŸ¥è¯¢æ˜¯ä¸¥æ ¼çš„ï¼Œå¦‚æœæŸ¥è¯¢å­—ç¬¦ä¸²åŒ…å«ä»»ä½•æ— æ•ˆè¯­æ³•ï¼Œåˆ™ä¼šè¿”å›é”™è¯¯ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;query_string&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: <span class="string">&quot;(new york city) OR (big apple)&quot;</span>,</span><br><span class="line">      <span class="string">&quot;default_field&quot;</span>: <span class="string">&quot;content&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="simple-query-string-query"><a href="#simple-query-string-query" class="headerlink" title="simple_query_string query"></a>simple_query_string query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-simple-query-string-query.html"><strong><code>simple_query_string query</code></strong></a> æ˜¯ä¸€ç§é€‚åˆç›´æ¥æš´éœ²ç»™ç”¨æˆ·ï¼Œå¹¶ä¸”å…·æœ‰éå¸¸å®Œå–„çš„æŸ¥è¯¢è¯­æ³•çš„æŸ¥è¯¢è¯­å¥ï¼Œæ¥å— Lucene æŸ¥è¯¢è¯­æ³•ï¼Œè§£æè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>è™½ç„¶è¯­æ³•æ¯” <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html"><strong><code>query_string query</code></strong></a> æ›´ä¸¥æ ¼ï¼Œä½† <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-simple-query-string-query.html"><strong><code>simple_query_string query</code></strong></a> ä¸ä¼šè¿”å›æ— æ•ˆè¯­æ³•çš„é”™è¯¯ã€‚ç›¸åï¼Œå®ƒä¼šå¿½ç•¥æŸ¥è¯¢å­—ç¬¦ä¸²çš„ä»»ä½•æ— æ•ˆéƒ¨åˆ†ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;simple_query_string&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: <span class="string">&quot;\&quot;fried eggs\&quot; +(eggplant | potato) -frittata&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fields&quot;</span>: [<span class="string">&quot;title^5&quot;</span>, <span class="string">&quot;body&quot;</span>],</span><br><span class="line">        <span class="string">&quot;default_operator&quot;</span>: <span class="string">&quot;and&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="simple-query-string-è¯­ä¹‰"><a href="#simple-query-string-è¯­ä¹‰" class="headerlink" title="simple_query_string è¯­ä¹‰"></a>simple_query_string è¯­ä¹‰</h4><ul>
<li><code>+</code>ï¼šç­‰ä»·äº AND æ“ä½œ</li>
<li><code>|</code>ï¼šç­‰ä»·äº OR æ“ä½œ</li>
<li><code>-</code>ï¼šç›¸å½“äº NOT æ“ä½œ</li>
<li><code>&quot;</code>ï¼šåŒ…è£…ä¸€äº›æ ‡è®°ä»¥è¡¨ç¤ºç”¨äºæœç´¢çš„çŸ­è¯­</li>
<li><code>*</code>ï¼šè¯å°¾è¡¨ç¤ºå‰ç¼€æŸ¥è¯¢</li>
<li><code>(</code> and <code>)</code>ï¼šè¡¨ç¤ºä¼˜å…ˆçº§</li>
<li><code>~N</code>ï¼šè¯å°¾è¡¨ç¤ºè¡¨ç¤ºç¼–è¾‘è·ç¦»ï¼ˆæ¨¡ç³Šæ€§ï¼‰</li>
<li><code>~N</code>ï¼šåœ¨ä¸€ä¸ªçŸ­è¯­ä¹‹åè¡¨ç¤ºæº¢å‡ºé‡</li>
</ul>
<p>æ³¨æ„ï¼šè¦ä½¿ç”¨ä¸Šé¢çš„å­—ç¬¦ï¼Œè¯·ä½¿ç”¨åæ–œæ  <code>/</code> å¯¹å…¶è¿›è¡Œè½¬ä¹‰ã€‚</p>
<h3 id="å…¨æ–‡æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹"><a href="#å…¨æ–‡æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹" class="headerlink" title="å…¨æ–‡æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹"></a>å…¨æ–‡æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è®¾ç½® position_increment_gap</span></span><br><span class="line">DELETE <span class="built_in">groups</span></span><br><span class="line">PUT <span class="built_in">groups</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;names&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;position_increment_gap&quot;</span>: 0</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET <span class="built_in">groups</span>/_mapping</span><br><span class="line"></span><br><span class="line">POST <span class="built_in">groups</span>/_doc</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;names&quot;</span>: [ <span class="string">&quot;John Water&quot;</span>, <span class="string">&quot;Water Smith&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST <span class="built_in">groups</span>/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_phrase&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;names&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: <span class="string">&quot;Water Water&quot;</span>,</span><br><span class="line">        <span class="string">&quot;slop&quot;</span>: 100</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST <span class="built_in">groups</span>/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_phrase&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;names&quot;</span>: <span class="string">&quot;Water Smith&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DELETE <span class="built_in">groups</span></span><br></pre></td></tr></table></figure>

<h2 id="è¯é¡¹æŸ¥è¯¢"><a href="#è¯é¡¹æŸ¥è¯¢" class="headerlink" title="è¯é¡¹æŸ¥è¯¢"></a>è¯é¡¹æŸ¥è¯¢</h2><p><strong><code>Term</code>ï¼ˆè¯é¡¹ï¼‰æ˜¯è¡¨è¾¾è¯­æ„çš„æœ€å°å•ä½</strong>ã€‚æœç´¢å’Œåˆ©ç”¨ç»Ÿè®¡è¯­è¨€æ¨¡å‹è¿›è¡Œè‡ªç„¶è¯­è¨€å¤„ç†éƒ½éœ€è¦å¤„ç† Termã€‚</p>
<p>å…¨æ–‡æŸ¥è¯¢åœ¨æ‰§è¡ŒæŸ¥è¯¢ä¹‹å‰ä¼šåˆ†ææŸ¥è¯¢å­—ç¬¦ä¸²ã€‚</p>
<p>ä¸å…¨æ–‡æŸ¥è¯¢ä¸åŒï¼Œè¯é¡¹æŸ¥è¯¢ä¸ä¼šåˆ†è¯ï¼Œè€Œæ˜¯å°†è¾“å…¥ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œåœ¨å€’æ’ç´¢å¼•ä¸­æŸ¥æ‰¾å‡†ç¡®çš„è¯é¡¹ã€‚å¹¶ä¸”ä½¿ç”¨ç›¸å…³åº¦è®¡ç®—å…¬å¼ä¸ºæ¯ä¸ªåŒ…å«è¯¥è¯é¡¹çš„æ–‡æ¡£è¿›è¡Œç›¸å…³åº¦è®¡ç®—ã€‚ä¸€è¨€ä»¥æ¦‚ä¹‹ï¼š<strong>è¯é¡¹æŸ¥è¯¢æ˜¯å¯¹è¯é¡¹è¿›è¡Œç²¾ç¡®åŒ¹é…</strong>ã€‚è¯é¡¹æŸ¥è¯¢é€šå¸¸ç”¨äºç»“æ„åŒ–æ•°æ®ï¼Œå¦‚æ•°å­—ã€æ—¥æœŸå’Œæšä¸¾ç±»å‹ã€‚</p>
<p>è¯é¡¹æŸ¥è¯¢æœ‰ä»¥ä¸‹ç±»å‹ï¼š</p>
<ul>
<li><strong><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html"><code>exists</code> query</a></strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-fuzzy-query.html"><code>fuzzy</code> query</a></strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-ids-query.html"><code>ids</code> query</a></strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-prefix-query.html"><code>prefix</code> query</a></strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html"><code>range</code> query</a></strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html"><code>regexp</code> query</a></strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html"><code>term</code> query</a></strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-query.html"><code>terms</code> query</a></strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-type-query.html"><code>type</code> query</a></strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html"><code>wildcard</code> query</a></strong></li>
</ul>
<h3 id="exists-query"><a href="#exists-query" class="headerlink" title="exists query"></a>exists query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html"><strong><code>exists query</code></strong></a> ä¼šè¿”å›å­—æ®µä¸­è‡³å°‘æœ‰ä¸€ä¸ªéç©ºå€¼çš„æ–‡æ¡£ã€‚</p>
<p>ç”±äºå¤šç§åŸå› ï¼Œæ–‡æ¡£å­—æ®µå¯èƒ½ä¸å­˜åœ¨ç´¢å¼•å€¼ï¼š</p>
<ul>
<li>JSON ä¸­çš„å­—æ®µä¸º <code>null</code> æˆ– <code>[]</code></li>
<li>è¯¥å­—æ®µåœ¨ mapping ä¸­é…ç½®äº† <code>&quot;index&quot; : false</code></li>
<li>å­—æ®µå€¼çš„é•¿åº¦è¶…è¿‡äº† mapping ä¸­çš„ <code>ignore_above</code> è®¾ç½®</li>
<li>å­—æ®µå€¼æ ¼å¼é”™è¯¯ï¼Œå¹¶ä¸”åœ¨ mapping ä¸­å®šä¹‰äº† <code>ignore_malformed</code></li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;exists&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;field&quot;</span>: <span class="string">&quot;email&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹æ–‡æ¡£ä¼šåŒ¹é…ä¸Šé¢çš„æŸ¥è¯¢ï¼š</p>
<ul>
<li><code>&#123; &quot;user&quot; : &quot;jane&quot; &#125;</code> æœ‰ user å­—æ®µï¼Œä¸”ä¸ä¸ºç©ºã€‚</li>
<li><code>&#123; &quot;user&quot; : &quot;&quot; &#125;</code> æœ‰ user å­—æ®µï¼Œå€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</li>
<li><code>&#123; &quot;user&quot; : &quot;-&quot; &#125;</code> æœ‰ user å­—æ®µï¼Œå€¼ä¸ä¸ºç©ºã€‚</li>
<li><code>&#123; &quot;user&quot; : [ &quot;jane&quot; ] &#125;</code> æœ‰ user å­—æ®µï¼Œå€¼ä¸ä¸ºç©ºã€‚</li>
<li><code>&#123; &quot;user&quot; : [ &quot;jane&quot;, null ] &#125;</code> æœ‰ user å­—æ®µï¼Œè‡³å°‘ä¸€ä¸ªå€¼ä¸ä¸ºç©ºå³å¯ã€‚</li>
</ul>
<p>ä¸‹é¢çš„æ–‡æ¡£éƒ½ä¸ä¼šè¢«åŒ¹é…ï¼š</p>
<ul>
<li><code>&#123; &quot;user&quot; : null &#125;</code> è™½ç„¶æœ‰ user å­—æ®µï¼Œä½†æ˜¯å€¼ä¸ºç©ºã€‚</li>
<li><code>&#123; &quot;user&quot; : [] &#125;</code> è™½ç„¶æœ‰ user å­—æ®µï¼Œä½†æ˜¯å€¼ä¸ºç©ºã€‚</li>
<li><code>&#123; &quot;user&quot; : [null] &#125;</code> è™½ç„¶æœ‰ user å­—æ®µï¼Œä½†æ˜¯å€¼ä¸ºç©ºã€‚</li>
<li><code>&#123; &quot;foo&quot; : &quot;bar&quot; &#125;</code> æ²¡æœ‰ user å­—æ®µã€‚</li>
</ul>
<h3 id="fuzzy-query"><a href="#fuzzy-query" class="headerlink" title="fuzzy query"></a>fuzzy query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-fuzzy-query.html">**<code>fuzzy query</code>**ï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼‰</a>è¿”å›åŒ…å«ä¸æœç´¢è¯ç›¸ä¼¼çš„è¯çš„æ–‡æ¡£ã€‚ES ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Levenshtein_distance">Levenshtein edit distanceï¼ˆLevenshtein ç¼–è¾‘è·ç¦»ï¼‰</a>æµ‹é‡ç›¸ä¼¼åº¦æˆ–æ¨¡ç³Šåº¦ã€‚</p>
<p>ç¼–è¾‘è·ç¦»æ˜¯å°†ä¸€ä¸ªæœ¯è¯­è½¬æ¢ä¸ºå¦ä¸€ä¸ªæœ¯è¯­æ‰€éœ€çš„å•ä¸ªå­—ç¬¦æ›´æ”¹çš„æ•°é‡ã€‚è¿™äº›å˜åŒ–å¯èƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ”¹å˜ä¸€ä¸ªå­—ç¬¦ï¼šï¼ˆ<strong>b</strong>ox -&gt; <strong>f</strong>oxï¼‰</li>
<li>åˆ é™¤ä¸€ä¸ªå­—ç¬¦ï¼šï¼ˆ<strong>b</strong>lack -&gt; lackï¼‰</li>
<li>æ’å…¥ä¸€ä¸ªå­—ç¬¦ï¼šï¼ˆsic -&gt; sic<strong>k</strong>ï¼‰</li>
<li>åè½¬ä¸¤ä¸ªç›¸é‚»å­—ç¬¦ï¼šï¼ˆ<strong>ac</strong>t â†’ <strong>ca</strong>tï¼‰</li>
</ul>
<p>ä¸ºäº†æ‰¾åˆ°ç›¸ä¼¼çš„è¯æ¡ï¼Œfuzzy query ä¼šåœ¨æŒ‡å®šçš„ç¼–è¾‘è·ç¦»å†…åˆ›å»ºæœç´¢è¯æ¡çš„æ‰€æœ‰å¯èƒ½å˜ä½“æˆ–æ‰©å±•é›†ã€‚ç„¶åè¿”å›å®Œå…¨åŒ¹é…ä»»æ„æ‰©å±•çš„æ–‡æ¡£ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET books/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;fuzzy&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;user.id&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;ki&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fuzziness&quot;</span>: <span class="string">&quot;AUTO&quot;</span>,</span><br><span class="line">        <span class="string">&quot;max_expansions&quot;</span>: 50,</span><br><span class="line">        <span class="string">&quot;prefix_length&quot;</span>: 0,</span><br><span class="line">        <span class="string">&quot;transpositions&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;rewrite&quot;</span>: <span class="string">&quot;constant_score&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šå¦‚æœé…ç½®äº† <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html#query-dsl-allow-expensive-queries"><code>search.allow_expensive_queries</code></a> ï¼Œåˆ™ fuzzy query ä¸èƒ½æ‰§è¡Œã€‚</p>
<h3 id="ids-query"><a href="#ids-query" class="headerlink" title="ids query"></a>ids query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-ids-query.html"><strong><code>ids query</code></strong></a> æ ¹æ® ID è¿”å›æ–‡æ¡£ã€‚ æ­¤æŸ¥è¯¢ä½¿ç”¨å­˜å‚¨åœ¨ <code>_id</code> å­—æ®µä¸­çš„æ–‡æ¡£ IDã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;ids&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;values&quot;</span> : [<span class="string">&quot;1&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;100&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="prefix-query"><a href="#prefix-query" class="headerlink" title="prefix query"></a>prefix query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-prefix-query.html#prefix-query-ex-request"><strong><code>prefix query</code></strong></a> ç”¨äºæŸ¥è¯¢æŸä¸ªå­—æ®µä¸­åŒ…å«æŒ‡å®šå‰ç¼€çš„æ–‡æ¡£ã€‚</p>
<p>æ¯”å¦‚æŸ¥è¯¢ <code>user.id</code> ä¸­å«æœ‰ä»¥ <code>ki</code> ä¸ºå‰ç¼€çš„å…³é”®è¯çš„æ–‡æ¡£ï¼Œé‚£ä¹ˆå«æœ‰ <code>kind</code>ã€<code>kid</code> ç­‰æ‰€æœ‰ä»¥ <code>ki</code> å¼€å¤´å…³é”®è¯çš„æ–‡æ¡£éƒ½ä¼šè¢«åŒ¹é…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;prefix&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;user.id&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;ki&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="range-query"><a href="#range-query" class="headerlink" title="range query"></a>range query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html"><strong><code>range query</code></strong></a> å³èŒƒå›´æŸ¥è¯¢ï¼Œç”¨äºåŒ¹é…åœ¨æŸä¸€èŒƒå›´å†…çš„æ•°å€¼å‹ã€æ—¥æœŸç±»å‹æˆ–è€…å­—ç¬¦ä¸²å‹å­—æ®µçš„æ–‡æ¡£ã€‚æ¯”å¦‚æœç´¢å“ªäº›ä¹¦ç±çš„ä»·æ ¼åœ¨ 50 åˆ° 100 ä¹‹é—´ã€å“ªäº›ä¹¦ç±çš„å‡ºç‰ˆæ—¶é—´åœ¨ 2015 å¹´åˆ° 2019 å¹´ä¹‹é—´ã€‚<strong>ä½¿ç”¨ range æŸ¥è¯¢åªèƒ½æŸ¥è¯¢ä¸€ä¸ªå­—æ®µï¼Œä¸èƒ½ä½œç”¨åœ¨å¤šä¸ªå­—æ®µä¸Š</strong>ã€‚</p>
<p>range æŸ¥è¯¢æ”¯æŒçš„å‚æ•°æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li><p>**<code>gt</code>**ï¼šå¤§äº</p>
</li>
<li><p>**<code>gte</code>**ï¼šå¤§äºç­‰äº</p>
</li>
<li><p>**<code>lt</code>**ï¼šå°äº</p>
</li>
<li><p>**<code>lte</code>**ï¼šå°äºç­‰äº</p>
</li>
<li><p>**<code>format</code>**ï¼šå¦‚æœå­—æ®µæ˜¯ Date ç±»å‹ï¼Œå¯ä»¥è®¾ç½®æ—¥æœŸæ ¼å¼åŒ–</p>
</li>
<li><p>**<code>time_zone</code>**ï¼šæ—¶åŒº</p>
</li>
<li><p>**<code>relation</code>**ï¼šæŒ‡ç¤ºèŒƒå›´æŸ¥è¯¢å¦‚ä½•åŒ¹é…èŒƒå›´å­—æ®µçš„å€¼ã€‚</p>
<ul>
<li>**<code>INTERSECTS</code> (Default)**ï¼šåŒ¹é…ä¸æŸ¥è¯¢å­—æ®µå€¼èŒƒå›´ç›¸äº¤çš„æ–‡æ¡£ã€‚</li>
<li>**<code>CONTAINS</code>**ï¼šåŒ¹é…å®Œå…¨åŒ…å«æŸ¥è¯¢å­—æ®µå€¼çš„æ–‡æ¡£ã€‚</li>
<li>**<code>WITHIN</code>**ï¼šåŒ¹é…å…·æœ‰å®Œå…¨åœ¨æŸ¥è¯¢èŒƒå›´å†…çš„èŒƒå›´å­—æ®µå€¼çš„æ–‡æ¡£ã€‚</li>
</ul>
</li>
</ul>
<p>ç¤ºä¾‹ï¼šæ•°å€¼èŒƒå›´æŸ¥è¯¢</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;range&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;taxful_total_price&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;gt&quot;</span>: 10,</span><br><span class="line">        <span class="string">&quot;lte&quot;</span>: 50</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼šæ—¥æœŸèŒƒå›´æŸ¥è¯¢</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;range&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;order_date&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;time_zone&quot;</span>: <span class="string">&quot;+00:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;gte&quot;</span>: <span class="string">&quot;2018-01-01T00:00:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;lte&quot;</span>: <span class="string">&quot;now&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="regexp-query"><a href="#regexp-query" class="headerlink" title="regexp query"></a>regexp query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html"><strong><code>regexp query</code></strong></a> è¿”å›ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…çš„ term æ‰€å±çš„æ–‡æ¡£ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F">æ­£åˆ™è¡¨è¾¾å¼</a>æ˜¯ä¸€ç§ä½¿ç”¨å ä½ç¬¦å­—ç¬¦åŒ¹é…æ•°æ®æ¨¡å¼çš„æ–¹æ³•ï¼Œç§°ä¸ºè¿ç®—ç¬¦ã€‚</p>
<p>ç¤ºä¾‹ï¼šä»¥ä¸‹æœç´¢è¿”å› <code>user.id</code> å­—æ®µåŒ…å«ä»»ä½•ä»¥ <code>k</code> å¼€å¤´å¹¶ä»¥ <code>y</code> ç»“å°¾çš„æ–‡æ¡£ã€‚ <code>.*</code> è¿ç®—ç¬¦åŒ¹é…ä»»ä½•é•¿åº¦çš„ä»»ä½•å­—ç¬¦ï¼ŒåŒ…æ‹¬æ— å­—ç¬¦ã€‚åŒ¹é…é¡¹å¯ä»¥åŒ…æ‹¬ <code>ky</code>ã€<code>kay</code> å’Œ <code>kimchy</code>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;regexp&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;user.id&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;k.*y&quot;</span>,</span><br><span class="line">        <span class="string">&quot;flags&quot;</span>: <span class="string">&quot;ALL&quot;</span>,</span><br><span class="line">        <span class="string">&quot;case_insensitive&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;max_determinized_states&quot;</span>: 10000,</span><br><span class="line">        <span class="string">&quot;rewrite&quot;</span>: <span class="string">&quot;constant_score&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœé…ç½®äº†<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html#query-dsl-allow-expensive-queries"><code>search.allow_expensive_queries</code></a> ï¼Œåˆ™ <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html"><strong><code>regexp query</code></strong></a> ä¼šè¢«ç¦ç”¨ã€‚</p>
</blockquote>
<h3 id="term-query"><a href="#term-query" class="headerlink" title="term query"></a>term query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html"><strong><code>term query</code></strong></a> ç”¨æ¥æŸ¥æ‰¾æŒ‡å®šå­—æ®µä¸­åŒ…å«ç»™å®šå•è¯çš„æ–‡æ¡£ï¼Œterm æŸ¥è¯¢ä¸è¢«è§£æï¼Œåªæœ‰æŸ¥è¯¢è¯å’Œæ–‡æ¡£ä¸­çš„è¯ç²¾ç¡®åŒ¹é…æ‰ä¼šè¢«æœç´¢åˆ°ï¼Œåº”ç”¨åœºæ™¯ä¸ºæŸ¥è¯¢äººåã€åœ°åç­‰éœ€è¦ç²¾å‡†åŒ¹é…çš„éœ€æ±‚ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. åˆ›å»ºä¸€ä¸ªç´¢å¼•</span></span><br><span class="line">DELETE my-index-000001</span><br><span class="line">PUT my-index-000001</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;full_text&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ä½¿ç”¨ &quot;Quick Brown Foxes!&quot; å…³é”®å­—æŸ¥ &quot;full_text&quot; å­—æ®µ</span></span><br><span class="line">PUT my-index-000001/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;full_text&quot;</span>: <span class="string">&quot;Quick Brown Foxes!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. ä½¿ç”¨ term æŸ¥è¯¢</span></span><br><span class="line">GET my-index-000001/_search?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;full_text&quot;</span>: <span class="string">&quot;Quick Brown Foxes!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># å› ä¸º full_text å­—æ®µä¸å†åŒ…å«ç¡®åˆ‡çš„ Term â€”â€” &quot;Quick Brown Foxes!&quot;ï¼Œæ‰€ä»¥ term query æœç´¢ä¸åˆ°ä»»ä½•ç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. ä½¿ç”¨ match æŸ¥è¯¢</span></span><br><span class="line">GET my-index-000001/_search?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;full_text&quot;</span>: <span class="string">&quot;Quick Brown Foxes!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DELETE my-index-000001</span><br></pre></td></tr></table></figure>

<blockquote>
<p>:warning: æ³¨æ„ï¼šåº”é¿å… term æŸ¥è¯¢å¯¹ text å­—æ®µä½¿ç”¨æŸ¥è¯¢ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearch é’ˆå¯¹ text å­—æ®µçš„å€¼è¿›è¡Œè§£æåˆ†è¯ï¼Œè¿™ä¼šä½¿æŸ¥æ‰¾ text å­—æ®µå€¼çš„ç²¾ç¡®åŒ¹é…å˜å¾—å›°éš¾ã€‚</p>
<p>è¦æœç´¢ text å­—æ®µå€¼ï¼Œéœ€æ”¹ç”¨ match æŸ¥è¯¢ã€‚</p>
</blockquote>
<h3 id="terms-query"><a href="#terms-query" class="headerlink" title="terms query"></a>terms query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-query.html"><strong><code>terms query</code></strong></a> ä¸ <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html"><strong><code>term query</code></strong></a> ç›¸åŒï¼Œä½†å¯ä»¥æœç´¢å¤šä¸ªå€¼ã€‚</p>
<p>terms query æŸ¥è¯¢å‚æ•°ï¼š</p>
<ul>
<li>**<code>index</code>**ï¼šç´¢å¼•å</li>
<li>**<code>id</code>**ï¼šæ–‡æ¡£ ID</li>
<li>**<code>path</code>**ï¼šè¦ä»ä¸­è·å–å­—æ®µå€¼çš„å­—æ®µçš„åç§°ï¼Œå³æœç´¢å…³é”®å­—</li>
<li>**<code>routing</code>**ï¼ˆé€‰å¡«ï¼‰ï¼šè¦ä»ä¸­è·å– term å€¼çš„æ–‡æ¡£çš„è‡ªå®šä¹‰è·¯ç”±å€¼ã€‚å¦‚æœåœ¨ç´¢å¼•æ–‡æ¡£æ—¶æä¾›äº†è‡ªå®šä¹‰è·¯ç”±å€¼ï¼Œåˆ™æ­¤å‚æ•°æ˜¯å¿…éœ€çš„ã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. åˆ›å»ºä¸€ä¸ªç´¢å¼•</span></span><br><span class="line">DELETE my-index-000001</span><br><span class="line">PUT my-index-000001</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;color&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å†™å…¥ä¸€ä¸ªæ–‡æ¡£</span></span><br><span class="line">PUT my-index-000001/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;color&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;blue&quot;</span>,</span><br><span class="line">    <span class="string">&quot;green&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å†™å…¥å¦ä¸€ä¸ªæ–‡æ¡£</span></span><br><span class="line">PUT my-index-000001/_doc/2</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;color&quot;</span>: <span class="string">&quot;blue&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. ä½¿ç”¨ terms query</span></span><br><span class="line">GET my-index-000001/_search?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;color&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;index&quot;</span>: <span class="string">&quot;my-index-000001&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;path&quot;</span>: <span class="string">&quot;color&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DELETE my-index-000001</span><br></pre></td></tr></table></figure>

<h3 id="type-query"><a href="#type-query" class="headerlink" title="type query"></a>type query</h3><blockquote>
<p>7.0.0 ååºŸå¼ƒ</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-type-query.html"><strong><code>type query</code></strong></a> ç”¨äºæŸ¥è¯¢å…·æœ‰æŒ‡å®šç±»å‹çš„æ–‡æ¡£ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;_doc&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="wildcard-query"><a href="#wildcard-query" class="headerlink" title="wildcard query"></a>wildcard query</h3><p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html"><strong><code>wildcard query</code></strong></a> å³é€šé…ç¬¦æŸ¥è¯¢ï¼Œè¿”å›ä¸é€šé…ç¬¦æ¨¡å¼åŒ¹é…çš„æ–‡æ¡£ã€‚</p>
<p><code>?</code> ç”¨æ¥åŒ¹é…ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼Œ<code>*</code> ç”¨æ¥åŒ¹é…é›¶ä¸ªæˆ–è€…å¤šä¸ªå­—ç¬¦ã€‚</p>
<p>ç¤ºä¾‹ï¼šä»¥ä¸‹æœç´¢è¿”å› <code>user.id</code> å­—æ®µåŒ…å«ä»¥ <code>ki</code> å¼€å¤´å¹¶ä»¥ <code>y</code> ç»“å°¾çš„æœ¯è¯­çš„æ–‡æ¡£ã€‚è¿™äº›åŒ¹é…é¡¹å¯ä»¥åŒ…æ‹¬ <code>kiy</code>ã€<code>kity</code> æˆ– <code>kimchy</code>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;wildcard&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;user.id&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;ki*y&quot;</span>,</span><br><span class="line">        <span class="string">&quot;boost&quot;</span>: 1.0,</span><br><span class="line">        <span class="string">&quot;rewrite&quot;</span>: <span class="string">&quot;constant_score&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœé…ç½®äº†<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html#query-dsl-allow-expensive-queries"><code>search.allow_expensive_queries</code></a> ï¼Œåˆ™<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html"><strong><code>wildcard query</code></strong></a> ä¼šè¢«ç¦ç”¨ã€‚</p>
</blockquote>
<h3 id="è¯é¡¹æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹"><a href="#è¯é¡¹æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹" class="headerlink" title="è¯é¡¹æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹"></a>è¯é¡¹æŸ¥è¯¢å®Œæ•´ç¤ºä¾‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">DELETE products</span><br><span class="line">PUT products</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;number_of_shards&quot;</span>: 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /products/_bulk</span><br><span class="line">&#123; <span class="string">&quot;index&quot;</span>: &#123; <span class="string">&quot;_id&quot;</span>: 1 &#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;productID&quot;</span> : <span class="string">&quot;XHDK-A-1293-#fJ3&quot;</span>,<span class="string">&quot;desc&quot;</span>:<span class="string">&quot;iPhone&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;index&quot;</span>: &#123; <span class="string">&quot;_id&quot;</span>: 2 &#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;productID&quot;</span> : <span class="string">&quot;KDKE-B-9947-#kL5&quot;</span>,<span class="string">&quot;desc&quot;</span>:<span class="string">&quot;iPad&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;index&quot;</span>: &#123; <span class="string">&quot;_id&quot;</span>: 3 &#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;productID&quot;</span> : <span class="string">&quot;JODL-X-1937-#pV7&quot;</span>,<span class="string">&quot;desc&quot;</span>:<span class="string">&quot;MBP&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">GET /products</span><br><span class="line"></span><br><span class="line">POST /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;desc&quot;</span>: &#123;</span><br><span class="line">        //<span class="string">&quot;value&quot;</span>: <span class="string">&quot;iPhone&quot;</span></span><br><span class="line">        <span class="string">&quot;value&quot;</span>:<span class="string">&quot;iphone&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;desc.keyword&quot;</span>: &#123;</span><br><span class="line">        //<span class="string">&quot;value&quot;</span>: <span class="string">&quot;iPhone&quot;</span></span><br><span class="line">        //<span class="string">&quot;value&quot;</span>:<span class="string">&quot;iphone&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;productID&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;XHDK-A-1293-#fJ3&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  //<span class="string">&quot;explain&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;productID.keyword&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;XHDK-A-1293-#fJ3&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /products/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;explain&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;constant_score&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;productID.keyword&quot;</span>: <span class="string">&quot;XHDK-A-1293-#fJ3&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¤åˆæŸ¥è¯¢"><a href="#å¤åˆæŸ¥è¯¢" class="headerlink" title="å¤åˆæŸ¥è¯¢"></a>å¤åˆæŸ¥è¯¢</h2><p>å¤åˆæŸ¥è¯¢å°±æ˜¯æŠŠä¸€äº›ç®€å•æŸ¥è¯¢ç»„åˆåœ¨ä¸€èµ·å®ç°æ›´å¤æ‚çš„æŸ¥è¯¢éœ€æ±‚ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¤åˆæŸ¥è¯¢è¿˜å¯ä»¥æ§åˆ¶å¦å¤–ä¸€ä¸ªæŸ¥è¯¢çš„è¡Œä¸ºã€‚</p>
<h3 id="bool-query"><a href="#bool-query" class="headerlink" title="bool query"></a>bool query</h3><p>bool æŸ¥è¯¢å¯ä»¥æŠŠä»»æ„å¤šä¸ªç®€å•æŸ¥è¯¢ç»„åˆåœ¨ä¸€èµ·ï¼Œä½¿ç”¨ mustã€shouldã€must_notã€filter é€‰é¡¹æ¥è¡¨ç¤ºç®€å•æŸ¥è¯¢ä¹‹é—´çš„é€»è¾‘ï¼Œæ¯ä¸ªé€‰é¡¹éƒ½å¯ä»¥å‡ºç° 0 æ¬¡åˆ°å¤šæ¬¡ï¼Œå®ƒä»¬çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>must æ–‡æ¡£å¿…é¡»åŒ¹é… must é€‰é¡¹ä¸‹çš„æŸ¥è¯¢æ¡ä»¶ï¼Œç›¸å½“äºé€»è¾‘è¿ç®—çš„ ANDï¼Œä¸”å‚ä¸æ–‡æ¡£ç›¸å…³åº¦çš„è¯„åˆ†ã€‚</li>
<li>should æ–‡æ¡£å¯ä»¥åŒ¹é… should é€‰é¡¹ä¸‹çš„æŸ¥è¯¢æ¡ä»¶ä¹Ÿå¯ä»¥ä¸åŒ¹é…ï¼Œç›¸å½“äºé€»è¾‘è¿ç®—çš„ ORï¼Œä¸”å‚ä¸æ–‡æ¡£ç›¸å…³åº¦çš„è¯„åˆ†ã€‚</li>
<li>must_not ä¸ must ç›¸åï¼ŒåŒ¹é…è¯¥é€‰é¡¹ä¸‹çš„æŸ¥è¯¢æ¡ä»¶çš„æ–‡æ¡£ä¸ä¼šè¢«è¿”å›ï¼›éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>must_not è¯­å¥ä¸ä¼šå½±å“è¯„åˆ†ï¼Œå®ƒçš„ä½œç”¨åªæ˜¯å°†ä¸ç›¸å…³çš„æ–‡æ¡£æ’é™¤</strong>ã€‚</li>
<li>filter å’Œ must ä¸€æ ·ï¼ŒåŒ¹é… filter é€‰é¡¹ä¸‹çš„æŸ¥è¯¢æ¡ä»¶çš„æ–‡æ¡£æ‰ä¼šè¢«è¿”å›ï¼Œ<strong>ä½†æ˜¯ filter ä¸è¯„åˆ†ï¼Œåªèµ·åˆ°è¿‡æ»¤åŠŸèƒ½ï¼Œä¸ must_not ç›¸å</strong>ã€‚</li>
</ul>
<p>å‡è®¾è¦æŸ¥è¯¢ title ä¸­åŒ…å«å…³é”®è¯ javaï¼Œå¹¶ä¸” price ä¸èƒ½é«˜äº 70ï¼Œdescription å¯ä»¥åŒ…å«ä¹Ÿå¯ä»¥ä¸åŒ…å«è™šæ‹Ÿæœºçš„ä¹¦ç±ï¼Œæ„é€  bool æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> books/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;status&quot;</span>: 1</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;must_not&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;range&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;price&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;gte&quot;</span>: 70</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;must&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;title&quot;</span>: <span class="string">&quot;java&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;should&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;è™šæ‹Ÿæœº&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;minimum_should_match&quot;</span>: 1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰å…³å¸ƒå°”æŸ¥è¯¢æ›´è¯¦ç»†çš„ä¿¡æ¯å‚è€ƒ <a target="_blank" rel="noopener" href="https://www.knowledgedict.com/tutorial/elasticsearch-query-bool.html">bool queryï¼ˆç»„åˆæŸ¥è¯¢ï¼‰è¯¦è§£</a>ã€‚</p>
<h3 id="boosting-query"><a href="#boosting-query" class="headerlink" title="boosting query"></a>boosting query</h3><p>boosting æŸ¥è¯¢ç”¨äºéœ€è¦å¯¹ä¸¤ä¸ªæŸ¥è¯¢çš„è¯„åˆ†è¿›è¡Œè°ƒæ•´çš„åœºæ™¯ï¼Œboosting æŸ¥è¯¢ä¼šæŠŠä¸¤ä¸ªæŸ¥è¯¢å°è£…åœ¨ä¸€èµ·å¹¶é™ä½å…¶ä¸­ä¸€ä¸ªæŸ¥è¯¢çš„è¯„åˆ†ã€‚</p>
<p>boosting æŸ¥è¯¢åŒ…æ‹¬ positiveã€negative å’Œ negative_boost ä¸‰ä¸ªéƒ¨åˆ†ï¼Œpositive ä¸­çš„æŸ¥è¯¢è¯„åˆ†ä¿æŒä¸å˜ï¼Œnegative ä¸­çš„æŸ¥è¯¢ä¼šé™ä½æ–‡æ¡£è¯„åˆ†ï¼Œnegative_boost æŒ‡æ˜ negative ä¸­é™ä½çš„æƒå€¼ã€‚å¦‚æœæˆ‘ä»¬æƒ³å¯¹ 2015 å¹´ä¹‹å‰å‡ºç‰ˆçš„ä¹¦é™ä½è¯„åˆ†ï¼Œå¯ä»¥æ„é€ ä¸€ä¸ª boosting æŸ¥è¯¢ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> books/_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;boosting&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;positive&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">					<span class="string">&quot;title&quot;</span>: <span class="string">&quot;python&quot;</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;negative&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;range&quot;</span>: &#123;</span><br><span class="line">					<span class="string">&quot;publish_time&quot;</span>: &#123;</span><br><span class="line">						<span class="string">&quot;lte&quot;</span>: <span class="string">&quot;2015-01-01&quot;</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;negative_boost&quot;</span>: 0.2</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>boosting æŸ¥è¯¢ä¸­æŒ‡å®šäº†æŠ‘åˆ¶å› å­ä¸º 0.2ï¼Œpublish_time çš„å€¼åœ¨ 2015-01-01 ä¹‹åçš„æ–‡æ¡£å¾—åˆ†ä¸å˜ï¼Œpublish_time çš„å€¼åœ¨ 2015-01-01 ä¹‹å‰çš„æ–‡æ¡£å¾—åˆ†ä¸ºåŸå¾—åˆ†çš„ 0.2 å€ã€‚</p>
<h3 id="constant-score-query"><a href="#constant-score-query" class="headerlink" title="constant_score query"></a>constant_score query</h3><p>constant<em>score query åŒ…è£…ä¸€ä¸ª filter queryï¼Œå¹¶è¿”å›åŒ¹é…è¿‡æ»¤å™¨æŸ¥è¯¢æ¡ä»¶çš„æ–‡æ¡£ï¼Œä¸”å®ƒä»¬çš„ç›¸å…³æ€§è¯„åˆ†éƒ½ç­‰äº _boost</em> å‚æ•°å€¼ï¼ˆå¯ä»¥ç†è§£ä¸ºåŸæœ‰çš„åŸºäº tf-idf æˆ– bm25 çš„ç›¸å…³åˆ†å›ºå®šä¸º 1.0ï¼Œæ‰€ä»¥æœ€ç»ˆè¯„åˆ†ä¸º _1.0 * boost_ï¼Œå³ç­‰äº <em>boost</em> å‚æ•°å€¼ï¼‰ã€‚ä¸‹é¢çš„æŸ¥è¯¢è¯­å¥ä¼šè¿”å› title å­—æ®µä¸­å«æœ‰å…³é”®è¯ <em>elasticsearch</em> çš„æ–‡æ¡£ï¼Œæ‰€æœ‰æ–‡æ¡£çš„è¯„åˆ†éƒ½æ˜¯ 1.8ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> books/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;constant_score&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;title&quot;</span>: <span class="string">&quot;elasticsearch&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;boost&quot;</span>: 1.8</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="dis-max-query"><a href="#dis-max-query" class="headerlink" title="dis_max query"></a>dis_max query</h3><p>dis_max query ä¸ bool query æœ‰ä¸€å®šè”ç³»ä¹Ÿæœ‰ä¸€å®šåŒºåˆ«ï¼Œdis_max query æ”¯æŒå¤šå¹¶å‘æŸ¥è¯¢ï¼Œå¯è¿”å›ä¸ä»»æ„æŸ¥è¯¢æ¡ä»¶å­å¥åŒ¹é…çš„ä»»ä½•æ–‡æ¡£ç±»å‹ã€‚ä¸ bool æŸ¥è¯¢å¯ä»¥å°†æ‰€æœ‰åŒ¹é…æŸ¥è¯¢çš„åˆ†æ•°ç›¸ç»“åˆä½¿ç”¨çš„æ–¹å¼ä¸åŒï¼Œdis_max æŸ¥è¯¢åªä½¿ç”¨æœ€ä½³åŒ¹é…æŸ¥è¯¢æ¡ä»¶çš„åˆ†æ•°ã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> books/_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;dis_max&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;tie_breaker&quot;</span>: 0.7,</span><br><span class="line">			<span class="string">&quot;boost&quot;</span>: 1.2,</span><br><span class="line">			<span class="string">&quot;queries&quot;</span>: [&#123;</span><br><span class="line">					<span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">						<span class="string">&quot;age&quot;</span>: 34</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;,</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">						<span class="string">&quot;age&quot;</span>: 35</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="function-score-query"><a href="#function-score-query" class="headerlink" title="function_score query"></a>function_score query</h3><p>function_score query å¯ä»¥ä¿®æ”¹æŸ¥è¯¢çš„æ–‡æ¡£å¾—åˆ†ï¼Œè¿™ä¸ªæŸ¥è¯¢åœ¨æœ‰äº›æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚é€šè¿‡è¯„åˆ†å‡½æ•°è®¡ç®—æ–‡æ¡£å¾—åˆ†ä»£ä»·è¾ƒé«˜ï¼Œå¯ä»¥æ”¹ç”¨è¿‡æ»¤å™¨åŠ è‡ªå®šä¹‰è¯„åˆ†å‡½æ•°çš„æ–¹å¼æ¥å–ä»£ä¼ ç»Ÿçš„è¯„åˆ†æ–¹å¼ã€‚</p>
<p>ä½¿ç”¨ function_score queryï¼Œç”¨æˆ·éœ€è¦å®šä¹‰ä¸€ä¸ªæŸ¥è¯¢å’Œä¸€è‡³å¤šä¸ªè¯„åˆ†å‡½æ•°ï¼Œè¯„åˆ†å‡½æ•°ä¼šå¯¹æŸ¥è¯¢åˆ°çš„æ¯ä¸ªæ–‡æ¡£åˆ†åˆ«è®¡ç®—å¾—åˆ†ã€‚</p>
<p>ä¸‹é¢è¿™æ¡æŸ¥è¯¢è¯­å¥ä¼šè¿”å› books ç´¢å¼•ä¸­çš„æ‰€æœ‰æ–‡æ¡£ï¼Œæ–‡æ¡£çš„æœ€å¤§å¾—åˆ†ä¸º 5ï¼Œæ¯ä¸ªæ–‡æ¡£çš„å¾—åˆ†éšæœºç”Ÿæˆï¼Œæƒé‡çš„è®¡ç®—æ¨¡å¼ä¸ºç›¸ä¹˜æ¨¡å¼ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> books/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;function_score&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;match all&quot;</span>: &#123;&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;boost&quot;</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">      <span class="string">&quot;random_score&quot;</span>: &#123;&#125;,</span><br><span class="line">      <span class="string">&quot;boost_mode&quot;</span>: <span class="string">&quot;multiply&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è„šæœ¬è‡ªå®šä¹‰è¯„åˆ†å…¬å¼ï¼Œè¿™é‡ŒæŠŠ price å€¼çš„ååˆ†ä¹‹ä¸€å¼€æ–¹ä½œä¸ºæ¯ä¸ªæ–‡æ¡£çš„å¾—åˆ†ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> books/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;function_score&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;title&quot;</span>: <span class="string">&quot;java&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;script_score&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;inline&quot;</span>: <span class="string">&quot;Math.sqrt(doc[&#x27;price&#x27;].value/10)&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³äº function_score çš„æ›´å¤šè¯¦ç»†å†…å®¹è¯·æŸ¥çœ‹ <a target="_blank" rel="noopener" href="https://www.knowledgedict.com/tutorial/elasticsearch-function_score.html">Elasticsearch function_score æŸ¥è¯¢æœ€å¼ºè¯¦è§£</a>ã€‚</p>
<h3 id="indices-query"><a href="#indices-query" class="headerlink" title="indices query"></a>indices query</h3><p>indices query é€‚ç”¨äºéœ€è¦åœ¨å¤šä¸ªç´¢å¼•ä¹‹é—´è¿›è¡ŒæŸ¥è¯¢çš„åœºæ™¯ï¼Œå®ƒå…è®¸æŒ‡å®šä¸€ä¸ªç´¢å¼•åå­—åˆ—è¡¨å’Œå†…éƒ¨æŸ¥è¯¢ã€‚indices query ä¸­æœ‰ query å’Œ no_match_query ä¸¤éƒ¨åˆ†ï¼Œquery ä¸­ç”¨äºæœç´¢æŒ‡å®šç´¢å¼•åˆ—è¡¨ä¸­çš„æ–‡æ¡£ï¼Œno_match_query ä¸­çš„æŸ¥è¯¢æ¡ä»¶ç”¨äºæœç´¢æŒ‡å®šç´¢å¼•åˆ—è¡¨ä¹‹å¤–çš„æ–‡æ¡£ã€‚ä¸‹é¢çš„æŸ¥è¯¢è¯­å¥å®ç°äº†æœç´¢ç´¢å¼• booksã€books2 ä¸­ title å­—æ®µåŒ…å«å…³é”®å­— javascriptï¼Œå…¶ä»–ç´¢å¼•ä¸­ title å­—æ®µåŒ…å« basketball çš„æ–‡æ¡£ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> books/_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;indices&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;indices&quot;</span>: [<span class="string">&quot;books&quot;</span>, <span class="string">&quot;books2&quot;</span>],</span><br><span class="line">			<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">					<span class="string">&quot;title&quot;</span>: <span class="string">&quot;javascript&quot;</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;no_match_query&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">					<span class="string">&quot;title&quot;</span>: <span class="string">&quot;basketball&quot;</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åµŒå¥—æŸ¥è¯¢"><a href="#åµŒå¥—æŸ¥è¯¢" class="headerlink" title="åµŒå¥—æŸ¥è¯¢"></a>åµŒå¥—æŸ¥è¯¢</h2><p>åœ¨ Elasticsearch è¿™æ ·çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ‰§è¡Œå…¨ SQL é£æ ¼çš„è¿æ¥æŸ¥è¯¢ä»£ä»·æ˜‚è´µï¼Œæ˜¯ä¸å¯è¡Œçš„ã€‚ç›¸åº”åœ°ï¼Œä¸ºäº†å®ç°æ°´å¹³è§„æ¨¡åœ°æ‰©å±•ï¼ŒElasticsearch æä¾›äº†ä»¥ä¸‹ä¸¤ç§å½¢å¼çš„ joinï¼š</p>
<ul>
<li><p>nested queryï¼ˆåµŒå¥—æŸ¥è¯¢ï¼‰</p>
<p>æ–‡æ¡£ä¸­å¯èƒ½åŒ…å«åµŒå¥—ç±»å‹çš„å­—æ®µï¼Œè¿™äº›å­—æ®µç”¨æ¥ç´¢å¼•ä¸€äº›æ•°ç»„å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºä¸€æ¡ç‹¬ç«‹çš„æ–‡æ¡£è¢«æŸ¥è¯¢å‡ºæ¥ã€‚</p>
</li>
<li><p>has_child queryï¼ˆæœ‰å­æŸ¥è¯¢ï¼‰å’Œ has_parent queryï¼ˆæœ‰çˆ¶æŸ¥è¯¢ï¼‰</p>
<p>çˆ¶å­å…³ç³»å¯ä»¥å­˜åœ¨å•ä¸ªçš„ç´¢å¼•çš„ä¸¤ä¸ªç±»å‹çš„æ–‡æ¡£ä¹‹é—´ã€‚has_child æŸ¥è¯¢å°†è¿”å›å…¶å­æ–‡æ¡£èƒ½æ»¡è¶³ç‰¹å®šæŸ¥è¯¢çš„çˆ¶æ–‡æ¡£ï¼Œè€Œ has_parent åˆ™è¿”å›å…¶çˆ¶æ–‡æ¡£èƒ½æ»¡è¶³ç‰¹å®šæŸ¥è¯¢çš„å­æ–‡æ¡£ã€‚</p>
</li>
</ul>
<h3 id="nested-query"><a href="#nested-query" class="headerlink" title="nested query"></a>nested query</h3><p>æ–‡æ¡£ä¸­å¯èƒ½åŒ…å«åµŒå¥—ç±»å‹çš„å­—æ®µï¼Œè¿™äº›å­—æ®µç”¨æ¥ç´¢å¼•ä¸€äº›æ•°ç»„å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºä¸€æ¡ç‹¬ç«‹çš„æ–‡æ¡£è¢«æŸ¥è¯¢å‡ºæ¥ï¼ˆç”¨åµŒå¥—æŸ¥è¯¢ï¼‰ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT /my_index</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;type1&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;obj1&quot;</span>: &#123;</span><br><span class="line">					<span class="string">&quot;type&quot;</span>: <span class="string">&quot;nested&quot;</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="has-child-query"><a href="#has-child-query" class="headerlink" title="has_child query"></a>has_child query</h3><p>æ–‡æ¡£çš„çˆ¶å­å…³ç³»åˆ›å»ºç´¢å¼•æ—¶åœ¨æ˜ å°„ä¸­å£°æ˜ï¼Œè¿™é‡Œä»¥å‘˜å·¥ï¼ˆemployeeï¼‰å’Œå·¥ä½œåŸå¸‚ï¼ˆbranchï¼‰ä¸ºä¾‹ï¼Œå®ƒä»¬å±äºä¸åŒçš„ç±»å‹ï¼Œç›¸å½“äºæ•°æ®åº“ä¸­çš„ä¸¤å¼ è¡¨ï¼Œå¦‚æœæƒ³æŠŠå‘˜å·¥å’Œä»–ä»¬å·¥ä½œçš„åŸå¸‚å…³è”èµ·æ¥ï¼Œéœ€è¦å‘Šè¯‰ Elasticsearch æ–‡æ¡£ä¹‹é—´çš„çˆ¶å­å…³ç³»ï¼Œè¿™é‡Œ employee æ˜¯ child typeï¼Œbranch æ˜¯ parent typeï¼Œåœ¨æ˜ å°„ä¸­å£°æ˜ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT /company</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;branch&quot;</span>: &#123;&#125;,</span><br><span class="line">		<span class="string">&quot;employee&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;parent&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;branch&quot;</span> &#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ bulk api ç´¢å¼• branch ç±»å‹ä¸‹çš„æ–‡æ¡£ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST company<span class="regexp">/branch/</span>_bulk</span><br><span class="line">&#123; <span class="string">&quot;index&quot;</span>: &#123; <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;london&quot;</span> &#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;London Westminster&quot;</span>,<span class="string">&quot;city&quot;</span>: <span class="string">&quot;London&quot;</span>,<span class="string">&quot;country&quot;</span>: <span class="string">&quot;UK&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;index&quot;</span>: &#123; <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;liverpool&quot;</span> &#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Liverpool Central&quot;</span>,<span class="string">&quot;city&quot;</span>: <span class="string">&quot;Liverpool&quot;</span>,<span class="string">&quot;country&quot;</span>: <span class="string">&quot;UK&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;index&quot;</span>: &#123; <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;paris&quot;</span> &#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Champs Elysees&quot;</span>,<span class="string">&quot;city&quot;</span>: <span class="string">&quot;Paris&quot;</span>,<span class="string">&quot;country&quot;</span>: <span class="string">&quot;France&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ å‘˜å·¥æ•°æ®ï¼š</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST company/employee/_bulk</span><br><span class="line">&#123; &quot;<span class="keyword">index</span><span class="string">&quot;: &#123; &quot;</span>_id<span class="string">&quot;: 1,&quot;</span>parent<span class="string">&quot;:&quot;</span>london<span class="string">&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">&#123; &quot;</span>name<span class="string">&quot;: &quot;</span>Alice Smith<span class="string">&quot;,&quot;</span>dob<span class="string">&quot;: &quot;</span><span class="number">1970</span><span class="number">-10</span><span class="number">-24</span><span class="string">&quot;,&quot;</span>hobby<span class="string">&quot;: &quot;</span>hiking<span class="string">&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;</span><span class="keyword">index</span><span class="string">&quot;: &#123; &quot;</span>_id<span class="string">&quot;: 2,&quot;</span>parent<span class="string">&quot;:&quot;</span>london<span class="string">&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">&#123; &quot;</span>name<span class="string">&quot;: &quot;</span>Mark Tomas<span class="string">&quot;,&quot;</span>dob<span class="string">&quot;: &quot;</span><span class="number">1982</span><span class="number">-05</span><span class="number">-16</span><span class="string">&quot;,&quot;</span>hobby<span class="string">&quot;: &quot;</span>diving<span class="string">&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;</span><span class="keyword">index</span><span class="string">&quot;: &#123; &quot;</span>_id<span class="string">&quot;: 3,&quot;</span>parent<span class="string">&quot;:&quot;</span>liverpool<span class="string">&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">&#123; &quot;</span>name<span class="string">&quot;: &quot;</span>Barry Smith<span class="string">&quot;,&quot;</span>dob<span class="string">&quot;: &quot;</span><span class="number">1979</span><span class="number">-04</span><span class="number">-01</span><span class="string">&quot;,&quot;</span>hobby<span class="string">&quot;: &quot;</span>hiking<span class="string">&quot; &#125;</span></span><br><span class="line"><span class="string">&#123; &quot;</span><span class="keyword">index</span><span class="string">&quot;: &#123; &quot;</span>_id<span class="string">&quot;: 4,&quot;</span>parent<span class="string">&quot;:&quot;</span>paris<span class="string">&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">&#123; &quot;</span>name<span class="string">&quot;: &quot;</span>Adrien Grand<span class="string">&quot;,&quot;</span>dob<span class="string">&quot;: &quot;</span><span class="number">1987</span><span class="number">-05</span><span class="number">-11</span><span class="string">&quot;,&quot;</span>hobby<span class="string">&quot;: &quot;</span>horses<span class="string">&quot; &#125;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡å­æ–‡æ¡£æŸ¥è¯¢çˆ¶æ–‡æ¡£è¦ä½¿ç”¨ has_child æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼Œæœç´¢ 1980 å¹´ä»¥åå‡ºç”Ÿçš„å‘˜å·¥æ‰€åœ¨çš„åˆ†æ”¯æœºæ„ï¼Œemployee ä¸­ 1980 å¹´ä»¥åå‡ºç”Ÿçš„æœ‰ Mark Thomas å’Œ Adrien Grandï¼Œä»–ä»¬åˆ†åˆ«åœ¨ london å’Œ parisï¼Œæ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢å‘½ä»¤è¿›è¡ŒéªŒè¯ï¼š</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET company<span class="regexp">/branch/</span>_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;has_child&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;type&quot;</span>: <span class="string">&quot;employee&quot;</span>,</span><br><span class="line">			<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;range&quot;</span>: &#123; <span class="string">&quot;dob&quot;</span>: &#123; <span class="string">&quot;gte&quot;</span>: <span class="string">&quot;1980-01-01&quot;</span> &#125; &#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœç´¢å“ªäº›æœºæ„ä¸­æœ‰åä¸º â€œAlice Smithâ€ çš„å‘˜å·¥ï¼Œå› ä¸ºä½¿ç”¨ match æŸ¥è¯¢ï¼Œä¼šè§£æä¸º â€œAliceâ€ å’Œ â€œSmithâ€ï¼Œæ‰€ä»¥ Alice Smith å’Œ Barry Smith æ‰€åœ¨çš„æœºæ„ä¼šè¢«åŒ¹é…ï¼Œæ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢å‘½ä»¤è¿›è¡ŒéªŒè¯ï¼š</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET company<span class="regexp">/branch/</span>_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;has_child&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;type&quot;</span>: <span class="string">&quot;employee&quot;</span>,</span><br><span class="line">			<span class="string">&quot;score_mode&quot;</span>: <span class="string">&quot;max&quot;</span>,</span><br><span class="line">			<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;match&quot;</span>: &#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Alice Smith&quot;</span> &#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨ min_children æŒ‡å®šå­æ–‡æ¡£çš„æœ€å°ä¸ªæ•°ã€‚ä¾‹å¦‚ï¼Œæœç´¢æœ€å°‘å«æœ‰ä¸¤ä¸ª employee çš„æœºæ„ï¼ŒæŸ¥è¯¢å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET company<span class="regexp">/branch/</span>_search?pretty</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;has_child&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;type&quot;</span>: <span class="string">&quot;employee&quot;</span>,</span><br><span class="line">			<span class="string">&quot;min_children&quot;</span>: <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="has-parent-query"><a href="#has-parent-query" class="headerlink" title="has_parent query"></a>has_parent query</h3><p>é€šè¿‡çˆ¶æ–‡æ¡£æŸ¥è¯¢å­æ–‡æ¡£ä½¿ç”¨ has_parent æŸ¥è¯¢ã€‚æ¯”å¦‚ï¼Œæœç´¢å“ªäº› employee å·¥ä½œåœ¨ UKï¼ŒæŸ¥è¯¢å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> company/employee/_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;has_parent&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;parent_type&quot;</span>: <span class="string">&quot;branch&quot;</span>,</span><br><span class="line">			<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;match&quot;</span>: &#123; <span class="string">&quot;country&quot;</span>: <span class="string">&quot;UK &#125;</span></span><br><span class="line"><span class="string">			&#125;</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="ä½ç½®æŸ¥è¯¢"><a href="#ä½ç½®æŸ¥è¯¢" class="headerlink" title="ä½ç½®æŸ¥è¯¢"></a>ä½ç½®æŸ¥è¯¢</h2><p>Elasticsearch å¯ä»¥å¯¹åœ°ç†ä½ç½®ç‚¹ geo_point ç±»å‹å’Œåœ°ç†ä½ç½®å½¢çŠ¶ geo_shape ç±»å‹çš„æ•°æ®è¿›è¡Œæœç´¢ã€‚ä¸ºäº†å­¦ä¹ æ–¹ä¾¿ï¼Œè¿™é‡Œå‡†å¤‡ä¸€äº›åŸå¸‚çš„åœ°ç†åæ ‡ä½œä¸ºæµ‹è¯•æ•°æ®ï¼Œæ¯ä¸€æ¡æ–‡æ¡£éƒ½åŒ…å«åŸå¸‚åç§°å’Œåœ°ç†åæ ‡è¿™ä¸¤ä¸ªå­—æ®µï¼Œè¿™é‡Œçš„åæ ‡ç‚¹å–çš„æ˜¯å„ä¸ªåŸå¸‚ä¸­å¿ƒçš„ä¸€ä¸ªä½ç½®ã€‚é¦–å…ˆæŠŠä¸‹é¢çš„å†…å®¹ä¿å­˜åˆ° geo.json æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;<span class="keyword">index</span><span class="string">&quot;:&#123; &quot;</span>_index<span class="string">&quot;:&quot;</span>geo<span class="string">&quot;,&quot;</span>_type<span class="string">&quot;:&quot;</span>city<span class="string">&quot;,&quot;</span>_id<span class="string">&quot;:&quot;</span><span class="number">1</span><span class="string">&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;</span>name<span class="string">&quot;:&quot;</span>åŒ—äº¬<span class="string">&quot;,&quot;</span>location<span class="string">&quot;:&quot;</span><span class="number">39.9088145109</span>,<span class="number">116.3973999023</span><span class="string">&quot;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;</span><span class="keyword">index</span><span class="string">&quot;:&#123; &quot;</span>_index<span class="string">&quot;:&quot;</span>geo<span class="string">&quot;,&quot;</span>_type<span class="string">&quot;:&quot;</span>city<span class="string">&quot;,&quot;</span>_id<span class="string">&quot;: &quot;</span><span class="number">2</span><span class="string">&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;</span>name<span class="string">&quot;:&quot;</span>ä¹Œé²æœ¨é½<span class="string">&quot;,&quot;</span>location<span class="string">&quot;:&quot;</span><span class="number">43.8266300000</span>,<span class="number">87.6168800000</span><span class="string">&quot;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;</span><span class="keyword">index</span><span class="string">&quot;:&#123; &quot;</span>_index<span class="string">&quot;:&quot;</span>geo<span class="string">&quot;,&quot;</span>_type<span class="string">&quot;:&quot;</span>city<span class="string">&quot;,&quot;</span>_id<span class="string">&quot;:&quot;</span><span class="number">3</span><span class="string">&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;</span>name<span class="string">&quot;:&quot;</span>è¥¿å®‰<span class="string">&quot;,&quot;</span>location<span class="string">&quot;:&quot;</span><span class="number">34.3412700000</span>,<span class="number">108.9398400000</span><span class="string">&quot;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;</span><span class="keyword">index</span><span class="string">&quot;:&#123; &quot;</span>_index<span class="string">&quot;:&quot;</span>geo<span class="string">&quot;,&quot;</span>_type<span class="string">&quot;:&quot;</span>city<span class="string">&quot;,&quot;</span>_id<span class="string">&quot;:&quot;</span><span class="number">4</span><span class="string">&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;</span>name<span class="string">&quot;:&quot;</span>éƒ‘å·<span class="string">&quot;,&quot;</span>location<span class="string">&quot;:&quot;</span><span class="number">34.7447157466</span>,<span class="number">113.6587142944</span><span class="string">&quot;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;</span><span class="keyword">index</span><span class="string">&quot;:&#123; &quot;</span>_index<span class="string">&quot;:&quot;</span>geo<span class="string">&quot;,&quot;</span>_type<span class="string">&quot;:&quot;</span>city<span class="string">&quot;,&quot;</span>_id<span class="string">&quot;:&quot;</span><span class="number">5</span><span class="string">&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;</span>name<span class="string">&quot;:&quot;</span>æ­å·<span class="string">&quot;,&quot;</span>location<span class="string">&quot;:&quot;</span><span class="number">30.2294080260</span>,<span class="number">120.1492309570</span><span class="string">&quot;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;</span><span class="keyword">index</span><span class="string">&quot;:&#123; &quot;</span>_index<span class="string">&quot;:&quot;</span>geo<span class="string">&quot;,&quot;</span>_type<span class="string">&quot;:&quot;</span>city<span class="string">&quot;,&quot;</span>_id<span class="string">&quot;:&quot;</span><span class="number">6</span><span class="string">&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;</span>name<span class="string">&quot;:&quot;</span>æµå—<span class="string">&quot;,&quot;</span>location<span class="string">&quot;:&quot;</span><span class="number">36.6518400000</span>,<span class="number">117.1200900000</span><span class="string">&quot;&#125;</span></span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸€ä¸ªç´¢å¼•å¹¶è®¾ç½®æ˜ å°„ï¼š</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PUT <span class="keyword">geo</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;mappings&quot;</span><span class="operator">:</span> &#123;</span><br><span class="line">		<span class="string">&quot;city&quot;</span><span class="operator">:</span> &#123;</span><br><span class="line">			<span class="string">&quot;properties&quot;</span><span class="operator">:</span> &#123;</span><br><span class="line">				<span class="string">&quot;name&quot;</span><span class="operator">:</span> &#123;</span><br><span class="line">					<span class="string">&quot;type&quot;</span><span class="operator">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="string">&quot;location&quot;</span><span class="operator">:</span> &#123;</span><br><span class="line">					<span class="string">&quot;type&quot;</span><span class="operator">:</span> <span class="string">&quot;geo_point&quot;</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œæ‰¹é‡å¯¼å…¥å‘½ä»¤ï¼š</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://localhost:9200/_bulk?pretty&quot;</span> --data-<span class="built_in">binary</span> <span class="symbol">@geo</span>.json</span><br></pre></td></tr></table></figure>

<h3 id="geo-distance-query"><a href="#geo-distance-query" class="headerlink" title="geo_distance query"></a>geo_distance query</h3><p>geo_distance query å¯ä»¥æŸ¥æ‰¾åœ¨ä¸€ä¸ªä¸­å¿ƒç‚¹æŒ‡å®šèŒƒå›´å†…çš„åœ°ç†ç‚¹æ–‡æ¡£ã€‚ä¾‹å¦‚ï¼ŒæŸ¥æ‰¾è·ç¦»å¤©æ´¥ 200km ä»¥å†…çš„åŸå¸‚ï¼Œæœç´¢ç»“æœä¸­ä¼šè¿”å›åŒ—äº¬ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> geo/_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;must&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;geo_distance&quot;</span>: &#123;</span><br><span class="line">					<span class="string">&quot;distance&quot;</span>: <span class="string">&quot;200km&quot;</span>,</span><br><span class="line">					<span class="string">&quot;location&quot;</span>: &#123;</span><br><span class="line">						<span class="string">&quot;lat&quot;</span>: 39.0851000000,</span><br><span class="line">						<span class="string">&quot;lon&quot;</span>: 117.1993700000</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŒ‰å„åŸå¸‚ç¦»åŒ—äº¬çš„è·ç¦»æ’åºï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> geo/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;sort&quot;</span>: [&#123;</span><br><span class="line">    <span class="string">&quot;_geo_distance&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;location&quot;</span>: <span class="string">&quot;39.9088145109,116.3973999023&quot;</span>,</span><br><span class="line">      <span class="string">&quot;unit&quot;</span>: <span class="string">&quot;km&quot;</span>,</span><br><span class="line">      <span class="string">&quot;order&quot;</span>: <span class="string">&quot;asc&quot;</span>,</span><br><span class="line">      <span class="string">&quot;distance_type&quot;</span>: <span class="string">&quot;plane&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ location å¯¹åº”çš„ç»çº¬åº¦å­—æ®µï¼›unit ä¸º <code>km</code> è¡¨ç¤ºå°†è·ç¦»ä»¥ <code>km</code> ä¸ºå•ä½å†™å…¥åˆ°æ¯ä¸ªè¿”å›ç»“æœçš„ sort é”®ä¸­ï¼›distance_type ä¸º <code>plane</code> è¡¨ç¤ºä½¿ç”¨å¿«é€Ÿä½†ç²¾åº¦ç•¥å·®çš„ <code>plane</code> è®¡ç®—æ–¹å¼ã€‚</p>
<h3 id="geo-bounding-box-query"><a href="#geo-bounding-box-query" class="headerlink" title="geo_bounding_box query"></a>geo_bounding_box query</h3><p>geo_bounding_box query ç”¨äºæŸ¥æ‰¾è½å…¥æŒ‡å®šçš„çŸ©å½¢å†…çš„åœ°ç†åæ ‡ã€‚æŸ¥è¯¢ä¸­ç”±ä¸¤ä¸ªç‚¹ç¡®å®šä¸€ä¸ªçŸ©å½¢ï¼Œç„¶ååœ¨çŸ©å½¢åŒºåŸŸå†…æŸ¥è¯¢åŒ¹é…çš„æ–‡æ¡£ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> geo/_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;must&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;geo_bounding_box&quot;</span>: &#123;</span><br><span class="line">					<span class="string">&quot;location&quot;</span>: &#123;</span><br><span class="line">						<span class="string">&quot;top_left&quot;</span>: &#123;</span><br><span class="line">							<span class="string">&quot;lat&quot;</span>: 38.4864400000,</span><br><span class="line">							<span class="string">&quot;lon&quot;</span>: 106.2324800000</span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="string">&quot;bottom_right&quot;</span>: &#123;</span><br><span class="line">							<span class="string">&quot;lat&quot;</span>: 28.6820200000,</span><br><span class="line">							<span class="string">&quot;lon&quot;</span>: 115.8579400000</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="geo-polygon-query"><a href="#geo-polygon-query" class="headerlink" title="geo_polygon query"></a>geo_polygon query</h3><p>geo_polygon query ç”¨äºæŸ¥æ‰¾åœ¨æŒ‡å®š<strong>å¤šè¾¹å½¢</strong>å†…çš„åœ°ç†ç‚¹ã€‚ä¾‹å¦‚ï¼Œå‘¼å’Œæµ©ç‰¹ã€é‡åº†ã€ä¸Šæµ·ä¸‰åœ°ç»„æˆä¸€ä¸ªä¸‰è§’å½¢ï¼ŒæŸ¥è¯¢ä½ç½®åœ¨è¯¥ä¸‰è§’å½¢åŒºåŸŸå†…çš„åŸå¸‚ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> geo/_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;must&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;geo_polygon&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;location&quot;</span>: &#123;</span><br><span class="line">					<span class="string">&quot;points&quot;</span>: [&#123;</span><br><span class="line">						<span class="string">&quot;lat&quot;</span>: 40.8414900000,</span><br><span class="line">						<span class="string">&quot;lon&quot;</span>: 111.7519900000</span><br><span class="line">					&#125;, &#123;</span><br><span class="line">						<span class="string">&quot;lat&quot;</span>: 29.5647100000,</span><br><span class="line">						<span class="string">&quot;lon&quot;</span>: 106.5507300000</span><br><span class="line">					&#125;, &#123;</span><br><span class="line">						<span class="string">&quot;lat&quot;</span>: 31.2303700000,</span><br><span class="line">						<span class="string">&quot;lon&quot;</span>: 121.4737000000</span><br><span class="line">					&#125;]</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="geo-shape-query"><a href="#geo-shape-query" class="headerlink" title="geo_shape query"></a>geo_shape query</h3><p>geo_shape query ç”¨äºæŸ¥è¯¢ geo_shape ç±»å‹çš„åœ°ç†æ•°æ®ï¼Œåœ°ç†å½¢çŠ¶ä¹‹é—´çš„å…³ç³»æœ‰ç›¸äº¤ã€åŒ…å«ã€ä¸ç›¸äº¤ä¸‰ç§ã€‚åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•ç”¨äºæµ‹è¯•ï¼Œå…¶ä¸­ location å­—æ®µçš„ç±»å‹è®¾ä¸º geo_shape ç±»å‹ã€‚</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PUT <span class="keyword">geoshape</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;mappings&quot;</span><span class="operator">:</span> &#123;</span><br><span class="line">		<span class="string">&quot;city&quot;</span><span class="operator">:</span> &#123;</span><br><span class="line">			<span class="string">&quot;properties&quot;</span><span class="operator">:</span> &#123;</span><br><span class="line">				<span class="string">&quot;name&quot;</span><span class="operator">:</span> &#123;</span><br><span class="line">					<span class="string">&quot;type&quot;</span><span class="operator">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="string">&quot;location&quot;</span><span class="operator">:</span> &#123;</span><br><span class="line">					<span class="string">&quot;type&quot;</span><span class="operator">:</span> <span class="string">&quot;geo_shape&quot;</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³äºç»çº¬åº¦çš„é¡ºåºè¿™é‡Œåšä¸€ä¸ªè¯´æ˜ï¼Œgeo_point ç±»å‹çš„å­—æ®µçº¬åº¦åœ¨å‰ç»åº¦åœ¨åï¼Œä½†æ˜¯å¯¹äº geo_shape ç±»å‹ä¸­çš„ç‚¹ï¼Œæ˜¯ç»åº¦åœ¨å‰çº¬åº¦åœ¨åï¼Œè¿™ä¸€ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚</p>
<p>æŠŠè¥¿å®‰å’Œéƒ‘å·è¿æˆçš„çº¿å†™å…¥ç´¢å¼•ï¼š</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">POST</span> geoshape/city/<span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;name&quot;</span>: <span class="string">&quot;è¥¿å®‰-éƒ‘å·&quot;</span>,</span><br><span class="line">	<span class="string">&quot;location&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;type&quot;</span>: <span class="string">&quot;linestring&quot;</span>,</span><br><span class="line">		<span class="string">&quot;coordinates&quot;</span>: [</span><br><span class="line">			[<span class="number">108.9398400000</span>, <span class="number">34.3412700000</span>],</span><br><span class="line">			[<span class="number">113.6587142944</span>, <span class="number">34.7447157466</span>]</span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢åŒ…å«åœ¨ç”±é“¶å·å’Œå—æ˜Œä½œä¸ºå¯¹è§’çº¿ä¸Šçš„ç‚¹ç»„æˆçš„çŸ©å½¢çš„åœ°ç†å½¢çŠ¶ï¼Œç”±äºè¥¿å®‰å’Œéƒ‘å·ç»„æˆçš„ç›´çº¿è½åœ¨è¯¥çŸ©å½¢åŒºåŸŸå†…ï¼Œå› æ­¤å¯ä»¥è¢«æŸ¥è¯¢åˆ°ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">GET</span> geoshape/<span class="symbol">_search</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;must&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;geo_shape&quot;</span>: &#123;</span><br><span class="line">					<span class="string">&quot;location&quot;</span>: &#123;</span><br><span class="line">						<span class="string">&quot;shape&quot;</span>: &#123;</span><br><span class="line">							<span class="string">&quot;type&quot;</span>: <span class="string">&quot;envelope&quot;</span>,</span><br><span class="line">							<span class="string">&quot;coordinates&quot;</span>: [</span><br><span class="line">								[<span class="number">106.23248</span>, <span class="number">38.48644</span>],</span><br><span class="line">								[<span class="number">115.85794</span>, <span class="number">28.68202</span>]</span><br><span class="line">							]</span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="string">&quot;relation&quot;</span>: <span class="string">&quot;within&quot;</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç‰¹æ®ŠæŸ¥è¯¢"><a href="#ç‰¹æ®ŠæŸ¥è¯¢" class="headerlink" title="ç‰¹æ®ŠæŸ¥è¯¢"></a>ç‰¹æ®ŠæŸ¥è¯¢</h2><h3 id="more-like-this-query"><a href="#more-like-this-query" class="headerlink" title="more_like_this query"></a>more_like_this query</h3><p>more_like_this query å¯ä»¥æŸ¥è¯¢å’Œæä¾›æ–‡æœ¬ç±»ä¼¼çš„æ–‡æ¡£ï¼Œé€šå¸¸ç”¨äºè¿‘ä¼¼æ–‡æœ¬çš„æ¨èç­‰åœºæ™¯ã€‚æŸ¥è¯¢å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> books/_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;more_like_ this&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;fields&quot;</span>: [<span class="string">&quot;title&quot;</span>, <span class="string">&quot;description&quot;</span>],</span><br><span class="line">			<span class="string">&quot;like&quot;</span>: <span class="string">&quot;java virtual machine&quot;</span>,</span><br><span class="line">			<span class="string">&quot;min_term_freq&quot;</span>: 1,</span><br><span class="line">			<span class="string">&quot;max_query_terms&quot;</span>: 12</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯é€‰çš„å‚æ•°åŠå–å€¼è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ul>
<li>fields è¦åŒ¹é…çš„å­—æ®µï¼Œé»˜è®¤æ˜¯ _all å­—æ®µã€‚</li>
<li>like è¦åŒ¹é…çš„æ–‡æœ¬ã€‚</li>
<li>min_term_freq æ–‡æ¡£ä¸­è¯é¡¹çš„æœ€ä½é¢‘ç‡ï¼Œé»˜è®¤æ˜¯ 2ï¼Œä½äºæ­¤é¢‘ç‡çš„æ–‡æ¡£ä¼šè¢«å¿½ç•¥ã€‚</li>
<li>max_query_terms query ä¸­èƒ½åŒ…å«çš„æœ€å¤§è¯é¡¹æ•°ç›®ï¼Œé»˜è®¤ä¸º 25ã€‚</li>
<li>min_doc_freq æœ€å°çš„æ–‡æ¡£é¢‘ç‡ï¼Œé»˜è®¤ä¸º 5ã€‚</li>
<li>max_doc_freq æœ€å¤§æ–‡æ¡£é¢‘ç‡ã€‚</li>
<li>min_word length å•è¯çš„æœ€å°é•¿åº¦ã€‚</li>
<li>max_word length å•è¯çš„æœ€å¤§é•¿åº¦ã€‚</li>
<li>stop_words åœç”¨è¯åˆ—è¡¨ã€‚</li>
<li>analyzer åˆ†è¯å™¨ã€‚</li>
<li>minimum_should_match æ–‡æ¡£åº”åŒ¹é…çš„æœ€å°è¯é¡¹æ•°ï¼Œé»˜è®¤ä¸º query åˆ†è¯åè¯é¡¹æ•°çš„ 30%ã€‚</li>
<li>boost terms è¯é¡¹çš„æƒé‡ã€‚</li>
<li>include æ˜¯å¦æŠŠè¾“å…¥æ–‡æ¡£ä½œä¸ºç»“æœè¿”å›ã€‚</li>
<li>boost æ•´ä¸ª query çš„æƒé‡ï¼Œé»˜è®¤ä¸º 1.0ã€‚</li>
</ul>
<h3 id="script-query"><a href="#script-query" class="headerlink" title="script query"></a>script query</h3><p>Elasticsearch æ”¯æŒä½¿ç”¨è„šæœ¬è¿›è¡ŒæŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢ä»·æ ¼å¤§äº 180 çš„æ–‡æ¡£ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> books/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;inline&quot;</span>: <span class="string">&quot;doc[&#x27;price&#x27;].value &gt; 180&quot;</span>,</span><br><span class="line">        <span class="string">&quot;lang&quot;</span>: <span class="string">&quot;painless&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="percolate-query"><a href="#percolate-query" class="headerlink" title="percolate query"></a>percolate query</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯å…ˆæŠŠæ–‡æ¡£å†™å…¥åˆ° Elasticsearch ä¸­ï¼Œé€šè¿‡æŸ¥è¯¢è¯­å¥å¯¹æ–‡æ¡£è¿›è¡Œæœç´¢ã€‚percolate query åˆ™æ˜¯åå…¶é“è€Œè¡Œä¹‹çš„åšæ³•ï¼Œå®ƒä¼šå…ˆæ³¨å†ŒæŸ¥è¯¢æ¡ä»¶ï¼Œæ ¹æ®æ–‡æ¡£æ¥æŸ¥è¯¢ queryã€‚ä¾‹å¦‚ï¼Œåœ¨ my-index ç´¢å¼•ä¸­æœ‰ä¸€ä¸ª laptop ç±»å‹ï¼Œæ–‡æ¡£æœ‰ price å’Œ name ä¸¤ä¸ªå­—æ®µï¼Œåœ¨æ˜ å°„ä¸­å£°æ˜ä¸€ä¸ª percolator ç±»å‹çš„ queryï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PUT <span class="keyword">my</span>-<span class="keyword">index</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;laptop&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;price&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span> &#125;,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span> &#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;queries&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">					<span class="string">&quot;query&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;percolator&quot;</span> &#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨å†Œä¸€ä¸ª bool queryï¼Œbool query ä¸­åŒ…å«ä¸€ä¸ª range queryï¼Œè¦æ±‚ price å­—æ®µçš„å–å€¼å°äºç­‰äº 10000ï¼Œå¹¶ä¸” name å­—æ®µä¸­å«æœ‰å…³é”®è¯ macbookï¼š</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT <span class="regexp">/my-index/</span>queries/<span class="number">1</span>?refresh</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;must&quot;</span>: [&#123;</span><br><span class="line">				<span class="string">&quot;range&quot;</span>: &#123; <span class="string">&quot;price&quot;</span>: &#123; <span class="string">&quot;lte&quot;</span>: <span class="number">10000</span> &#125; &#125;</span><br><span class="line">			&#125;, &#123;</span><br><span class="line">				<span class="string">&quot;match&quot;</span>: &#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;macbook&quot;</span> &#125;</span><br><span class="line">			&#125;]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ–‡æ¡£æŸ¥è¯¢ queryï¼š</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET <span class="regexp">/my-index/</span>_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;percolate&quot;</span>: &#123;</span><br><span class="line">			<span class="string">&quot;field&quot;</span>: <span class="string">&quot;query&quot;</span>,</span><br><span class="line">			<span class="string">&quot;document_type&quot;</span>: <span class="string">&quot;laptop&quot;</span>,</span><br><span class="line">			<span class="string">&quot;document&quot;</span>: &#123;</span><br><span class="line">				<span class="string">&quot;price&quot;</span>: <span class="number">9999</span>,</span><br><span class="line">				<span class="string">&quot;name&quot;</span>: <span class="string">&quot;macbook pro on sale&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–‡æ¡£ç¬¦åˆ query ä¸­çš„æ¡ä»¶ï¼Œè¿”å›ç»“æœä¸­å¯ä»¥æŸ¥åˆ°ä¸Šæ–‡ä¸­æ³¨å†Œçš„ bool queryã€‚percolate query çš„è¿™ç§ç‰¹æ€§é€‚ç”¨äºæ•°æ®åˆ†ç±»ã€æ•°æ®è·¯ç”±ã€äº‹ä»¶ç›‘æ§å’Œé¢„è­¦ç­‰åœºæ™¯ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/950e4d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/950e4d/" class="post-title-link" itemprop="url">SpringBoot ä¹‹å¿«é€Ÿå…¥é—¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-12-10 18:22:26" itemprop="dateCreated datePublished" datetime="2021-12-10T18:22:26+08:00">2021-12-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-23 18:54:25" itemprop="dateModified" datetime="2022-09-23T18:54:25+08:00">2022-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">æ¡†æ¶</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/%E6%A1%86%E6%9E%B6/SpringBoot/SpringBoot%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">SpringBootåŸºç¡€</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>8.8k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>8 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="SpringBoot-ä¹‹å¿«é€Ÿå…¥é—¨"><a href="#SpringBoot-ä¹‹å¿«é€Ÿå…¥é—¨" class="headerlink" title="SpringBoot ä¹‹å¿«é€Ÿå…¥é—¨"></a>SpringBoot ä¹‹å¿«é€Ÿå…¥é—¨</h1><h2 id="Spring-Boot-ç®€ä»‹"><a href="#Spring-Boot-ç®€ä»‹" class="headerlink" title="Spring Boot ç®€ä»‹"></a>Spring Boot ç®€ä»‹</h2><p>Spring Boot å¯ä»¥è®©ä½¿ç”¨è€…éå¸¸æ–¹ä¾¿çš„åˆ›å»º Spring åº”ç”¨ã€‚</p>
<p>Spring Boot çš„ç›®æ ‡æ˜¯ï¼š</p>
<ul>
<li>ä¸ºæ‰€æœ‰ Spring å¼€å‘è€…æä¾›æ›´å¿«ä¸”å¯å¹¿æ³›è®¿é—®çš„å…¥é—¨ä½“éªŒã€‚</li>
<li>å¼€ç®±å³ç”¨</li>
<li>æä¾›ä¸€ç³»åˆ—é€šç”¨çš„éåŠŸèƒ½ç‰¹æ€§ï¼ˆä¾‹å¦‚åµŒå…¥å¼æœåŠ¡ã€å®‰å…¨ã€æŒ‡æ ‡ã€å¥åº·æ£€æŸ¥å’Œå¤–éƒ¨åŒ–é…ç½®ï¼‰</li>
<li>å®Œå…¨ä¸éœ€è¦ä»£ç ç”Ÿæˆï¼Œä¹Ÿä¸éœ€è¦ XML é…ç½®ã€‚</li>
</ul>
<h2 id="Spring-Boot-ç³»ç»Ÿè¦æ±‚"><a href="#Spring-Boot-ç³»ç»Ÿè¦æ±‚" class="headerlink" title="Spring Boot ç³»ç»Ÿè¦æ±‚"></a>Spring Boot ç³»ç»Ÿè¦æ±‚</h2><p>Spring Boot çš„æ„å»ºå·¥å…·è¦æ±‚ï¼š</p>
<table>
<thead>
<tr>
<th align="left">Build Tool</th>
<th align="left">Version</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Maven</td>
<td align="left">3.5+</td>
</tr>
<tr>
<td align="left">Gradle</td>
<td align="left">6.8.x, 6.9.x, and 7.x</td>
</tr>
</tbody></table>
<p>Spring Boot æ”¯æŒçš„ Servlet å®¹å™¨ï¼š</p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Servlet Version</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Tomcat 9.0</td>
<td align="left">4.0</td>
</tr>
<tr>
<td align="left">Jetty 9.4</td>
<td align="left">3.1</td>
</tr>
<tr>
<td align="left">Jetty 10.0</td>
<td align="left">4.0</td>
</tr>
<tr>
<td align="left">Undertow 2.0</td>
<td align="left">4.0</td>
</tr>
</tbody></table>
<h2 id="éƒ¨ç½²ç¬¬ä¸€ä¸ª-Spring-Boot-é¡¹ç›®"><a href="#éƒ¨ç½²ç¬¬ä¸€ä¸ª-Spring-Boot-é¡¹ç›®" class="headerlink" title="éƒ¨ç½²ç¬¬ä¸€ä¸ª Spring Boot é¡¹ç›®"></a>éƒ¨ç½²ç¬¬ä¸€ä¸ª Spring Boot é¡¹ç›®</h2><blockquote>
<p>æœ¬èŠ‚ä»‹ç»å¦‚ä½•å¼€å‘ä¸€ä¸ªå°çš„â€œHello World!â€ web åº”ç”¨ç¤ºä¾‹ï¼Œæ¥å±•ç¤º Spring Boot çš„ä¸€äº›å…³é”®åŠŸèƒ½ã€‚æˆ‘ä»¬ä½¿ç”¨ Maven æ¥æ„å»ºè¿™ä¸ªé¡¹ç›®ï¼Œå› ä¸ºå¤§å¤šæ•° IDE éƒ½æ”¯æŒå®ƒã€‚</p>
</blockquote>
<h3 id="ç¯å¢ƒæ£€æŸ¥"><a href="#ç¯å¢ƒæ£€æŸ¥" class="headerlink" title="ç¯å¢ƒæ£€æŸ¥"></a>ç¯å¢ƒæ£€æŸ¥</h3><p>Spring Boot é¡¹ç›®ä¾èµ–äº Java ç¯å¢ƒå’Œ Maveï¼Œå¼€å§‹é¡¹ç›®ä¹‹å‰éœ€è¦å…ˆæ£€æŸ¥ä¸€ä¸‹ç¯å¢ƒã€‚</p>
<p>æœ¬åœ°æ˜¯å¦å·²å®‰è£… Javaï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">java -version</span></span><br><span class="line">java version &quot;1.8.0_102&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_102-b14)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.102-b14, mixed mode)</span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°æ˜¯å¦å·²å®‰è£… Mavenï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mvn -v</span><br><span class="line">Apache Maven <span class="number">3.5</span><span class="number">.4</span> (1edded0938998edf8bf061f1ceb3cfdeccf443fe; <span class="number">2018</span>-<span class="number">06</span>-17T14:<span class="number">33</span>:<span class="number">14</span>-<span class="number">04</span>:<span class="number">00</span>)</span><br><span class="line">Maven home: /usr/local/Cellar/maven/<span class="number">3.3</span><span class="number">.9</span>/libexec</span><br><span class="line">Java version: <span class="number">1.8</span><span class="number">.0_102</span>, vendor: Oracle Corporation</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»º-pom"><a href="#åˆ›å»º-pom" class="headerlink" title="åˆ›å»º pom"></a>åˆ›å»º pom</h3><p>æˆ‘ä»¬éœ€è¦ä»åˆ›å»º Maven pom.xml æ–‡ä»¶å¼€å§‹ã€‚ pom.xml æ˜¯ Maven ç”¨äºæ„å»ºé¡¹ç›®çš„é…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>myproject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Additional lines to be added here... --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è€…å¯ä»¥é€šè¿‡è¿è¡Œ mvn package æ¥æµ‹è¯•å®ƒ</p>
<h3 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h3><p>Spring Boot æä¾›äº†è®¸å¤šå¯åŠ¨å™¨ï¼ˆStartersï¼‰ä»¥åº”å¯¹ä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚ä½¿ç”¨è€…å¯å°† jars æ·»åŠ åˆ°ç±»è·¯å¾„ä¸­ã€‚æˆ‘ä»¬çš„ç¤ºä¾‹ç¨‹åºåœ¨ POM çš„ parent ä½¿ç”¨ spring-boot-starter-parentã€‚ spring-boot-starter-parent æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯åŠ¨å™¨ï¼Œæä¾›æœ‰ç”¨çš„ Maven é»˜è®¤å€¼ã€‚å®ƒè¿˜æä¾›äº†ä¸€ä¸ªä¾èµ–é¡¹çš„ç‰ˆæœ¬ç®¡ç†ï¼Œå¯ä»¥è®©ä½¿ç”¨è€…ä½¿ç”¨æ—¶ä¸å¿…æ˜¾ç¤ºæŒ‡å®šç‰ˆæœ¬ã€‚</p>
<p>å…¶ä»–å¯åŠ¨å™¨ï¼ˆStartersï¼‰æä¾›äº†å„ç§é’ˆå¯¹ä¸åŒä½¿ç”¨åœºæ™¯çš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬éœ€è¦å¼€å‘ä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œå°±å¯ä»¥æ·»åŠ äº†ä¸€ä¸ª spring-boot-starter-web ä¾èµ–é¡¹ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹æˆ‘ä»¬å½“å‰æ‹¥æœ‰çš„ maven ä¾èµ–ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mvn dependency:tree</span></span><br><span class="line"></span><br><span class="line">[INFO] com.example:myproject:jar:0.0.1-SNAPSHOT</span><br></pre></td></tr></table></figure>

<p>mvn dependency:tree å‘½ä»¤æ‰“å°é¡¹ç›®ä¾èµ–é¡¹çš„å±‚çº§ç»“æ„ã€‚å¯ä»¥çœ‹åˆ° spring-boot-starter-parent æœ¬èº«æ²¡æœ‰æä¾›ä»»ä½•ä¾èµ–ã€‚è¦æ·»åŠ å¿…è¦çš„ä¾èµ–ï¼Œéœ€è¦ç¼–è¾‘ pom.xml å¹¶åœ¨ <code>&lt;dependencies&gt;</code> éƒ¨åˆ†æ·»åŠ  spring-boot-starter-web ä¾èµ–é¡¹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="ç¼–å†™ä»£ç "><a href="#ç¼–å†™ä»£ç " class="headerlink" title="ç¼–å†™ä»£ç "></a>ç¼–å†™ä»£ç </h3><p>è¦è¿è¡Œåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¯åŠ¨ç±»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMaven ä» <code>src/main/java</code> ç¼–è¯‘æºä»£ç ï¼Œå› æ­¤æ‚¨éœ€è¦åˆ›å»ºè¯¥ç›®å½•ç»“æ„ï¼Œç„¶åæ·»åŠ ä¸€ä¸ªåä¸º <code>src/main/java/MyApplication.java</code> çš„æ–‡ä»¶ä»¥åŒ…å«ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line">    String <span class="title function_">home</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MyApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼š</p>
<p>@RestController æ³¨è§£å‘Šè¯‰ Springï¼Œè¿™ä¸ªç±»æ˜¯ç”¨æ¥å¤„ç† Rest è¯·æ±‚çš„ã€‚</p>
<p><code>@RequestMapping</code> æ³¨è§£æä¾›äº†â€œè·¯ç”±â€ä¿¡æ¯ã€‚å®ƒå‘Šè¯‰ Spring ä»»ä½•å¸¦æœ‰ <code>/</code> è·¯å¾„çš„ HTTP è¯·æ±‚éƒ½åº”è¯¥æ˜ å°„åˆ° <code>home</code> æ–¹æ³•ã€‚ <code>@RestController</code> æ³¨è§£å‘Šè¯‰ Spring å°†ç»“æœå­—ç¬¦ä¸²ç›´æ¥å‘ˆç°ç»™è°ƒç”¨è€…ã€‚</p>
<p><code>@EnableAutoConfiguration</code> æ³¨è§£å‘Šè¯‰ Spring Boot æ ¹æ®ä½ æ·»åŠ çš„ jar ä¾èµ–å»è‡ªåŠ¨è£…é… Springã€‚</p>
<blockquote>
<p>è‡ªåŠ¨é…ç½®æ—¨åœ¨ä¸â€œStartersâ€é…åˆä½¿ç”¨ï¼Œä½†è¿™ä¸¤ä¸ªæ¦‚å¿µå¹¶æ²¡æœ‰ç›´æ¥è”ç³»ã€‚æ‚¨å¯ä»¥è‡ªç”±é€‰æ‹© starters ä¹‹å¤–çš„ jar ä¾èµ–é¡¹ã€‚ Spring Boot ä»ç„¶å°½åŠ›è‡ªåŠ¨é…ç½®æ‚¨çš„åº”ç”¨ç¨‹åºã€‚</p>
</blockquote>
<p>Spring Boot çš„ main æ–¹æ³•é€šè¿‡è°ƒç”¨ run å§”æ‰˜ç»™ Spring Boot çš„ <code>SpringApplication</code> ç±»ã€‚ <code>SpringApplication</code> å¼•å¯¼æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå¯åŠ¨ Springï¼Œè¿›è€Œå¯åŠ¨è‡ªåŠ¨é…ç½®çš„ Tomcat Web æœåŠ¡å™¨ã€‚æˆ‘ä»¬éœ€è¦å°† <code>MyApplication.class</code> ä½œä¸ºå‚æ•°ä¼ é€’ç»™ run æ–¹æ³•ï¼Œä»¥å‘Šè¯‰ <code>SpringApplication</code> å“ªä¸ªæ˜¯å…¥å£ç±»ã€‚è¿˜ä¼ é€’ args æ•°ç»„ä»¥å…¬å¼€ä»»ä½•å‘½ä»¤è¡Œå‚æ•°ã€‚</p>
<h3 id="è¿è¡Œç¤ºä¾‹"><a href="#è¿è¡Œç¤ºä¾‹" class="headerlink" title="è¿è¡Œç¤ºä¾‹"></a>è¿è¡Œç¤ºä¾‹</h3><p>æ­¤æ—¶ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºåº”è¯¥å¯ä»¥å·¥ä½œäº†ã€‚ç”±äºæ‚¨ä½¿ç”¨äº† spring-boot-starter-parent POMï¼Œå› æ­¤æ‚¨æœ‰ä¸€ä¸ªæœ‰ç”¨çš„è¿è¡Œç›®æ ‡ï¼Œå¯ç”¨äºå¯åŠ¨åº”ç”¨ç¨‹åºã€‚ä»é¡¹ç›®æ ¹ç›®å½•é”®å…¥ mvn spring-boot:run ä»¥å¯åŠ¨åº”ç”¨ç¨‹åºã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mvn spring-boot:run</span></span><br><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &#x27;_ | &#x27;_| | &#x27;_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &#x27;  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="line"> =========|_|==============|___/=/_/_/_/</span><br><span class="line"> :: Spring Boot ::  (v2.6.1)</span><br><span class="line">....... . . .</span><br><span class="line">....... . . . (log output here)</span><br><span class="line">....... . . .</span><br><span class="line">........ Started MyApplication in 2.222 seconds (JVM running for 6.514)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ‚¨æ‰“å¼€ Web æµè§ˆå™¨è®¿é—® localhost:8080ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</p>
<figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br></pre></td></tr></table></figure>

<p>è¦æ­£å¸¸é€€å‡ºåº”ç”¨ç¨‹åºï¼Œè¯·æŒ‰ <code>ctrl-c</code>ã€‚</p>
<h3 id="åˆ›å»ºå¯æ‰§è¡Œ-jar"><a href="#åˆ›å»ºå¯æ‰§è¡Œ-jar" class="headerlink" title="åˆ›å»ºå¯æ‰§è¡Œ jar"></a>åˆ›å»ºå¯æ‰§è¡Œ jar</h3><p>è¦åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œçš„ jarï¼Œæˆ‘ä»¬éœ€è¦å°† spring-boot-maven-plugin æ·»åŠ åˆ°æˆ‘ä»¬çš„ pom.xml ä¸­ã€‚ä¸ºæ­¤ï¼Œè¯·åœ¨ä¾èµ–é¡¹éƒ¨åˆ†ä¸‹æ–¹æ’å…¥ä»¥ä¸‹è¡Œï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¿å­˜ pom.xml å¹¶ä»å‘½ä»¤è¡Œè¿è¡Œ mvn packageï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mvn package</span></span><br><span class="line"></span><br><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Building myproject 0.0.1-SNAPSHOT</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] .... ..</span><br><span class="line">[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ myproject ---</span><br><span class="line">[INFO] Building jar: /Users/developer/example/spring-boot-example/target/myproject-0.0.1-SNAPSHOT.jar</span><br><span class="line">[INFO]</span><br><span class="line">[INFO] --- spring-boot-maven-plugin:2.6.1:repackage (default) @ myproject ---</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ‚¨æŸ¥çœ‹ target ç›®å½•ï¼Œåº”è¯¥ä¼šçœ‹åˆ° <code>myproject-0.0.1-SNAPSHOT.jar</code>ã€‚è¯¥æ–‡ä»¶çš„å¤§å°åº”çº¦ä¸º 10 MBã€‚å¦‚æœæƒ³çœ‹é‡Œé¢ï¼Œå¯ä»¥ä½¿ç”¨ jar tvfï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">jar tvf target/myproject-0.0.1-SNAPSHOT.jar</span></span><br></pre></td></tr></table></figure>

<p>æ‚¨è¿˜åº”è¯¥åœ¨ç›®æ ‡ç›®å½•ä¸­çœ‹åˆ°ä¸€ä¸ªæ›´å°çš„åä¸º <code>myproject-0.0.1-SNAPSHOT.jar.original</code> çš„æ–‡ä»¶ã€‚è¿™æ˜¯ Maven åœ¨ Spring Boot é‡æ–°æ‰“åŒ…ä¹‹å‰åˆ›å»ºçš„åŸå§‹ jar æ–‡ä»¶ã€‚</p>
<p>è¦è¿è¡Œè¯¥åº”ç”¨ç¨‹åºï¼Œè¯·ä½¿ç”¨ java -jar å‘½ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar target/myproject-0.0.1-SNAPSHOT.jar</span><br><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ |<span class="string"> &#x27;_ </span>|<span class="string"> &#x27;_</span>|<span class="string"> </span>|<span class="string"> &#x27;_ \/ _` </span>|<span class="string"> \ \ \ \</span></span><br><span class="line"><span class="string"> \\/  ___)</span>|<span class="string"> </span>|<span class="string">_)</span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>||<span class="string"> (_</span>|<span class="string"> </span>|<span class="string">  ) ) ) )</span></span><br><span class="line"><span class="string">  &#x27;  </span>|<span class="string">____</span>|<span class="string"> .__</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">_</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">_\__, </span>|<span class="string"> / / / /</span></span><br><span class="line"><span class="string"> =========</span>|<span class="string">_</span>|<span class="string">==============</span>|<span class="string">___/=/_/_/_/</span></span><br><span class="line"><span class="string"> :: Spring Boot ::  (v2.6.1)</span></span><br><span class="line"><span class="string">....... . . .</span></span><br><span class="line"><span class="string">....... . . . (log output here)</span></span><br><span class="line"><span class="string">....... . . .</span></span><br><span class="line"><span class="string">........ Started MyApplication in 2.536 seconds (JVM running for 2.864)</span></span><br></pre></td></tr></table></figure>

<p>å’Œä»¥å‰ä¸€æ ·ï¼Œè¦é€€å‡ºåº”ç”¨ç¨‹åºï¼Œè¯·æŒ‰ <code>ctrl-c</code>ã€‚</p>
<h2 id="é€šè¿‡-SPRING-INITIALIZR-åˆ›å»º-Spring-Boot-é¡¹ç›®"><a href="#é€šè¿‡-SPRING-INITIALIZR-åˆ›å»º-Spring-Boot-é¡¹ç›®" class="headerlink" title="é€šè¿‡ SPRING INITIALIZR åˆ›å»º Spring Boot é¡¹ç›®"></a>é€šè¿‡ SPRING INITIALIZR åˆ›å»º Spring Boot é¡¹ç›®</h2><h3 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h3><p>é€šè¿‡ <code>SPRING INITIALIZR</code> å·¥å…·äº§ç”ŸåŸºç¡€é¡¹ç›®</p>
<ol>
<li>è®¿é—®ï¼š<code>http://start.spring.io/</code></li>
<li>é€‰æ‹©æ„å»ºå·¥å…·<code>Maven Project</code>ã€Spring Boot ç‰ˆæœ¬ <code>1.5.10</code> ä»¥åŠä¸€äº›å·¥ç¨‹åŸºæœ¬ä¿¡æ¯ï¼Œå¯å‚è€ƒä¸‹å›¾æ‰€ç¤ºï¼š</li>
</ol>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/start.spring.io.png" alt="img"></p>
<ol start="3">
<li>ç‚¹å‡»<code>Generate Project</code>ä¸‹è½½é¡¹ç›®å‹ç¼©åŒ…</li>
<li>è§£å‹å‹ç¼©åŒ…ï¼ŒåŒ…ä¸­å·²æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ã€‚</li>
</ol>
<p>å¦‚æœä½ ä½¿ç”¨ Intellij ä½œä¸º IDEï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ SPRING INITIALIZRï¼Œå‚è€ƒä¸‹å›¾æ“ä½œï¼š</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/intellij-spring-initializr.gif" alt="img"></p>
<h3 id="é¡¹ç›®è¯´æ˜"><a href="#é¡¹ç›®è¯´æ˜" class="headerlink" title="é¡¹ç›®è¯´æ˜"></a>é¡¹ç›®è¯´æ˜</h3><p><strong>é‡è¦æ–‡ä»¶</strong></p>
<ul>
<li><code>src/main/java</code> è·¯å¾„ä¸‹çš„ <code>Chapter1Application</code> ç±» ï¼šç¨‹åºå…¥å£</li>
<li><code>src/main/resources</code> è·¯å¾„ä¸‹çš„ <code>application.properties</code> ï¼šé¡¹ç›®é…ç½®æ–‡ä»¶</li>
<li><code>src/test/java</code> è·¯å¾„ä¸‹çš„ <code>Chapter01ApplicationTests</code> ï¼šç¨‹åºæµ‹è¯•å…¥å£</li>
</ul>
<p><strong>pom.xml</strong></p>
<p>pom ä¸­æŒ‡å®š parent ä¸ºä»¥ä¸‹å†…å®¹ï¼Œè¡¨ç¤ºæ­¤é¡¹ç›®ç»§æ‰¿äº† <code>spring-boot-starter-parent</code> çš„ maven é…ç½®ï¼ˆä¸»è¦æ˜¯æŒ‡å®šäº†å¸¸ç”¨ä¾èµ–ã€æ’ä»¶çš„ç‰ˆæœ¬ï¼‰ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ­¤å¤–ï¼Œpom ä¸­é»˜è®¤å¼•å…¥ä¸¤ä¸ªä¾èµ–åŒ…ï¼Œå’Œä¸€ä¸ªæ’ä»¶ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>spring-boot-starter-web</code>ï¼šæ ¸å¿ƒæ¨¡å—ï¼ŒåŒ…æ‹¬è‡ªåŠ¨é…ç½®æ”¯æŒã€æ—¥å¿—å’Œ YAMLã€‚</li>
<li><code>spring-boot-starter-test</code>ï¼šæµ‹è¯•æ¨¡å—ï¼ŒåŒ…æ‹¬ JUnitã€Hamcrestã€Mockitoã€‚</li>
<li><code>spring-boot-maven-plugin</code>ï¼šspring boot æ’ä»¶ï¼Œ æä¾›äº†ä¸€ç³»åˆ— spring boot ç›¸å…³çš„ maven æ“ä½œã€‚<ul>
<li><code>spring-boot:build-info</code>ï¼Œç”Ÿæˆ Actuator ä½¿ç”¨çš„æ„å»ºä¿¡æ¯æ–‡ä»¶ build-info.properties</li>
<li><code>spring-boot:repackage</code>ï¼Œé»˜è®¤ goalã€‚åœ¨ mvn package ä¹‹åï¼Œå†æ¬¡æ‰“åŒ…å¯æ‰§è¡Œçš„ jar&#x2F;warï¼ŒåŒæ—¶ä¿ç•™ mvn package ç”Ÿæˆçš„ jar&#x2F;war ä¸º.origin</li>
<li><code>spring-boot:run</code>ï¼Œè¿è¡Œ Spring Boot åº”ç”¨</li>
<li><code>spring-boot:start</code>ï¼Œåœ¨ mvn integration-test é˜¶æ®µï¼Œè¿›è¡Œ Spring Boot åº”ç”¨ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†</li>
<li><code>spring-boot:stop</code>ï¼Œåœ¨ mvn integration-test é˜¶æ®µï¼Œè¿›è¡Œ Spring Boot åº”ç”¨ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†</li>
</ul>
</li>
</ul>
<h3 id="ç¼–å†™-REST-æœåŠ¡"><a href="#ç¼–å†™-REST-æœåŠ¡" class="headerlink" title="ç¼–å†™ REST æœåŠ¡"></a>ç¼–å†™ REST æœåŠ¡</h3><ul>
<li>åˆ›å»º <code>package</code> ï¼Œåä¸º <code>io.github.zp.springboot.chapter1.web</code>ï¼ˆæ ¹æ®é¡¹ç›®æƒ…å†µä¿®æ”¹ï¼‰</li>
<li>åˆ›å»º <code>HelloController</code> ç±»ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯åŠ¨ä¸»ç¨‹åº <code>XXXApplication</code>ï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—®<code>http://localhost:8080/hello</code> ï¼Œå¯ä»¥çœ‹åˆ°é¡µé¢è¾“å‡º<code>Hello World</code></li>
</ul>
<h3 id="ç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹"><a href="#ç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹" class="headerlink" title="ç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹"></a>ç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹</h3><p>åœ¨ <code>XXXApplicationTests</code> ç±»ä¸­ç¼–å†™ä¸€ä¸ªç®€å•çš„å•å…ƒæµ‹è¯•æ¥æ¨¡æ‹Ÿ HTTP è¯·æ±‚ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@SpringApplicationConfiguration(classes = MockServletContext.class)</span></span><br><span class="line"><span class="meta">@WebAppConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBootHelloWorldApplicationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> MockMvc mvc;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">		mvc = MockMvcBuilders.standaloneSetup(<span class="keyword">new</span> <span class="title class_">HelloController</span>()).build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getHello</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		mvc.perform(MockMvcRequestBuilders.get(<span class="string">&quot;/hello&quot;</span>).accept(MediaType.APPLICATION_JSON))</span><br><span class="line">				.andExpect(status().isOk())</span><br><span class="line">				.andExpect(content().string(equalTo(<span class="string">&quot;Hello World&quot;</span>)));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>MockServletContext</code>æ¥æ„å»ºä¸€ä¸ªç©ºçš„<code>WebApplicationContext</code>ï¼Œè¿™æ ·æˆ‘ä»¬åˆ›å»ºçš„<code>HelloController</code>å°±å¯ä»¥åœ¨<code>@Before</code>å‡½æ•°ä¸­åˆ›å»ºå¹¶ä¼ é€’åˆ°<code>MockMvcBuilders.standaloneSetupï¼ˆï¼‰</code>å‡½æ•°ä¸­ã€‚</p>
<ul>
<li>æ³¨æ„å¼•å…¥ä¸‹é¢å†…å®¹ï¼Œè®©<code>status</code>ã€<code>content</code>ã€<code>equalTo</code>å‡½æ•°å¯ç”¨</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.Matchers.equalTo;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤å·²å®Œæˆç›®æ ‡ï¼Œé€šè¿‡ Maven æ„å»ºäº†ä¸€ä¸ªç©ºç™½ Spring Boot é¡¹ç›®ï¼Œå†é€šè¿‡å¼•å…¥ web æ¨¡å—å®ç°äº†ä¸€ä¸ªç®€å•çš„è¯·æ±‚å¤„ç†ã€‚</p>
<h3 id="ç¤ºä¾‹æºç "><a href="#ç¤ºä¾‹æºç " class="headerlink" title="ç¤ºä¾‹æºç "></a>ç¤ºä¾‹æºç </h3><blockquote>
<p>ç¤ºä¾‹æºç ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/spring-boot-tutorial/tree/master/codes/web/spring-boot-web-helloworld">spring-boot-web-helloworld</a></p>
</blockquote>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/getting-started.html#getting-started">Spring Boot å®˜æ–¹æ–‡æ¡£ä¹‹ Getting Started</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/286bb3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/286bb3/" class="post-title-link" itemprop="url">åˆ†å¸ƒå¼åŸºç¡€ç†è®º</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-11-08 08:15:33" itemprop="dateCreated datePublished" datetime="2021-11-08T08:15:33+08:00">2021-11-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-23 18:54:25" itemprop="dateModified" datetime="2022-09-23T18:54:25+08:00">2022-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E7%90%86%E8%AE%BA/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼ç†è®º</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>1 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="åˆ†å¸ƒå¼åŸºç¡€ç†è®º"><a href="#åˆ†å¸ƒå¼åŸºç¡€ç†è®º" class="headerlink" title="åˆ†å¸ƒå¼åŸºç¡€ç†è®º"></a>åˆ†å¸ƒå¼åŸºç¡€ç†è®º</h1><h2 id="åˆ†å¸ƒå¼ç‰¹æ€§å’Œåˆ†ç±»"><a href="#åˆ†å¸ƒå¼ç‰¹æ€§å’Œåˆ†ç±»" class="headerlink" title="åˆ†å¸ƒå¼ç‰¹æ€§å’Œåˆ†ç±»"></a>åˆ†å¸ƒå¼ç‰¹æ€§å’Œåˆ†ç±»</h2><h3 id="åˆ†å¸ƒå¼ç‰¹æ€§"><a href="#åˆ†å¸ƒå¼ç‰¹æ€§" class="headerlink" title="åˆ†å¸ƒå¼ç‰¹æ€§"></a>åˆ†å¸ƒå¼ç‰¹æ€§</h3><ul>
<li><strong>æ€§èƒ½</strong>ï¼šç”¨äºè¡¡é‡ä¸€ä¸ªç³»ç»Ÿå¤„ç†å„ç§ä»»åŠ¡çš„èƒ½åŠ›ã€‚<ul>
<li><strong>ååé‡</strong>ï¼šç³»ç»Ÿåœ¨ä¸€å®šæ—¶é—´å†…å¯ä»¥å¤„ç†çš„ä»»åŠ¡æ•°ã€‚<ul>
<li><strong>QPS</strong>ï¼Œå³æ¯ç§’æŸ¥è¯¢æ•°</li>
<li><strong>TPS</strong>ï¼Œå³æ¯ç§’äº‹åŠ¡æ•°</li>
</ul>
</li>
<li><strong>å“åº”æ—¶é—´</strong>ï¼šç³»ç»Ÿå“åº”ä¸€ä¸ªè¯·æ±‚æˆ–è¾“å…¥éœ€è¦èŠ±è´¹çš„æ—¶é—´ã€‚</li>
</ul>
</li>
<li><strong>å¯ç”¨æ€§</strong>ï¼šæŒ‡çš„æ˜¯ç³»ç»Ÿåœ¨é¢å¯¹å„ç§å¼‚å¸¸æ—¶å¯ä»¥æ­£ç¡®æä¾›æœåŠ¡çš„èƒ½åŠ›ã€‚ç³»ç»Ÿçš„å¯ç”¨æ€§å¯ä»¥ç”¨ç³»ç»Ÿåœæ­¢æœåŠ¡çš„æ—¶é—´ä¸æ€»çš„æ—¶é—´ä¹‹æ¯”è¡¡é‡ã€‚</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šæŒ‡çš„æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿé€šè¿‡æ‰©å±•é›†ç¾¤æœºå™¨è§„æ¨¡æé«˜ç³»ç»Ÿæ€§èƒ½ (ååã€å“åº”æ—¶é—´ã€ å®Œæˆæ—¶é—´)ã€å­˜å‚¨å®¹é‡ã€è®¡ç®—èƒ½åŠ›çš„ç‰¹æ€§ï¼Œæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç‰¹æœ‰æ€§è´¨ã€‚</li>
</ul>
<h3 id="åˆ†å¸ƒå¼åˆ†ç±»"><a href="#åˆ†å¸ƒå¼åˆ†ç±»" class="headerlink" title="åˆ†å¸ƒå¼åˆ†ç±»"></a>åˆ†å¸ƒå¼åˆ†ç±»</h3><ul>
<li><strong>åˆ†å¸ƒå¼è®¡ç®—</strong>ï¼šè§£å†³åº”ç”¨çš„åˆ†å¸ƒå¼è®¡ç®—é—®é¢˜ã€‚åŸºäºåˆ†å¸ƒå¼è®¡ç®—æ¨¡å¼ï¼ŒåŒ…æ‹¬æ‰¹å¤„ç†è®¡ç®—ã€ç¦»çº¿è®¡ç®—ã€åœ¨çº¿è®¡ç®—ã€èåˆè®¡ç®—ç­‰ï¼Œæ ¹æ®åº”ç”¨ç±»å‹æ„å»ºé«˜æ•ˆæ™ºèƒ½çš„åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ã€‚</li>
<li><strong>åˆ†å¸ƒå¼å­˜å‚¨</strong>ï¼šè§£å†³æ•°æ®çš„åˆ†å¸ƒå¼å’Œå¤šå…ƒåŒ–é—®é¢˜ã€‚åŒ…æ‹¬åˆ†å¸ƒå¼æ•°æ®åº“ã€åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€åˆ†å¸ƒå¼ç¼“å­˜ç­‰ï¼Œæ”¯æŒä¸åŒç±»å‹çš„æ•°æ®çš„å­˜å‚¨å’Œç®¡ç†ã€‚</li>
<li><strong>åˆ†å¸ƒå¼é€šä¿¡</strong>ï¼šè§£å†³è¿›ç¨‹é—´çš„åˆ†å¸ƒå¼é€šä¿¡é—®é¢˜ã€‚é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ã€è¿œç¨‹è°ƒç”¨ç­‰æ–¹å¼ï¼Œå®ç°ç®€å•é«˜æ•ˆçš„é€šä¿¡ã€‚</li>
<li><strong>åˆ†å¸ƒå¼èµ„æºç®¡ç†</strong>ï¼šè§£å†³èµ„æºçš„åˆ†å¸ƒå¼å’Œå¼‚æ„æ€§é—®é¢˜ã€‚å°† CPUã€å†…å­˜ã€IO ç­‰ç‰©ç†èµ„æºè™šæ‹ŸåŒ–ï¼Œæ–°åŸé€»è¾‘èµ„æºæ± ï¼Œä»¥ä¾¿ç»Ÿä¸€ç®¡ç†ã€‚</li>
</ul>
<h2 id="é”™è¯¯çš„åˆ†å¸ƒå¼å‡è®¾"><a href="#é”™è¯¯çš„åˆ†å¸ƒå¼å‡è®¾" class="headerlink" title="é”™è¯¯çš„åˆ†å¸ƒå¼å‡è®¾"></a>é”™è¯¯çš„åˆ†å¸ƒå¼å‡è®¾</h2><blockquote>
<p>å†…å®¹æ‘˜è‡ª <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing">Fallacies of Distributed Computing</a></p>
</blockquote>
<p>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ¯ä¸€æ¡éƒ½ä¼šè¢«è¯æ˜æ˜¯é”™è¯¯çš„ï¼Œä¹Ÿéƒ½ä¼šå¯¼è‡´ä¸¥é‡çš„é—®é¢˜ï¼Œä»¥åŠç—›è‹¦çš„å­¦ä¹ ä½“éªŒï¼š</p>
<ul>
<li>ç½‘ç»œæ˜¯ç¨³å®šçš„</li>
<li>ç½‘ç»œä¼ è¾“çš„å»¶è¿Ÿæ˜¯é›¶</li>
<li>ç½‘ç»œçš„å¸¦å®½æ˜¯æ— ç©·å¤§</li>
<li>ç½‘ç»œæ˜¯å®‰å…¨çš„</li>
<li>ç½‘ç»œçš„æ‹“æ‰‘ä¸ä¼šæ”¹å˜</li>
<li>åªæœ‰ä¸€ä¸ªç³»ç»Ÿç®¡ç†å‘˜</li>
<li>ä¼ è¾“æ•°æ®çš„æˆæœ¬ä¸ºé›¶</li>
<li>æ•´ä¸ªç½‘ç»œæ˜¯åŒæ„çš„</li>
</ul>
<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æ·±åˆ»åœ°è®¤è¯†è¿™ 8 ä¸ªé”™è¯¯ï¼Ÿ</p>
<p>æ˜¯å› ä¸ºï¼Œè¿™è¦æˆ‘ä»¬æ¸…æ¥šåœ°è®¤è¯†åˆ°â€”â€”<strong>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé”™è¯¯æ˜¯ä¸å¯èƒ½é¿å…çš„</strong>ã€‚æ—¢ç„¶é”™è¯¯æ— å¯é¿å…ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥åšçš„æ˜¯ï¼Œå°†å®¹é”™ä¹Ÿä½œä¸ºåŠŸèƒ½å»å®ç°ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing">Fallacies of Distributed Computing</a> - åˆ†å¸ƒå¼ç³»ç»Ÿæ–°æ‰‹å¸¸çŠ¯çš„ 8 ä¸ªé”™è¯¯ï¼Œå¹¶æ¢è®¨äº†å…¶ä¼šå¸¦æ¥çš„å½±å“ã€‚</li>
<li><a target="_blank" rel="noopener" href="http://book.mixu.net/distsys/">Distributed Systems for Fun and Profit</a> - ä¸€æœ¬å­¦ä¹ å°å†Œï¼Œæ¶µç›–äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å…³é”®é—®é¢˜ï¼ŒåŒ…æ‹¬æ—¶é—´çš„ä½œç”¨å’Œä¸åŒçš„å¤åˆ¶ç­–ç•¥ã€‚</li>
<li><a target="_blank" rel="noopener" href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.41.7628&rep=rep1&type=pdf">A Note on Distributed Systems</a> - è¿™æ˜¯ä¸€ç¯‡ç»å…¸çš„è®ºæ–‡ï¼Œè®²è¿°äº†ä¸ºä»€ä¹ˆåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¿œç¨‹äº¤äº’ä¸èƒ½åƒæœ¬åœ°å¯¹è±¡é‚£æ ·è¿›è¡Œã€‚</li>
<li><a target="_blank" rel="noopener" href="https://www.allthingsdistributed.com/files/amazon-dynamo-sosp2007.pdf">Amazonâ€™s Highly Available Key-value Store</a></li>
<li><a target="_blank" rel="noopener" href="https://cryptographics.info/cryptographics/blockchain/cap-theorem/">CAP Theorem</a></li>
<li><a target="_blank" rel="noopener" href="https://www.semanticscholar.org/paper/CAP-twelve-years-later%3A-How-the-%22rules%22-have-Brewer/c9c73f5a1668b8bf12aae2efb6ac5a5a2c34002a">CAP twelve years later: How the â€œrulesâ€ have changed</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2018/07/cap.html">CAP å®šç†çš„å«ä¹‰</a> - by é˜®ä¸€å³°</li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5d720e86f265da03cc08de74">ç¥ä¸€æ ·çš„ CAP ç†è®ºè¢«åº”ç”¨åœ¨ä½•æ–¹</a></li>
<li><a target="_blank" rel="noopener" href="https://queue.acm.org/detail.cfm?id=1394128">BASE: An Acid Alternative</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/dac0e2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/dac0e2/" class="post-title-link" itemprop="url">åˆ†å¸ƒå¼ä¸€è‡´æ€§</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-11-08 08:15:33" itemprop="dateCreated datePublished" datetime="2021-11-08T08:15:33+08:00">2021-11-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-23 18:54:25" itemprop="dateModified" datetime="2022-09-23T18:54:25+08:00">2022-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E7%90%86%E8%AE%BA/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼ç†è®º</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>4k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>4 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="åˆ†å¸ƒå¼ä¸€è‡´æ€§"><a href="#åˆ†å¸ƒå¼ä¸€è‡´æ€§" class="headerlink" title="åˆ†å¸ƒå¼ä¸€è‡´æ€§"></a>åˆ†å¸ƒå¼ä¸€è‡´æ€§</h1><h2 id="ACID-ç†è®º"><a href="#ACID-ç†è®º" class="headerlink" title="ACID ç†è®º"></a>ACID ç†è®º</h2><p>ACID æ˜¯æ•°æ®åº“äº‹åŠ¡æ­£ç¡®æ‰§è¡Œçš„å››ä¸ªåŸºæœ¬è¦ç´ ã€‚</p>
<ul>
<li><strong>åŸå­æ€§ï¼ˆAtomicityï¼‰</strong><ul>
<li>äº‹åŠ¡è¢«è§†ä¸ºä¸å¯åˆ†å‰²çš„æœ€å°å•å…ƒï¼Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚</li>
<li>å›æ»šå¯ä»¥ç”¨æ—¥å¿—æ¥å®ç°ï¼Œæ—¥å¿—è®°å½•ç€äº‹åŠ¡æ‰€æ‰§è¡Œçš„ä¿®æ”¹æ“ä½œï¼Œåœ¨å›æ»šæ—¶åå‘æ‰§è¡Œè¿™äº›ä¿®æ”¹æ“ä½œå³å¯ã€‚</li>
</ul>
</li>
<li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong><ul>
<li>æ•°æ®åº“åœ¨äº‹åŠ¡æ‰§è¡Œå‰åéƒ½ä¿æŒä¸€è‡´æ€§çŠ¶æ€ã€‚</li>
<li>åœ¨ä¸€è‡´æ€§çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰äº‹åŠ¡å¯¹ä¸€ä¸ªæ•°æ®çš„è¯»å–ç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚</li>
</ul>
</li>
<li><strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</strong><ul>
<li>ä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤ä»¥å‰ï¼Œå¯¹å…¶å®ƒäº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚</li>
</ul>
</li>
<li><strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</strong><ul>
<li>ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹å°†ä¼šæ°¸è¿œä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚å³ä½¿ç³»ç»Ÿå‘ç”Ÿå´©æºƒï¼Œäº‹åŠ¡æ‰§è¡Œçš„ç»“æœä¹Ÿä¸èƒ½ä¸¢å¤±ã€‚</li>
<li>å¯ä»¥é€šè¿‡æ•°æ®åº“å¤‡ä»½å’Œæ¢å¤æ¥å®ç°ï¼Œåœ¨ç³»ç»Ÿå‘ç”Ÿå¥”æºƒæ—¶ï¼Œä½¿ç”¨å¤‡ä»½çš„æ•°æ®åº“è¿›è¡Œæ•°æ®æ¢å¤ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä¸€ä¸ªæ”¯æŒäº‹åŠ¡ï¼ˆTransactionï¼‰ä¸­çš„æ•°æ®åº“ç³»ç»Ÿï¼Œå¿…éœ€è¦å…·æœ‰è¿™å››ç§ç‰¹æ€§ï¼Œå¦åˆ™åœ¨äº‹åŠ¡è¿‡ç¨‹ï¼ˆTransaction processingï¼‰å½“ä¸­æ— æ³•ä¿è¯æ•°æ®çš„æ­£ç¡®æ€§ï¼Œäº¤æ˜“è¿‡ç¨‹æå¯èƒ½è¾¾ä¸åˆ°äº¤æ˜“ã€‚</strong></p>
<ul>
<li>åªæœ‰æ»¡è¶³ä¸€è‡´æ€§ï¼Œäº‹åŠ¡çš„æ‰§è¡Œç»“æœæ‰æ˜¯æ­£ç¡®çš„ã€‚</li>
<li>åœ¨æ— å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œéš”ç¦»æ€§ä¸€å®šèƒ½å¤Ÿæ»¡è¶³ã€‚æ­¤æ—¶åªè¦èƒ½æ»¡è¶³åŸå­æ€§ï¼Œå°±ä¸€å®šèƒ½æ»¡è¶³ä¸€è‡´æ€§ã€‚</li>
<li>åœ¨å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œäº‹åŠ¡ä¸ä»…è¦æ»¡è¶³åŸå­æ€§ï¼Œè¿˜éœ€è¦æ»¡è¶³éš”ç¦»æ€§ï¼Œæ‰èƒ½æ»¡è¶³ä¸€è‡´æ€§ã€‚</li>
<li>äº‹åŠ¡æ»¡è¶³æŒä¹…åŒ–æ˜¯ä¸ºäº†èƒ½åº”å¯¹ç³»ç»Ÿå´©æºƒçš„æƒ…å†µã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/database/RDB/%E6%95%B0%E6%8D%AE%E5%BA%93ACID.png" alt="img"></p>
<h2 id="æœ¬åœ°äº‹åŠ¡å’Œåˆ†å¸ƒå¼äº‹åŠ¡"><a href="#æœ¬åœ°äº‹åŠ¡å’Œåˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="æœ¬åœ°äº‹åŠ¡å’Œåˆ†å¸ƒå¼äº‹åŠ¡"></a>æœ¬åœ°äº‹åŠ¡å’Œåˆ†å¸ƒå¼äº‹åŠ¡</h2><p>å­¦ä¹ åˆ†å¸ƒå¼ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹æœ¬åœ°äº‹åŠ¡çš„æ¦‚å¿µã€‚</p>
<p>äº‹åŠ¡ç®€å•æ¥è¯´ï¼š<strong>ä¸€ä¸ªä¼šè¯ä¸­æ‰€è¿›è¡Œæ‰€æœ‰çš„æ“ä½œï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥</strong>ã€‚</p>
<p>äº‹åŠ¡æŒ‡çš„æ˜¯æ»¡è¶³ ACID ç‰¹æ€§çš„ä¸€ç»„æ“ä½œï¼Œå¯ä»¥é€šè¿‡ <code>Commit</code> æäº¤ä¸€ä¸ªäº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>Rollback</code> è¿›è¡Œå›æ»šã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/database/RDB/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1.png" alt="img"></p>
<p><strong>åˆ†å¸ƒå¼äº‹åŠ¡æŒ‡çš„æ˜¯äº‹åŠ¡æ“ä½œè·¨è¶Šå¤šä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¦æ±‚æ»¡è¶³äº‹åŠ¡çš„ ACID ç‰¹æ€§</strong>ã€‚</p>
<p>åˆ†å¸ƒå¼äº‹åŠ¡ç›¸æ¯”äºå•æœºäº‹åŠ¡ï¼Œå®ç°å¤æ‚åº¦è¦é«˜å¾ˆå¤šï¼Œä¸»è¦æ˜¯å› ä¸ºå…¶å­˜åœ¨ä»¥ä¸‹<strong>éš¾ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>äº‹åŠ¡çš„åŸå­æ€§</strong>ï¼šäº‹åŠ¡æ“ä½œè·¨ä¸åŒèŠ‚ç‚¹ï¼Œå½“å¤šä¸ªèŠ‚ç‚¹æŸä¸€èŠ‚ç‚¹æ“ä½œå¤±è´¥æ—¶ï¼Œéœ€è¦ä¿è¯å¤šèŠ‚ç‚¹æ“ä½œçš„<strong>éƒ½åšæˆ–éƒ½ä¸åšï¼ˆAll or Nothingï¼‰</strong>çš„åŸå­æ€§ã€‚</li>
<li><strong>äº‹åŠ¡çš„ä¸€è‡´æ€§</strong>ï¼šå½“å‘ç”Ÿç½‘ç»œä¼ è¾“æ•…éšœæˆ–è€…èŠ‚ç‚¹æ•…éšœï¼ŒèŠ‚ç‚¹é—´æ•°æ®å¤åˆ¶é€šé“ä¸­æ–­ï¼Œåœ¨è¿›è¡Œäº‹åŠ¡æ“ä½œæ—¶éœ€è¦ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œä¿è¯äº‹åŠ¡çš„ä»»ä½•æ“ä½œéƒ½ä¸ä¼šä½¿å¾—æ•°æ®è¿åæ•°æ®åº“å®šä¹‰çš„çº¦æŸã€è§¦å‘å™¨ç­‰è§„åˆ™ã€‚</li>
<li><strong>äº‹åŠ¡çš„éš”ç¦»æ€§</strong>ï¼šäº‹åŠ¡éš”ç¦»æ€§çš„æœ¬è´¨å°±æ˜¯å¦‚ä½•æ­£ç¡®å¤šä¸ªå¹¶å‘äº‹åŠ¡çš„å¤„ç†çš„è¯»å†™å†²çªå’Œå†™å†™å†²çªï¼Œå› ä¸ºåœ¨åˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°æäº¤ä¸åŒæ­¥çš„ç°è±¡ï¼Œè¿™ä¸ªæ—¶å€™å°±æœ‰å¯èƒ½å‡ºç°â€œéƒ¨åˆ†å·²ç»æäº¤â€çš„äº‹åŠ¡ã€‚æ­¤æ—¶å¹¶å‘åº”ç”¨è®¿é—®æ•°æ®å¦‚æœæ²¡æœ‰åŠ ä»¥æ§åˆ¶ï¼Œæœ‰å¯èƒ½å‡ºç°â€œè„è¯»â€é—®é¢˜ã€‚</li>
</ul>
<p>åœ¨åˆ†å¸ƒå¼é¢†åŸŸï¼Œè¦å®ç°å¼ºä¸€è‡´æ€§ï¼Œä»£ä»·éå¸¸é«˜æ˜‚ã€‚å› æ­¤ï¼Œæœ‰äººåŸºäº CAP ç†è®ºä»¥åŠ BASE ç†è®ºï¼Œæœ‰äººå°±æå‡ºäº†<strong>æŸ”æ€§äº‹åŠ¡</strong>çš„æ¦‚å¿µã€‚æŸ”æ€§äº‹åŠ¡æ˜¯æŒ‡ï¼šåœ¨ä¸å½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§çš„æƒ…å†µä¸‹(Basically Available åŸºæœ¬å¯ç”¨)ï¼Œå…è®¸ç³»ç»Ÿå­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„ä¸­é—´çŠ¶æ€(Soft State è½¯çŠ¶æ€)ï¼Œåœ¨ç»è¿‡æ•°æ®åŒæ­¥çš„å»¶æ—¶ä¹‹åï¼Œæœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ã€‚<strong>å¹¶ä¸æ˜¯å®Œå…¨æ”¾å¼ƒäº† ACIDï¼Œè€Œæ˜¯é€šè¿‡æ”¾å®½ä¸€è‡´æ€§è¦æ±‚ï¼Œå€ŸåŠ©æœ¬åœ°äº‹åŠ¡æ¥å®ç°æœ€ç»ˆåˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§çš„åŒæ—¶ä¹Ÿä¿è¯ç³»ç»Ÿçš„åå</strong>ã€‚</p>
<h2 id="CAP-ç†è®º"><a href="#CAP-ç†è®º" class="headerlink" title="CAP ç†è®º"></a>CAP ç†è®º</h2><blockquote>
<p>CAP å®šç†æ˜¯åŠ å·å¤§å­¦è®¡ç®—æœºç§‘å­¦å®¶åŸƒé‡Œå…‹Â·å¸ƒé²å°”æå‡ºæ¥çš„çŒœæƒ³ï¼Œåæ¥è¢«è¯æ˜æˆä¸ºåˆ†å¸ƒå¼è®¡ç®—é¢†åŸŸå…¬è®¤çš„å®šç†ã€‚</p>
</blockquote>
<p><strong>CAP å®šç†</strong>ï¼ŒæŒ‡çš„æ˜¯ï¼š<strong>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ æœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹</strong>ã€‚</p>
<img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20211102191636.png" style="width: 400px" />

<p>CAP å°±æ˜¯å– Consistencyã€Availabilityã€Partition Tolerance çš„é¦–å­—æ¯è€Œå‘½åã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20211102180526.png" alt="img"></p>
<ul>
<li>ä¸€è‡´æ€§ï¼ˆ<strong>C</strong>onsistencyï¼‰ï¼šåœ¨ä»»ä½•ç»™å®šæ—¶é—´ï¼Œç½‘ç»œä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½å…·æœ‰å®Œå…¨ç›¸åŒï¼ˆæœ€è¿‘ï¼‰çš„å€¼ã€‚</li>
<li>å¯ç”¨æ€§ï¼ˆ<strong>A</strong>vailabilityï¼‰ï¼šå¯¹ç½‘ç»œçš„æ¯ä¸ªè¯·æ±‚éƒ½ä¼šæ”¶åˆ°å“åº”ï¼Œä½†ä¸èƒ½ä¿è¯è¿”å›çš„æ•°æ®æ˜¯æœ€æ–°çš„ã€‚</li>
<li>åˆ†åŒºå®¹é”™æ€§ï¼ˆ<strong>P</strong>artition Toleranceï¼‰ï¼šå³ä½¿ä»»æ„æ•°é‡çš„èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œç½‘ç»œä»ä¼šç»§ç»­è¿è¡Œã€‚</li>
</ul>
<h3 id="ä¸€è‡´æ€§"><a href="#ä¸€è‡´æ€§" class="headerlink" title="ä¸€è‡´æ€§"></a>ä¸€è‡´æ€§</h3><p>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰æŒ‡çš„æ˜¯<strong>å¤šä¸ªæ•°æ®å‰¯æœ¬æ˜¯å¦èƒ½ä¿æŒä¸€è‡´</strong>çš„ç‰¹æ€§ã€‚</p>
<p>åœ¨ä¸€è‡´æ€§çš„æ¡ä»¶ä¸‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨æ‰§è¡Œå†™æ“ä½œæˆåŠŸåï¼Œå¦‚æœæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½å¤Ÿè¯»å–åˆ°æœ€æ–°çš„å€¼ï¼Œè¯¥ç³»ç»Ÿå°±è¢«è®¤ä¸ºå…·æœ‰å¼ºä¸€è‡´æ€§ã€‚</p>
<p>æ•°æ®ä¸€è‡´æ€§åˆå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li><strong>å¼ºä¸€è‡´æ€§</strong> - æ•°æ®æ›´æ–°æ“ä½œç»“æœå’Œæ“ä½œå“åº”æ€»æ˜¯ä¸€è‡´çš„ï¼Œå³æ“ä½œå“åº”é€šçŸ¥æ›´æ–°å¤±è´¥ï¼Œé‚£ä¹ˆæ•°æ®ä¸€å®šæ²¡æœ‰è¢«æ›´æ–°ï¼Œè€Œä¸æ˜¯å¤„äºä¸ç¡®å®šçŠ¶æ€ã€‚</li>
<li><strong>æœ€ç»ˆä¸€è‡´æ€§</strong> - å³ç‰©ç†å­˜å‚¨çš„æ•°æ®å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ï¼Œç»ˆç«¯ç”¨æˆ·è®¿é—®åˆ°çš„æ•°æ®å¯èƒ½ä¹Ÿæ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†ç³»ç»Ÿç»è¿‡ä¸€æ®µæ—¶é—´çš„è‡ªæˆ‘ä¿®å¤å’Œä¿®æ­£ï¼Œæ•°æ®æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´ã€‚</li>
</ul>
<p>ä¸¾ä¾‹æ¥è¯´ï¼ŒæŸæ¡è®°å½•æ˜¯ v0ï¼Œç”¨æˆ·å‘ G1 å‘èµ·ä¸€ä¸ªå†™æ“ä½œï¼Œå°†å…¶æ”¹ä¸º v1ã€‚</p>
<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018071602.png" alt="img"></p>
<p>æ¥ä¸‹æ¥ï¼Œç”¨æˆ·çš„è¯»æ“ä½œå°±ä¼šå¾—åˆ° v1ã€‚è¿™å°±å«ä¸€è‡´æ€§ã€‚</p>
<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018071603.png" alt="img"></p>
<p>é—®é¢˜æ˜¯ï¼Œç”¨æˆ·æœ‰å¯èƒ½å‘ G2 å‘èµ·è¯»æ“ä½œï¼Œç”±äº G2 çš„å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤è¿”å›çš„æ˜¯ v0ã€‚G1 å’Œ G2 è¯»æ“ä½œçš„ç»“æœä¸ä¸€è‡´ï¼Œè¿™å°±ä¸æ»¡è¶³ä¸€è‡´æ€§äº†ã€‚</p>
<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018071604.png" alt="img"></p>
<p>ä¸ºäº†è®© G2 ä¹Ÿèƒ½å˜ä¸º v1ï¼Œå°±è¦åœ¨ G1 å†™æ“ä½œçš„æ—¶å€™ï¼Œè®© G1 å‘ G2 å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè¦æ±‚ G2 ä¹Ÿæ”¹æˆ v1ã€‚</p>
<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018071605.png" alt="img"></p>
<p>è¿™æ ·çš„è¯ï¼Œç”¨æˆ·å‘ G2 å‘èµ·è¯»æ“ä½œï¼Œä¹Ÿèƒ½å¾—åˆ° v1ã€‚</p>
<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018071606.png" alt="img"></p>
<h3 id="å¯ç”¨æ€§"><a href="#å¯ç”¨æ€§" class="headerlink" title="å¯ç”¨æ€§"></a>å¯ç”¨æ€§</h3><p>å¯ç”¨æ€§æŒ‡<strong>åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é¢å¯¹å„ç§å¼‚å¸¸æ—¶å¯ä»¥æä¾›æ­£å¸¸æœåŠ¡çš„èƒ½åŠ›</strong>ï¼Œå¯ä»¥ç”¨ç³»ç»Ÿå¯ç”¨æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼æ¥è¡¡é‡ï¼Œ4 ä¸ª 9 çš„å¯ç”¨æ€§è¡¨ç¤ºç³»ç»Ÿ <code>99.99%</code> çš„æ—¶é—´æ˜¯å¯ç”¨çš„ã€‚</p>
<p>åœ¨å¯ç”¨æ€§æ¡ä»¶ä¸‹ï¼Œç³»ç»Ÿæä¾›çš„æœåŠ¡ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€ï¼Œå¯¹äºç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›ç»“æœã€‚</p>
<h3 id="åˆ†åŒºå®¹é”™æ€§"><a href="#åˆ†åŒºå®¹é”™æ€§" class="headerlink" title="åˆ†åŒºå®¹é”™æ€§"></a>åˆ†åŒºå®¹é”™æ€§</h3><p>åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition Toleranceï¼‰æŒ‡ <strong>åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶éœ€è¦èƒ½å¯¹å¤–æä¾›ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éæ˜¯æ•´ä¸ªç½‘ç»œç¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœ</strong>ã€‚</p>
<p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿé‡Œé¢ï¼ŒèŠ‚ç‚¹ç»„æˆçš„ç½‘ç»œæœ¬æ¥åº”è¯¥æ˜¯è¿é€šçš„ã€‚ç„¶è€Œå¯èƒ½å› ä¸ºä¸€äº›æ•…éšœï¼Œä½¿å¾—æœ‰äº›èŠ‚ç‚¹ä¹‹é—´ä¸è¿é€šäº†ï¼Œæ•´ä¸ªç½‘ç»œå°±åˆ†æˆäº†å‡ å—åŒºåŸŸã€‚æ•°æ®å°±æ•£å¸ƒåœ¨äº†è¿™äº›ä¸è¿é€šçš„åŒºåŸŸä¸­ï¼Œè¿™å°±å«åˆ†åŒºã€‚</p>
<p>å‡è®¾ï¼ŒæŸä¸ªæ•°æ®é¡¹åªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸­ä¿å­˜ï¼Œé‚£ä¹ˆåˆ†åŒºå‡ºç°åï¼Œå’Œè¿™ä¸ªèŠ‚ç‚¹ä¸è¿é€šçš„éƒ¨åˆ†å°±è®¿é—®ä¸åˆ°è¿™ä¸ªæ•°æ®äº†ã€‚è¿™æ—¶åˆ†åŒºå°±æ˜¯æ— æ³•å®¹å¿çš„ã€‚</p>
<p>æé«˜åˆ†åŒºå®¹é”™æ€§çš„åŠæ³•å°±æ˜¯ä¸€ä¸ªæ•°æ®é¡¹å¤åˆ¶åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆå‡ºç°åˆ†åŒºä¹‹åï¼Œè¿™ä¸€æ•°æ®é¡¹å°±å¯èƒ½åˆ†å¸ƒåˆ°å„ä¸ªåŒºé‡Œã€‚å®¹é”™æ€§å°±æé«˜äº†ã€‚</p>
<p>ç„¶è€Œï¼Œè¦æŠŠæ•°æ®å¤åˆ¶åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œå°±ä¼šå¸¦æ¥ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œå°±æ˜¯å¤šä¸ªèŠ‚ç‚¹ä¸Šé¢çš„æ•°æ®å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ã€‚è¦ä¿è¯ä¸€è‡´ï¼Œæ¯æ¬¡å†™æ“ä½œå°±éƒ½è¦ç­‰å¾…å…¨éƒ¨èŠ‚ç‚¹å†™æˆåŠŸï¼Œè€Œè¿™ç­‰å¾…åˆä¼šå¸¦æ¥å¯ç”¨æ€§çš„é—®é¢˜ã€‚</p>
<p>æ€»çš„æ¥è¯´å°±æ˜¯ï¼Œæ•°æ®å­˜åœ¨çš„èŠ‚ç‚¹è¶Šå¤šï¼Œåˆ†åŒºå®¹é”™æ€§è¶Šé«˜ï¼Œä½†è¦å¤åˆ¶æ›´æ–°çš„æ•°æ®å°±è¶Šå¤šï¼Œä¸€è‡´æ€§å°±è¶Šéš¾ä¿è¯ã€‚ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œæ›´æ–°æ‰€æœ‰èŠ‚ç‚¹æ•°æ®æ‰€éœ€è¦çš„æ—¶é—´å°±è¶Šé•¿ï¼Œå¯ç”¨æ€§å°±ä¼šé™ä½ã€‚</p>
<p>å¤§å¤šæ•°åˆ†å¸ƒå¼ç³»ç»Ÿéƒ½åˆ†å¸ƒåœ¨å¤šä¸ªå­ç½‘ç»œï¼Œæ¯ä¸ªå­ç½‘ç»œå°±å«åšä¸€ä¸ªåŒºï¼ˆPartitionï¼‰ã€‚åˆ†åŒºå®¹é”™çš„æ„æ€æ˜¯ï¼ŒåŒºé—´é€šä¿¡å¯èƒ½å¤±è´¥ã€‚æ¯”å¦‚ï¼Œä¸€å°æœåŠ¡å™¨æ”¾åœ¨ä¸­å›½ï¼Œå¦ä¸€å°æœåŠ¡å™¨æ”¾åœ¨ç¾å›½ï¼Œè¿™å°±æ˜¯ä¸¤ä¸ªåŒºï¼Œå®ƒä»¬ä¹‹é—´å¯èƒ½æ— æ³•é€šä¿¡ã€‚</p>
<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018071601.png" alt="img"></p>
<p>ä¸Šå›¾ä¸­ï¼ŒG1 å’Œ G2 æ˜¯ä¸¤å°è·¨åŒºçš„æœåŠ¡å™¨ã€‚G1 å‘ G2 å‘é€ä¸€æ¡æ¶ˆæ¯ï¼ŒG2 å¯èƒ½æ— æ³•æ”¶åˆ°ã€‚ç³»ç»Ÿè®¾è®¡çš„æ—¶å€™ï¼Œå¿…é¡»è€ƒè™‘åˆ°è¿™ç§æƒ…å†µã€‚</p>
<p><strong>ä¸€èˆ¬æ¥è¯´ï¼Œåˆ†åŒºå®¹é”™æ— æ³•é¿å…</strong>ï¼Œå› æ­¤å¯ä»¥è®¤ä¸º CAP çš„ P æ€»æ˜¯æˆç«‹ã€‚CAP å®šç†å‘Šè¯‰æˆ‘ä»¬ï¼Œå‰©ä¸‹çš„ C å’Œ A æ— æ³•åŒæ—¶åšåˆ°ã€‚</p>
<h3 id="AP-or-CP"><a href="#AP-or-CP" class="headerlink" title="AP or CP"></a>AP or CP</h3><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†åŒºå®¹é”™æ€§å¿…ä¸å¯å°‘ï¼Œå› ä¸ºéœ€è¦æ€»æ˜¯å‡è®¾ç½‘ç»œæ˜¯ä¸å¯é çš„ã€‚å› æ­¤ï¼Œ<strong>CAP ç†è®ºå®é™…åœ¨æ˜¯è¦åœ¨å¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹‹é—´åšæƒè¡¡</strong>ã€‚</p>
<p>ç”±äºåˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ï¼ˆå¦‚åŒºå—é“¾ï¼‰çš„æ€§è´¨ï¼Œåˆ†åŒºå®¹é”™æ€§æ˜¯ä¸€ä¸ªæ—¢å®šçš„äº‹å®ï¼›ç½‘ç»œä¸­æ€»ä¼šæœ‰å¤±è´¥&#x2F;æ— æ³•è®¿é—®çš„èŠ‚ç‚¹ï¼ˆå°¤å…¶æ˜¯å› ä¸ºäº’è”ç½‘çš„ä¸ç¨³å®šç‰¹æ€§ï¼‰ã€‚ CAP å®šç†æŒ‡å‡ºï¼Œå½“å­˜åœ¨ Pï¼ˆåˆ†åŒºï¼‰æ—¶ï¼Œå¿…é¡»åœ¨ Cï¼ˆä¸€è‡´æ€§ï¼‰æˆ– Aï¼ˆå¯ç”¨æ€§ï¼‰ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚</p>
<p>ï¼ˆ1ï¼‰AP æ¨¡å¼</p>
<blockquote>
<p><strong>AP</strong> <strong>æ¨¡å¼</strong>ï¼šå¯¹ç½‘ç»œçš„æ¯ä¸ªè¯·æ±‚éƒ½ä¼šæ”¶åˆ°å“åº”ï¼Œå³ä½¿ç½‘ç»œç”±äºç½‘ç»œåˆ†åŒºæ•…éšœè€Œæ— æ³•ä¿è¯å®ƒæ˜¯æœ€æ–°çš„ã€‚</p>
</blockquote>
<p>é€‰æ‹© <strong>AP</strong> <strong>æ¨¡å¼</strong>ï¼Œå®ç°äº†æœåŠ¡çš„é«˜å¯ç”¨ã€‚ç”¨æˆ·è®¿é—®ç³»ç»Ÿçš„æ—¶å€™ï¼Œéƒ½èƒ½å¾—åˆ°å“åº”æ•°æ®ï¼Œä¸ä¼šå‡ºç°å“åº”é”™è¯¯ï¼›ä½†æ˜¯ï¼Œå½“å‡ºç°åˆ†åŒºæ•…éšœæ—¶ï¼Œç›¸åŒçš„è¯»æ“ä½œï¼Œè®¿é—®ä¸åŒçš„èŠ‚ç‚¹ï¼Œå¾—åˆ°å“åº”æ•°æ®å¯èƒ½ä¸ä¸€æ ·ã€‚</p>
<img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20211102191819.png" style="width: 500px" />

<p>ï¼ˆ2ï¼‰CP æ¨¡å¼</p>
<blockquote>
<p><strong>CP</strong> <strong>æ¨¡å¼</strong>ï¼šå¦‚æœç”±äºç½‘ç»œåˆ†åŒºï¼ˆæ•…éšœèŠ‚ç‚¹ï¼‰è€Œæ— æ³•ä¿è¯ç‰¹å®šä¿¡æ¯æ˜¯æœ€æ–°çš„ï¼Œåˆ™ç³»ç»Ÿå°†è¿”å›é”™è¯¯æˆ–è¶…æ—¶ã€‚</p>
</blockquote>
<p>é€‰æ‹© <strong>CP</strong> <strong>æ¨¡å¼</strong>ï¼Œè¿™æ ·èƒ½å¤Ÿæä¾›ä¸€éƒ¨åˆ†çš„å¯ç”¨æ€§ã€‚é‡‡ç”¨ CP æ¨¡å‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä¸€æ—¦å› ä¸ºæ¶ˆæ¯ä¸¢å¤±ã€å»¶è¿Ÿè¿‡é«˜å‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºï¼Œå°±å½±å“ç”¨æˆ·çš„ä½“éªŒå’Œä¸šåŠ¡çš„å¯ç”¨æ€§ã€‚å› ä¸ºä¸ºäº†é˜²æ­¢æ•°æ®ä¸ä¸€è‡´ï¼Œé›†ç¾¤å°†æ‹’ç»æ–°æ•°æ®çš„å†™å…¥ã€‚</p>
<img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20211102191820.png" style="width: 500px" />

<h2 id="BASE-ç†è®º"><a href="#BASE-ç†è®º" class="headerlink" title="BASE ç†è®º"></a>BASE ç†è®º</h2><h3 id="ä»€ä¹ˆæ˜¯-BASE-å®šç†"><a href="#ä»€ä¹ˆæ˜¯-BASE-å®šç†" class="headerlink" title="ä»€ä¹ˆæ˜¯ BASE å®šç†"></a>ä»€ä¹ˆæ˜¯ BASE å®šç†</h3><blockquote>
<p><strong>BASE å®šç†æ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœ</strong>ã€‚</p>
</blockquote>
<p>BASE æ˜¯ <strong><code>åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰</code><strong>ã€</strong><code>è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰</code></strong> å’Œ <strong><code>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventually Consistentï¼‰</code></strong> ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚</p>
<p>BASE ç†è®ºçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<ul>
<li><strong>åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰</strong>åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œ<strong>ä¿è¯æ ¸å¿ƒå¯ç”¨ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§</strong>ã€‚ä¾‹å¦‚ï¼Œç”µå•†åœ¨åšä¿ƒé”€æ—¶ï¼Œä¸ºäº†ä¿è¯è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§çš„é¡µé¢ã€‚</li>
<li><strong>è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰</strong>æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ï¼Œå³<strong>å…è®¸ç³»ç»Ÿä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡ŒåŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶</strong>ã€‚</li>
<li><strong>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventually Consistentï¼‰</strong>å¼ºè°ƒçš„æ˜¯<strong>ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€</strong>ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/design/architecture/%E5%88%86%E5%B8%83%E5%BC%8F%E7%90%86%E8%AE%BA-BASE.png" alt="img"></p>
<h3 id="BASE-vs-ACID"><a href="#BASE-vs-ACID" class="headerlink" title="BASE vs. ACID"></a>BASE vs. ACID</h3><p>BASE çš„ç†è®ºçš„<strong>æ ¸å¿ƒæ€æƒ³</strong>æ˜¯ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<p>ACID è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨ä¼ ç»Ÿçš„æ•°æ®åº“ç³»ç»Ÿä¸Šã€‚è€Œ BASE è¦æ±‚æœ€ç»ˆä¸€è‡´æ€§ï¼Œé€šè¿‡<strong>ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è¾¾åˆ°å¯ç”¨æ€§</strong>ï¼Œé€šå¸¸è¿ç”¨åœ¨å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚</p>
<img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20211102192406.png" style="width: 640px" />

<p>åœ¨å®é™…çš„åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œä¸åŒä¸šåŠ¡å•å…ƒå’Œç»„ä»¶å¯¹ä¸€è‡´æ€§çš„è¦æ±‚æ˜¯ä¸åŒçš„ï¼Œå› æ­¤ ACID å’Œ BASE å¾€å¾€ä¼šç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://cryptographics.info/cryptographics/blockchain/cap-theorem/">CAP Theorem</a></li>
<li><a target="_blank" rel="noopener" href="https://www.semanticscholar.org/paper/CAP-twelve-years-later%3A-How-the-%22rules%22-have-Brewer/c9c73f5a1668b8bf12aae2efb6ac5a5a2c34002a">CAP twelve years later: How the â€œrulesâ€ have changed</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2018/07/cap.html">CAP å®šç†çš„å«ä¹‰</a> - by é˜®ä¸€å³°</li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5d720e86f265da03cc08de74">ç¥ä¸€æ ·çš„ CAP ç†è®ºè¢«åº”ç”¨åœ¨ä½•æ–¹</a></li>
<li><a target="_blank" rel="noopener" href="https://queue.acm.org/detail.cfm?id=1394128">BASE: An Acid Alternative</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/pages/a72fee/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/uploads/avatar.gif">
      <meta itemprop="name" content="é’æ‚Ÿ â—¾ Dunwu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu Blog">
      <meta itemprop="description" content="é’æ‚Ÿçš„ä¸ªäººåšå®¢">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Dunwu Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/pages/a72fee/" class="post-title-link" itemprop="url">æ‹œå åº­å°†å†›é—®é¢˜</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-11-08 08:15:33" itemprop="dateCreated datePublished" datetime="2021-11-08T08:15:33+08:00">2021-11-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-23 18:54:25" itemprop="dateModified" datetime="2022-09-23T18:54:25+08:00">2022-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E7%90%86%E8%AE%BA/" itemprop="url" rel="index"><span itemprop="name">åˆ†å¸ƒå¼ç†è®º</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>1 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="æ‹œå åº­å°†å†›é—®é¢˜"><a href="#æ‹œå åº­å°†å†›é—®é¢˜" class="headerlink" title="æ‹œå åº­å°†å†›é—®é¢˜"></a>æ‹œå åº­å°†å†›é—®é¢˜</h1><blockquote>
<p>æ‹œå åº­å°†å†›é—®é¢˜æ˜¯ç”±<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%8E%B1%E6%96%AF%E5%88%A9%C2%B7%E5%85%B0%E6%B3%A2%E7%89%B9">è±æ–¯åˆ©Â·å…°æ³¢ç‰¹</a>åœ¨å…¶åŒåè®ºæ–‡ä¸­æå‡ºçš„<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%AF%B9%E7%AD%89%E7%BD%91%E7%BB%9C">åˆ†å¸ƒå¼å¯¹ç­‰ç½‘ç»œ</a>é€šä¿¡å®¹é”™é—®é¢˜ã€‚å…¶å®æ˜¯å€Ÿæ‹œå åº­å°†å†›çš„ä¾‹å­ï¼ŒæŠ›å‡ºäº†åˆ†å¸ƒå¼å…±è¯†æ€§é—®é¢˜ï¼Œå¹¶æ¢è®¨å’Œè®ºè¯äº†è§£å†³çš„æ–¹æ³•ã€‚</p>
<p>åœ¨<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%88%86%E5%B8%83%E5%BC%8F%E8%A8%88%E7%AE%97">åˆ†å¸ƒå¼è®¡ç®—</a>ä¸­ï¼Œä¸åŒçš„èŠ‚ç‚¹é€šè¿‡é€šè®¯äº¤æ¢ä¿¡æ¯è¾¾æˆå…±è¯†è€ŒæŒ‰ç…§åŒä¸€å¥—åä½œç­–ç•¥è¡ŒåŠ¨ã€‚ä½†æœ‰æ—¶å€™ï¼Œç³»ç»Ÿä¸­çš„èŠ‚ç‚¹å¯èƒ½å‡ºé”™è€Œå‘é€é”™è¯¯çš„ä¿¡æ¯ï¼Œç”¨äºä¼ é€’ä¿¡æ¯çš„é€šè®¯ç½‘ç»œä¹Ÿå¯èƒ½å¯¼è‡´ä¿¡æ¯æŸåï¼Œä½¿å¾—ç½‘ç»œä¸­ä¸åŒçš„æˆå‘˜å…³äºå…¨ä½“åä½œçš„ç­–ç•¥å¾—å‡ºä¸åŒç»“è®ºï¼Œä»è€Œç ´åç³»ç»Ÿä¸€è‡´æ€§ã€‚æ‹œå åº­å°†å†›é—®é¢˜è¢«è®¤ä¸ºæ˜¯å®¹é”™æ€§é—®é¢˜ä¸­æœ€éš¾çš„é—®é¢˜ç±»å‹ä¹‹ä¸€ã€‚</p>
</blockquote>
<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>ä¸€ç¾¤æ‹œå åº­å°†å†›å„é¢†ä¸€æ”¯å†›é˜Ÿå…±åŒå›´å›°ä¸€åº§åŸå¸‚ã€‚</p>
<p>ä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œå†›é˜Ÿçš„è¡ŒåŠ¨ç­–ç•¥åªæœ‰ä¸¤ç§ï¼š<strong>è¿›æ”»</strong>ï¼ˆAttackï¼Œåé¢ç®€ç§° Aï¼‰æˆ– <strong>æ’¤é€€</strong>ï¼ˆRetreatï¼Œåé¢ç®€ç§° Rï¼‰ã€‚å¦‚æœè¿™äº›å†›é˜Ÿä¸æ˜¯ç»Ÿä¸€è¿›æ”»æˆ–æ’¤é€€ï¼Œå°±å¯èƒ½å› å…µåŠ›ä¸è¶³å¯¼è‡´å¤±è´¥ã€‚å› æ­¤ï¼Œ<strong>å°†å†›ä»¬é€šè¿‡æŠ•ç¥¨æ¥è¾¾æˆä¸€è‡´ç­–ç•¥ï¼šåŒè¿›æˆ–åŒé€€</strong>ã€‚</p>
<p>å› ä¸ºå°†å†›ä»¬åˆ†åˆ«åœ¨åŸå¸‚çš„ä¸åŒæ–¹ä½ï¼Œæ‰€ä»¥ä»–ä»¬åªèƒ½<strong>é€šè¿‡ä¿¡ä½¿äº’ç›¸è”ç³»</strong>ã€‚åœ¨æŠ•ç¥¨è¿‡ç¨‹ä¸­ï¼Œ<strong>æ¯ä½å°†å†›éƒ½å°†è‡ªå·±çš„æŠ•ç¥¨ä¿¡æ¯ï¼ˆA æˆ– Rï¼‰é€šçŸ¥å…¶ä»–æ‰€æœ‰å°†å†›</strong>ï¼Œè¿™æ ·ä¸€æ¥æ¯ä½å°†å†›æ ¹æ®è‡ªå·±çš„æŠ•ç¥¨å’Œå…¶ä»–æ‰€æœ‰å°†å†›é€æ¥çš„ä¿¡æ¯å°±å¯ä»¥åˆ†æå‡ºå…±åŒçš„æŠ•ç¥¨ç»“æœè€Œå†³å®šè¡ŒåŠ¨ç­–ç•¥ã€‚</p>
<p>è¿™ä¸ªæŠ½è±¡æ¨¡å‹çš„é—®é¢˜åœ¨äºï¼š<strong>å°†å†›ä¸­å¯èƒ½å­˜åœ¨å›å¾’ï¼Œä»–ä»¬ä¸ä»…ä¼šå‘å‡ºè¯¯å¯¼æ€§æŠ•ç¥¨ï¼Œè¿˜å¯èƒ½é€‰æ‹©æ€§åœ°å‘é€æŠ•ç¥¨ä¿¡æ¯</strong>ã€‚</p>
<p>ç”±äºå°†å†›ä¹‹é—´éœ€è¦é€šè¿‡ä¿¡ä½¿é€šè®¯ï¼Œå›å˜å°†å†›å¯èƒ½é€šè¿‡ä¼ªé€ ä¿¡ä»¶æ¥ä»¥å…¶ä»–å°†å†›çš„èº«ä»½å‘é€å‡æŠ•ç¥¨ã€‚è€Œå³ä½¿åœ¨ä¿è¯æ‰€æœ‰å°†å†›å¿ è¯šçš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¸èƒ½æ’é™¤ä¿¡ä½¿è¢«æ•Œäººæˆªæ€ï¼Œç”šè‡³è¢«æ•Œäººé—´è°æ›¿æ¢ç­‰æƒ…å†µã€‚å› æ­¤å¾ˆéš¾é€šè¿‡ä¿è¯äººå‘˜å¯é æ€§åŠé€šè®¯å¯é æ€§æ¥è§£å†³é—®é¢˜ã€‚</p>
<p>å‡ä½¿é‚£äº›å¿ è¯šï¼ˆæˆ–æ˜¯æ²¡æœ‰å‡ºé”™ï¼‰çš„å°†å†›ä»ç„¶èƒ½é€šè¿‡å¤šæ•°å†³å®šæ¥å†³å®šä»–ä»¬çš„æˆ˜ç•¥ï¼Œä¾¿ç§°è¾¾åˆ°äº†æ‹œå åº­å®¹é”™ã€‚åœ¨æ­¤ï¼Œç¥¨éƒ½ä¼šæœ‰ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè‹¥æ¶ˆæ¯ï¼ˆç¥¨ï¼‰æ²¡æœ‰è¢«æ”¶åˆ°ï¼Œåˆ™ä½¿ç”¨æ­¤é»˜è®¤å€¼æ¥æŠ•ç¥¨ã€‚</p>
<p>ä¸Šè¿°çš„æ•…äº‹å¯ä»¥æ˜ å°„åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ_å°†å†›ä»£è¡¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹ï¼›ä¿¡ä½¿ä»£è¡¨é€šä¿¡ç³»ç»Ÿï¼›å›å¾’ä»£è¡¨æ•…éšœæˆ–å¼‚å¸¸_ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210704104211.png" alt="img"></p>
<h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><blockquote>
<p>å…°ä¼¯ç‰¹é’ˆå¯¹æ‹œå åº­å°†å†›é—®é¢˜ï¼Œç»™å‡ºäº†ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼šå£å¤´åè®®å’Œä¹¦é¢åè®®ã€‚</p>
<p>æœ¬æ–‡ä»‹ç»ä¸€ä¸‹å£å¤´åè®®ã€‚</p>
</blockquote>
<p>åœ¨å£å¤´åè®®ä¸­ï¼Œæ‹œå åº­å°†å†›é—®é¢˜è¢«ç®€åŒ–ä¸º<strong>å°†å†› - å‰¯å®˜</strong>æ¨¡å‹ï¼Œå…¶æ ¸å¿ƒè§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¿ è¯šçš„å‰¯å®˜éµå®ˆåŒä¸€å‘½ä»¤ã€‚</li>
<li>è‹¥å°†å†›æ˜¯å¿ è¯šçš„ï¼Œæ‰€æœ‰å¿ è¯šçš„å‰¯å®˜éƒ½æ‰§è¡Œä»–çš„å‘½ä»¤ã€‚</li>
<li><strong>å¦‚æœå›å¾’äººæ•°ä¸º mï¼Œå°†å†›äººæ•°ä¸èƒ½å°‘äº 3m + 1</strong> ï¼Œé‚£ä¹ˆæ‹œå åº­å°†å†›é—®é¢˜å°±èƒ½è§£å†³äº†ã€‚â€”â€”å…³äºè¿™ä¸ªå…¬å¼ï¼Œå¯ä»¥ä¸å¿…æ·±ç©¶ï¼Œå¦‚æœå¯¹æ¨å¯¼è¿‡ç¨‹æ„Ÿå…´è¶£ï¼Œå¯ä»¥å‚è€ƒè®ºæ–‡ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ä¸€ã€å›å¾’äººæ•°ä¸º 1ï¼Œå°†å†›äººæ•°ä¸º 3</strong></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210704112012.png" alt="img"></p>
<p>è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå°†å†›äººæ•°ä¸æ»¡è¶³ 3m + 1ï¼Œæ— æ³•ä¿è¯å¿ è¯šçš„å‰¯å®˜éƒ½æ‰§è¡Œå°†å†›çš„å‘½ä»¤ã€‚</p>
<p><strong>ç¤ºä¾‹äºŒã€å›å¾’äººæ•°ä¸º 1ï¼Œå°†å†›äººæ•°ä¸º 4</strong></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210704194815.png" alt="img"></p>
<p>è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå°†å†›äººæ•°æ»¡è¶³ 3m + 1ï¼Œæ— è®ºæ˜¯å‰¯å®˜ä¸­æœ‰å›å¾’ï¼Œè¿˜æ˜¯å°†å†›æ˜¯å›å¾’ï¼Œéƒ½èƒ½ä¿è¯å¿ è¯šçš„å‰¯å®˜æ‰§è¡Œå°†å†›çš„å‘½ä»¤ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%B0%86%E5%86%9B%E9%97%AE%E9%A2%98">Wiki - æ‹œå åº­å°†å†›é—®é¢˜</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av78588312/">æ‹œå åº­å°†å†›é—®é¢˜è§†é¢‘è®²è§£</a> - ææ°¸ä¹è€å¸ˆè®²è§£çš„é€šä¿—æ˜“æ‡‚</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/9/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/blog/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/37/">37</a><a class="extend next" rel="next" href="/blog/page/11/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2015 â€“ 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">é’æ‚Ÿ â—¾ Dunwu</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">2.8m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">42:59</span>
  </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/blog/js/third-party/search/local-search.js"></script>




  <script src="/blog/js/third-party/pace.js"></script>

  




<script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: 'ğŸŒ“',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"dunwu","repo":"blog","client_id":"c45bc13ca1d3d3aa4836","client_secret":"1907a9f0c22087badad3938e1d7dcba9078f88ac","admin_user":"dunwu","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"3e12be03eb928797f3b6da53c7ca74f6"}</script>
<script src="/blog/js/third-party/comments/gitalk.js"></script>

</body>
</html>
